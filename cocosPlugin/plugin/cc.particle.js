System.register(["./deprecated-0768b3d4.js","./deprecated-4df5f565.js","./audio-downloader-f2f97571.js","./index-0614c00d.js","./deprecated-88eb2353.js","./screen-f991c158.js"],(function(t){"use strict";var e,i,r,n,a,o,s,l,u,h,c,_,p,d,f,m,y,v,b,g,w,M,T,S,O,x,z,E,C,A,R,F,D,P,I,L,B,U,V,k,G,H,N,W,j,X,K,Y,Z,q,Q,J,$,tt,et,it,rt,nt,at,ot,st,lt,ut,ht,ct,_t,pt,dt,ft,mt,yt,vt,bt,gt,wt,Mt,Tt,St,Ot,xt;return{setters:[function(t){e=t.c,i=t.t,r=t.b5,n=t._,a=t.a,o=t.e,s=t.f,l=t.Z,u=t.aa,h=t.l,c=t.C,_=t.b,p=t.h,d=t.m,f=t.d,m=t.ai,y=t.ah,v=t.s,b=t.V,g=t.Q,w=t.E,M=t.ag,T=t.bb,S=t.T,O=t.aq,x=t.W,z=t.b6,E=t.am,C=t.cc,A=t.a3,R=t.a0,F=t.aj,D=t.ak,P=t.al,I=t.r,L=t.cd,B=t.bf,U=t.ar,V=t.g,k=t.R,G=t.P,H=t.ce,N=t.o,W=t.be,j=t.bh,X=t.aC,K=t.j},function(t){Y=t.bH,Z=t.bo,q=t.P,Q=t.A,J=t.a,$=t.F,tt=t.K,et=t.bK,it=t.dU,rt=t.cN,nt=t.B,at=t.b,ot=t.M,st=t.bL,lt=t.H,ut=t.c7,ht=t.c5,ct=t.c6,_t=t.ep,pt=t.bG,dt=t.ec,ft=t.eE,mt=t.eN,yt=t.ak,vt=t.ab,bt=t.bp,gt=t.cK,wt=t.dW,Mt=t.e5,Tt=t.dQ},function(){},function(t){St=t.i},function(t){Ot=t.h,xt=t.g},function(){}],execute:function(){var zt,Et,Ct,At,Rt,Ft,Dt,Pt,It,Lt,Bt,Ut,Vt,kt,Gt,Ht,Nt,Wt,jt,Xt,Kt,Yt,Zt,qt,Qt,Jt,$t,te,ee,ie,re,ne,ae,oe,se,le,ue,he,ce,_e,pe,de,fe,me,ye,ve,be,ge=(zt=e("cc.Billboard"),Et=p(),Ct=d(),At=i(Y),Rt=i(Y),Ft=f(),Dt=f(),Pt=f(),It=f(),Nt=zt(Lt=Et(Lt=Ct(Lt=r((Ht=function(t){function e(){var e;return e=t.call(this)||this,o(e,"_texture",Ut,s(e)),o(e,"_height",Vt,s(e)),o(e,"_width",kt,s(e)),o(e,"_rotation",Gt,s(e)),e._model=null,e._mesh=null,e._material=null,e._uniform=new l(1,1,0,0),e}n(e,t),a(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._material&&this._material.setProperty("mainTexture",t)}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._material&&(this._uniform.y=t,this._material.setProperty("cc_size_rotation",this._uniform))}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._material&&(this._uniform.x=t,this._material.setProperty("cc_size_rotation",this._uniform))}},{key:"rotation",get:function(){return Math.round(100*m(this._rotation))/100},set:function(t){this._rotation=y(t),this._material&&(this._uniform.z=this._rotation,this._material.setProperty("cc_size_rotation",this._uniform))}}]);var i=e.prototype;return i.onLoad=function(){this.createModel()},i.onEnable=function(){this.attachToScene(),this._model.enabled=!0,this.width=this._width,this.height=this._height,this.rotation=this.rotation,this.texture=this.texture},i.onDisable=function(){this.detachFromScene()},i.attachToScene=function(){this._model&&this.node&&this.node.scene&&(this._model.scene&&this.detachFromScene(),this._getRenderScene().addModel(this._model))},i.detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},i.createModel=function(){this._mesh=Z({primitiveMode:q.TRIANGLE_LIST,positions:[0,0,0,0,0,0,0,0,0,0,0,0],uvs:[0,0,1,0,0,1,1,1],colors:[u.WHITE.r,u.WHITE.g,u.WHITE.b,u.WHITE.a,u.WHITE.r,u.WHITE.g,u.WHITE.b,u.WHITE.a,u.WHITE.r,u.WHITE.g,u.WHITE.b,u.WHITE.a,u.WHITE.r,u.WHITE.g,u.WHITE.b,u.WHITE.a],attributes:[new Q(J.ATTR_POSITION,$.RGB32F),new Q(J.ATTR_TEX_COORD,$.RG32F),new Q(J.ATTR_COLOR,$.RGBA8UI,!0)],indices:[0,1,2,1,2,3]},void 0,{calculateBounds:!1});var t=this._model=h.director.root.createModel(tt,this.node);t.node=t.transform=this.node,null==this._material&&(this._material=new et,this._material.copy(it.get("default-billboard-material"))),t.initSubModel(0,this._mesh.renderingSubMeshes[0],this._material)},e}(c),Ut=_((Bt=Ht).prototype,"_texture",[At],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(Bt.prototype,"texture",[Rt,Ft],Object.getOwnPropertyDescriptor(Bt.prototype,"texture"),Bt.prototype),Vt=_(Bt.prototype,"_height",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_(Bt.prototype,"height",[Dt],Object.getOwnPropertyDescriptor(Bt.prototype,"height"),Bt.prototype),kt=_(Bt.prototype,"_width",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_(Bt.prototype,"width",[Pt],Object.getOwnPropertyDescriptor(Bt.prototype,"width"),Bt.prototype),Gt=_(Bt.prototype,"_rotation",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_(Bt.prototype,"rotation",[It],Object.getOwnPropertyDescriptor(Bt.prototype,"rotation"),Bt.prototype),Lt=Bt))||Lt)||Lt)||Lt)||Lt,t({Billboard:Nt,BillboardComponent:Nt}),Nt),we=[new Q(J.ATTR_POSITION,$.RGB32F),new Q(J.ATTR_TEX_COORD,$.RGBA32F),new Q(J.ATTR_TEX_COORD1,$.RGB32F),new Q(J.ATTR_COLOR,$.RGBA8,!0)],Me=new b,Te=new b,Se=function(t){function e(){var e;return(e=t.call(this)||this)._capacity=void 0,e._vertSize=0,e._vBuffer=null,e._vertAttrsFloatCount=0,e._vdataF32=null,e._vdataUint32=null,e._iaInfo=void 0,e._iaInfoBuffer=void 0,e._subMeshData=null,e._vertCount=0,e._indexCount=0,e._material=null,e.type=lt.LINE,e._capacity=100,e._iaInfo=new ut([new ht]),e._iaInfoBuffer=e._device.createBuffer(new nt(at.INDIRECT,ot.HOST|ot.DEVICE,ct,ct)),e}n(e,t);var i=e.prototype;return i.setCapacity=function(t){this._capacity=t,this.createBuffer()},i.createBuffer=function(){this._vertSize=0;for(var t,e=g(we);!(t=e()).done;){var i=t.value;i.offset=this._vertSize,this._vertSize+=rt[i.format].size}this._vertAttrsFloatCount=this._vertSize/4,this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer)},i.updateMaterial=function(e){this._material=e,t.prototype.setSubModelMaterial.call(this,0,e)},i.createSubMeshData=function(){this._subMeshData&&this.destroySubMeshData(),this._vertCount=2,this._indexCount=6;var t=this._device.createBuffer(new nt(at.VERTEX|at.TRANSFER_DST,ot.HOST|ot.DEVICE,this._vertSize*this._capacity*this._vertCount,this._vertSize)),e=new ArrayBuffer(this._vertSize*this._capacity*this._vertCount);t.update(e);for(var i=new Uint16Array((this._capacity-1)*this._indexCount),r=0,n=0;n<this._capacity-1;++n){var a=2*n;i[r++]=a,i[r++]=a+1,i[r++]=a+2,i[r++]=a+3,i[r++]=a+2,i[r++]=a+1}var o=this._device.createBuffer(new nt(at.INDEX|at.TRANSFER_DST,ot.HOST|ot.DEVICE,(this._capacity-1)*this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));return o.update(i),this._iaInfo.drawInfos[0].vertexCount=this._capacity*this._vertCount,this._iaInfo.drawInfos[0].indexCount=(this._capacity-1)*this._indexCount,this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new st([t],we,q.TRIANGLE_LIST,o,this._iaInfoBuffer),this.initSubModel(0,this._subMeshData,this._material),e},i.addLineVertexData=function(t,e,i){if(t.length>1){var r=0;b.subtract(Me,t[1],t[0]),this._vdataF32[r++]=t[0].x,this._vdataF32[r++]=t[0].y,this._vdataF32[r++]=t[0].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(0,1),this._vdataF32[r++]=0,this._vdataF32[r++]=0,this._vdataF32[r++]=Me.x,this._vdataF32[r++]=Me.y,this._vdataF32[r++]=Me.z,this._vdataUint32[r++]=i.evaluate(0,1)._val,this._vdataF32[r++]=t[0].x,this._vdataF32[r++]=t[0].y,this._vdataF32[r++]=t[0].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(0,1),this._vdataF32[r++]=0,this._vdataF32[r++]=1,this._vdataF32[r++]=Me.x,this._vdataF32[r++]=Me.y,this._vdataF32[r++]=Me.z,this._vdataUint32[r++]=i.evaluate(0,1)._val;for(var n=1;n<t.length-1;n++){b.subtract(Me,t[n-1],t[n]),b.subtract(Te,t[n+1],t[n]),b.subtract(Te,Te,Me);var a=n/t.length;this._vdataF32[r++]=t[n].x,this._vdataF32[r++]=t[n].y,this._vdataF32[r++]=t[n].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(a,1),this._vdataF32[r++]=a,this._vdataF32[r++]=0,this._vdataF32[r++]=Te.x,this._vdataF32[r++]=Te.y,this._vdataF32[r++]=Te.z,this._vdataUint32[r++]=i.evaluate(a,1)._val,this._vdataF32[r++]=t[n].x,this._vdataF32[r++]=t[n].y,this._vdataF32[r++]=t[n].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(a,1),this._vdataF32[r++]=a,this._vdataF32[r++]=1,this._vdataF32[r++]=Te.x,this._vdataF32[r++]=Te.y,this._vdataF32[r++]=Te.z,this._vdataUint32[r++]=i.evaluate(a,1)._val}b.subtract(Me,t[t.length-1],t[t.length-2]),this._vdataF32[r++]=t[t.length-1].x,this._vdataF32[r++]=t[t.length-1].y,this._vdataF32[r++]=t[t.length-1].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(1,1),this._vdataF32[r++]=1,this._vdataF32[r++]=0,this._vdataF32[r++]=Me.x,this._vdataF32[r++]=Me.y,this._vdataF32[r++]=Me.z,this._vdataUint32[r++]=i.evaluate(1,1)._val,this._vdataF32[r++]=t[t.length-1].x,this._vdataF32[r++]=t[t.length-1].y,this._vdataF32[r++]=t[t.length-1].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(1,1),this._vdataF32[r++]=1,this._vdataF32[r++]=1,this._vdataF32[r++]=Me.x,this._vdataF32[r++]=Me.y,this._vdataF32[r++]=Me.z,this._vdataUint32[r++]=i.evaluate(1,1)._val}this.updateIA(Math.max(0,t.length-1))},i.updateIA=function(t){this._subModels[0].inputAssembler.vertexBuffers[0].update(this._vdataF32),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=this._indexCount*t,this._iaInfoBuffer.update(this._iaInfo)},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},e}(tt),Oe=T,xe=w({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),ze=t("CurveRange",(Wt=e("cc.CurveRange"),jt=i(xe),Xt=i(_t),Kt=i(_t),Yt=i(_t),Wt((oe=ae=function(){function t(){o(this,"mode",Qt,this),o(this,"curve",Jt,this),o(this,"curveMin",$t,this),o(this,"curveMax",te,this),o(this,"constant",ee,this),o(this,"constantMin",ie,this),o(this,"constantMax",re,this),o(this,"multiplier",ne,this)}var e=t.prototype;return e.evaluate=function(t,e){switch(this.mode){case xe.Constant:return this.constant;case xe.Curve:return this.curve.evaluate(t)*this.multiplier;case xe.TwoCurves:return M(this.curveMin.evaluate(t),this.curveMax.evaluate(t),e)*this.multiplier;case xe.TwoConstants:return M(this.constantMin,this.constantMax,e)}},e.getMax=function(){switch(this.mode){case xe.Constant:return this.constant;case xe.Curve:return this.multiplier;case xe.TwoConstants:return this.constantMax;case xe.TwoCurves:return this.multiplier}return 0},e._onBeforeSerialize=function(){return Oe[this.mode]},t}(),ae.Mode=xe,Qt=_((qt=oe).prototype,"mode",[jt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xe.Constant}}),Jt=_(qt.prototype,"curve",[Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _t}}),$t=_(qt.prototype,"curveMin",[Kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _t}}),te=_(qt.prototype,"curveMax",[Yt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _t}}),ee=_(qt.prototype,"constant",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ie=_(qt.prototype,"constantMin",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),re=_(qt.prototype,"constantMax",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ne=_(qt.prototype,"multiplier",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Zt=qt))||Zt));function Ee(t,e,i){switch(t.mode){case xe.Constant:return t.constant;case xe.Curve:return t.curve.evaluate(e)*t.multiplier;case xe.TwoCurves:return 0===i?t.curveMin.evaluate(e)*t.multiplier:t.curveMax.evaluate(e)*t.multiplier;case xe.TwoConstants:return 0===i?t.constantMin:t.constantMax;default:return 0}}function Ce(t){switch(t.mode){case xe.TwoConstants:case xe.TwoCurves:return 2;default:return 1}}function Ae(t,e,i){var r=new pt({width:e,height:i,_data:t,_compressed:!1,format:dt.RGBA32F}),n=new Y;return n.setFilters(ft.NEAREST,ft.NEAREST),n.setMipFilter(ft.NONE),n.setWrapMode(mt.CLAMP_TO_EDGE,mt.CLAMP_TO_EDGE,mt.CLAMP_TO_EDGE),n.image=r,n}function Re(t,e,i,r,n){for(var a=Math.max(Ce(e),Ce(i),Ce(r)),o=new Float32Array(t*a*4),s=[e,i,r],l=1/(t-1),u=0;u<a;u++)for(var h=0;h<3;h++)for(var c=s[h],_=0,p=0,d=0;d<t;d++){var f=Ee(c,l*d,u);p=n?f:(_+=f)/(d+1),o[4*d+h]=p}return Ae(o,t,a)}var Fe,De,Pe,Ie,Le,Be,Ue,Ve,ke,Ge,He,Ne,We,je,Xe,Ke,Ye,Ze,qe,Qe,Je,$e,ti,ei,ii,ri,ni,ai,oi,si,li,ui,hi,ci,_i,pi,di,fi,mi,yi,vi,bi,gi,wi,Mi,Ti,Si,Oi,xi,zi,Ei,Ci,Ai,Ri,Fi=w({Blend:0,Fixed:1}),Di=(e("cc.ColorKey")((le=_((se=function(){o(this,"color",le,this),o(this,"time",ue,this)}).prototype,"color",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.WHITE.clone()}}),ue=_(se.prototype,"time",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),se)),e("cc.AlphaKey")((ce=_((he=function(){o(this,"alpha",ce,this),o(this,"time",_e,this)}).prototype,"alpha",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_e=_(he.prototype,"time",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),he)),e("cc.Gradient")((be=ve=function(){function t(){o(this,"colorKeys",fe,this),o(this,"alphaKeys",me,this),o(this,"mode",ye,this),this._color=void 0,this._color=u.WHITE.clone()}var e=t.prototype;return e.setKeys=function(t,e){this.colorKeys=t,this.alphaKeys=e},e.sortKeys=function(){this.colorKeys.length>1&&this.colorKeys.sort((function(t,e){return t.time-e.time})),this.alphaKeys.length>1&&this.alphaKeys.sort((function(t,e){return t.time-e.time}))},e.evaluate=function(t){return this.getRGB(t),this._color._set_a_unsafe(this.getAlpha(t)),this._color},e.randomColor=function(){var t=this.colorKeys[Math.trunc(Math.random()*this.colorKeys.length)],e=this.alphaKeys[Math.trunc(Math.random()*this.alphaKeys.length)];return this._color.set(t.color),this._color._set_a_unsafe(e.alpha),this._color},e.getRGB=function(t){if(!(this.colorKeys.length>1))return 1===this.colorKeys.length?(this._color.set(this.colorKeys[0].color),this._color):(this._color.set(u.WHITE),this._color);t=O(t,1);for(var e=1;e<this.colorKeys.length;++e){var i=this.colorKeys[e-1].time,r=this.colorKeys[e].time;if(t>=i&&t<r){if(this.mode===Fi.Fixed)return this.colorKeys[e].color;var n=(t-i)/(r-i);return u.lerp(this._color,this.colorKeys[e-1].color,this.colorKeys[e].color,n),this._color}}var a=this.colorKeys.length-1;t<this.colorKeys[0].time?u.lerp(this._color,u.BLACK,this.colorKeys[0].color,t/this.colorKeys[0].time):t>this.colorKeys[a].time&&u.lerp(this._color,this.colorKeys[a].color,u.BLACK,(t-this.colorKeys[a].time)/(1-this.colorKeys[a].time))},e.getAlpha=function(t){if(!(this.alphaKeys.length>1))return 1===this.alphaKeys.length?this.alphaKeys[0].alpha:255;t=O(t,1);for(var e=1;e<this.alphaKeys.length;++e){var i=this.alphaKeys[e-1].time,r=this.alphaKeys[e].time;if(t>=i&&t<r){if(this.mode===Fi.Fixed)return this.alphaKeys[e].alpha;var n=(t-i)/(r-i);return M(this.alphaKeys[e-1].alpha,this.alphaKeys[e].alpha,n)}}var a=this.alphaKeys.length-1;return t<this.alphaKeys[0].time?M(255,this.alphaKeys[0].alpha,t/this.alphaKeys[0].time):t>this.alphaKeys[a].time?M(this.alphaKeys[a].alpha,255,(t-this.alphaKeys[a].time)/(1-this.alphaKeys[a].time)):void 0},t}(),ve.Mode=Fi,fe=_((de=be).prototype,"colorKeys",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),me=_(de.prototype,"alphaKeys",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),ye=_(de.prototype,"mode",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fi.Blend}}),pe=de))||pe),Pi=T,Ii=w({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),Li=t("GradientRange",(Fe=e("cc.GradientRange"),De=i(Ii),Pe=i(Di),Ie=i(Di),Le=i(Di),Be=i(Ii),Fe((Ye=Ke=function(){function t(){o(this,"color",ke,this),o(this,"colorMin",Ge,this),o(this,"colorMax",He,this),o(this,"gradient",Ne,this),o(this,"gradientMin",We,this),o(this,"gradientMax",je,this),o(this,"_mode",Xe,this),this._color=u.WHITE.clone()}var e=t.prototype;return e.evaluate=function(t,e){switch(this._mode){case Ii.Color:return this.color;case Ii.TwoColors:return u.lerp(this._color,this.colorMin,this.colorMax,e),this._color;case Ii.RandomColor:return this.gradient.randomColor();case Ii.Gradient:return this.gradient.evaluate(t);case Ii.TwoGradients:return u.lerp(this._color,this.gradientMin.evaluate(t),this.gradientMax.evaluate(t),e),this._color;default:return this.color}},e._onBeforeSerialize=function(){return Pi[this._mode]},a(t,[{key:"mode",get:function(){return this._mode},set:function(t){this._mode=t}}]),t}(),Ke.Mode=Ii,_((Ve=Ye).prototype,"mode",[De],Object.getOwnPropertyDescriptor(Ve.prototype,"mode"),Ve.prototype),ke=_(Ve.prototype,"color",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.WHITE.clone()}}),Ge=_(Ve.prototype,"colorMin",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.WHITE.clone()}}),He=_(Ve.prototype,"colorMax",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.WHITE.clone()}}),Ne=_(Ve.prototype,"gradient",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Di}}),We=_(Ve.prototype,"gradientMin",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Di}}),je=_(Ve.prototype,"gradientMax",[Le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Di}}),Xe=_(Ve.prototype,"_mode",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ii.Color}}),Ue=Ve))||Ue));function Bi(t,e,i){switch(t.mode){case Ii.Color:return t.color;case Ii.TwoColors:return 0===i?t.colorMin:t.colorMax;case Ii.RandomColor:return t.gradient.randomColor();case Ii.Gradient:return t.gradient.evaluate(e);case Ii.TwoGradients:return 0===i?t.gradientMin.evaluate(e):t.gradientMax.evaluate(e);default:return t.color}}var Ui,Vi,ki,Gi,Hi,Ni,Wi,ji,Xi,Ki,Yi,Zi,qi,Qi,Ji,$i,tr,er,ir,rr,nr,ar,or,sr,lr,ur,hr,cr,_r,pr,dr,fr,mr,yr,vr={parent:null,owner:null,subModelIdx:0},br={CC_USE_WORLD_SPACE:!1},gr=function(e){return t({Line:e,LineComponent:e}),e}((Ze=e("cc.Line"),qe=p(),Qe=d(),Je=i(Y),$e=i(Y),ti=z(),ei=f(),ii=z(),ri=f(),ni=i([b]),ai=i([b]),oi=z(),si=f(),li=i(ze),ui=i(ze),hi=z(),ci=f(),_i=i(x),pi=z(),di=f(),fi=i(x),mi=z(),yi=f(),vi=i(Li),bi=i(Li),gi=z(),wi=f(),Ze(Mi=qe(Mi=Qe(Mi=r((Ri=function(t){function e(){var e;return e=t.call(this)||this,o(e,"_texture",Si,s(e)),e._material=null,e._materialInstance=null,o(e,"_worldSpace",Oi,s(e)),o(e,"_positions",xi,s(e)),o(e,"_width",zi,s(e)),o(e,"_tile",Ei,s(e)),o(e,"_offset",Ci,s(e)),o(e,"_color",Ai,s(e)),e._model=null,e._tile_offset=new l,e}n(e,t),a(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._materialInstance&&this._materialInstance.setProperty("mainTexture",t)}},{key:"worldSpace",get:function(){return this._worldSpace},set:function(t){this._worldSpace=t,this._materialInstance&&(br.CC_USE_WORLD_SPACE=this.worldSpace,this._materialInstance.recompileShaders(br),this._model&&this._model.setSubModelMaterial(0,this._materialInstance))}},{key:"positions",get:function(){return this._positions},set:function(t){this._positions=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}},{key:"tile",get:function(){return this._tile},set:function(t){this._tile.set(t),this._materialInstance&&(this._tile_offset.x=this._tile.x,this._tile_offset.y=this._tile.y,this._materialInstance.setProperty("mainTiling_Offset",this._tile_offset))}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t),this._materialInstance&&(this._tile_offset.z=this._offset.x,this._tile_offset.w=this._offset.y,this._materialInstance.setProperty("mainTiling_Offset",this._tile_offset))}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}}]);var i=e.prototype;return i.onLoad=function(){var t=this._model=h.director.root.createModel(Se);t.node=t.transform=this.node,null===this._material&&(this._material=new et,this._material.copy(it.get("default-trail-material")),br.CC_USE_WORLD_SPACE=this.worldSpace,vr.parent=this._material,vr.subModelIdx=0,this._materialInstance=new yt(vr),this._materialInstance.recompileShaders(br)),t.updateMaterial(this._materialInstance),t.setCapacity(100)},i.onEnable=function(){this._model&&(this._attachToScene(),this.texture=this._texture,this.tile=this._tile,this.offset=this._offset,this._model.addLineVertexData(this._positions,this._width,this._color))},i.onDisable=function(){this._model&&this._detachFromScene()},i._attachToScene=function(){this._model&&this.node&&this.node.scene&&(this._model.scene&&this._detachFromScene(),this._getRenderScene().addModel(this._model))},i._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},e}(c),Si=_((Ti=Ri).prototype,"_texture",[Je],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(Ti.prototype,"texture",[$e,ti,ei],Object.getOwnPropertyDescriptor(Ti.prototype,"texture"),Ti.prototype),Oi=_(Ti.prototype,"_worldSpace",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_(Ti.prototype,"worldSpace",[ii,ri],Object.getOwnPropertyDescriptor(Ti.prototype,"worldSpace"),Ti.prototype),xi=_(Ti.prototype,"_positions",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_(Ti.prototype,"positions",[ai,oi,si],Object.getOwnPropertyDescriptor(Ti.prototype,"positions"),Ti.prototype),zi=_(Ti.prototype,"_width",[li],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),_(Ti.prototype,"width",[ui,hi,ci],Object.getOwnPropertyDescriptor(Ti.prototype,"width"),Ti.prototype),Ei=_(Ti.prototype,"_tile",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new x(1,1)}}),_(Ti.prototype,"tile",[_i,pi,di],Object.getOwnPropertyDescriptor(Ti.prototype,"tile"),Ti.prototype),Ci=_(Ti.prototype,"_offset",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new x(0,0)}}),_(Ti.prototype,"offset",[fi,mi,yi],Object.getOwnPropertyDescriptor(Ti.prototype,"offset"),Ti.prototype),Ai=_(Ti.prototype,"_color",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Li}}),_(Ti.prototype,"color",[bi,gi,wi],Object.getOwnPropertyDescriptor(Ti.prototype,"color"),Ti.prototype),Mi=Ti))||Mi)||Mi)||Mi)||Mi)),wr=function(t){this.particleSystem=void 0,this.position=void 0,this.velocity=void 0,this.animatedVelocity=void 0,this.ultimateVelocity=void 0,this.angularVelocity=void 0,this.axisOfRotation=void 0,this.rotation=void 0,this.startSize=void 0,this.size=void 0,this.startColor=void 0,this.color=void 0,this.randomSeed=void 0,this.remainingLifetime=void 0,this.startLifetime=void 0,this.emitAccumulator0=void 0,this.emitAccumulator1=void 0,this.frameIndex=void 0,this.startRow=void 0,this.particleSystem=t,this.position=new b(0,0,0),this.velocity=new b(0,0,0),this.animatedVelocity=new b(0,0,0),this.ultimateVelocity=new b(0,0,0),this.angularVelocity=new b(0,0,0),this.axisOfRotation=new b(0,0,0),this.rotation=new b(0,0,0),this.startSize=new b(0,0,0),this.size=new b(0,0,0),this.startColor=u.WHITE.clone(),this.color=u.WHITE.clone(),this.randomSeed=0,this.remainingLifetime=0,this.startLifetime=0,this.emitAccumulator0=0,this.emitAccumulator1=0,this.frameIndex=0,this.startRow=0},Mr=["sizeModule","colorModule","forceModule","velocityModule","limitModule","rotationModule","textureModule"],Tr=["_colorOverLifetimeModule","_shapeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule","_trailModule"],Sr=function(){function t(){this.target=null,this.needUpdate=!1,this.needAnimate=!0,this.name=void 0}var e=t.prototype;return e.bindTarget=function(t){this.target=t},e.update=function(){},t}(),Or=w({World:0,Local:1,Custom:2}),xr=w({Billboard:0,StrecthedBillboard:1,HorizontalBillboard:2,VerticalBillboard:3,Mesh:4}),zr=w({Box:0,Circle:1,Cone:2,Sphere:3,Hemisphere:4}),Er=w({Base:0,Edge:1,Shell:2,Volume:3}),Cr=w({Random:0,Loop:1,PingPong:2}),Ar=w({Particles:0}),Rr=w({Stretch:0}),Fr=(Ui=e("cc.ColorOvertimeModule"),Vi=z(),ki=i(Li),Gi=z(),Ui((Xi=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,o(e,"_enable",Wi,s(e)),o(e,"color",ji,s(e)),e.name="colorModule",e}return n(e,t),e.prototype.animate=function(t){t.color.set(t.startColor),t.color.multiply(this.color.evaluate(1-t.remainingLifetime/t.startLifetime,E(t.randomSeed+91041)))},a(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(Sr),Wi=_((Ni=Xi).prototype,"_enable",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_(Ni.prototype,"enable",[Vi],Object.getOwnPropertyDescriptor(Ni.prototype,"enable"),Ni.prototype),ji=_(Ni.prototype,"color",[ki,v,Gi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Li}}),Hi=Ni))||Hi),Dr=new b(0,0,-1);function Pr(t,e,i,r){return e!==t?(t===Or.World||A.invert(i,i),A.getRotation(r,i),!0):(R.set(r,0,0,0,1),!1)}function Ir(t,e){x.set(t,Math.cos(e),Math.sin(e))}function Lr(t){var e=D(-1,1),i=D(0,2*Math.PI),r=Math.sqrt(1-e*e),n=r*Math.cos(i),a=r*Math.sin(i);b.set(t,n,a,e)}function Br(t,e,i){Lr(t),b.multiplyScalar(t,t,e+(i-e)*F())}function Ur(t,e,i,r){Ir(t,r),t.z=0,b.multiplyScalar(t,t,e+(i-e)*F())}function Vr(t){for(var e=0;e<t.length;e++){var i=e+P(0,t.length-e),r=t[i];t[i]=t[e],t[e]=r}}function kr(){var t=D(-1,1);return 0===t&&t++,C(t)}var Gr,Hr,Nr,Wr,jr,Xr,Kr,Yr,Zr,qr,Qr,Jr,$r,tn,en,rn,nn,an,on,sn,ln,un,hn,cn,_n,pn,dn,fn,mn,yn,vn,bn,gn,wn,Mn,Tn,Sn,On,xn,zn,En,Cn,An,Rn,Fn,Dn,Pn,In,Ln,Bn,Un,Vn,kn,Gn,Hn,Nn,Wn,jn,Xn,Kn,Yn=new b,Zn=(Ki=e("cc.ForceOvertimeModule"),Yi=z(),Zi=i(ze),qi=I(),Qi=z(),Ji=f(),$i=i(ze),tr=I(),er=z(),ir=f(),rr=i(ze),nr=I(),ar=z(),or=f(),sr=i(Or),lr=z(),ur=f(),Ki((yr=function(t){function e(){var e;return e=t.call(this)||this,o(e,"_enable",_r,s(e)),o(e,"x",pr,s(e)),o(e,"y",dr,s(e)),o(e,"z",fr,s(e)),o(e,"space",mr,s(e)),e.randomized=!1,e.rotation=void 0,e.needTransform=void 0,e.name="forceModule",e.rotation=new R,e.needTransform=!1,e.needUpdate=!0,e}n(e,t),a(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]);var i=e.prototype;return i.update=function(t,e){this.needTransform=Pr(t,this.space,e,this.rotation)},i.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime,r=b.set(Yn,this.x.evaluate(i,E(t.randomSeed+212165)),this.y.evaluate(i,E(t.randomSeed+212165)),this.z.evaluate(i,E(t.randomSeed+212165)));this.needTransform&&b.transformQuat(r,r,this.rotation),b.scaleAndAdd(t.velocity,t.velocity,r,e),b.copy(t.ultimateVelocity,t.velocity)},e}(Sr),_r=_((cr=yr).prototype,"_enable",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_(cr.prototype,"enable",[Yi],Object.getOwnPropertyDescriptor(cr.prototype,"enable"),cr.prototype),pr=_(cr.prototype,"x",[Zi,v,qi,Qi,Ji],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),dr=_(cr.prototype,"y",[$i,v,tr,er,ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),fr=_(cr.prototype,"z",[rr,v,nr,ar,or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),mr=_(cr.prototype,"space",[sr,v,lr,ur],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Or.Local}}),hr=cr))||hr),qn=new b,Qn=new b,Jn=(Gr=e("cc.LimitVelocityOvertimeModule"),Hr=z(),Nr=i(ze),Wr=I(),jr=z(),Xr=f(),Kr=i(ze),Yr=I(),Zr=z(),qr=f(),Qr=i(ze),Jr=I(),$r=z(),tn=f(),en=i(ze),rn=I(),nn=z(),an=f(),on=z(),sn=f(),ln=z(),un=f(),hn=i(Or),cn=z(),_n=f(),Gr((Tn=function(t){function e(){var e;return e=t.call(this)||this,o(e,"_enable",fn,s(e)),o(e,"limitX",mn,s(e)),o(e,"limitY",yn,s(e)),o(e,"limitZ",vn,s(e)),o(e,"limit",bn,s(e)),o(e,"dampen",gn,s(e)),o(e,"separateAxes",wn,s(e)),o(e,"space",Mn,s(e)),e.drag=null,e.multiplyDragByParticleSize=!1,e.multiplyDragByParticleVelocity=!1,e.name="limitModule",e.rotation=void 0,e.needTransform=void 0,e.rotation=new R,e.needTransform=!1,e.needUpdate=!0,e}n(e,t),a(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]);var i=e.prototype;return i.update=function(t,e){this.needTransform=Pr(t,this.space,e,this.rotation)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=qn;this.separateAxes?(b.set(Qn,this.limitX.evaluate(e,E(t.randomSeed+23541)),this.limitY.evaluate(e,E(t.randomSeed+23541)),this.limitZ.evaluate(e,E(t.randomSeed+23541))),this.needTransform&&b.transformQuat(Qn,Qn,this.rotation),b.set(i,$n(t.ultimateVelocity.x,Qn.x,this.dampen),$n(t.ultimateVelocity.y,Qn.y,this.dampen),$n(t.ultimateVelocity.z,Qn.z,this.dampen))):(b.normalize(i,t.ultimateVelocity),b.multiplyScalar(i,i,$n(t.ultimateVelocity.length(),this.limit.evaluate(e,E(t.randomSeed+23541)),this.dampen))),b.copy(t.ultimateVelocity,i)},e}(Sr),fn=_((dn=Tn).prototype,"_enable",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_(dn.prototype,"enable",[Hr],Object.getOwnPropertyDescriptor(dn.prototype,"enable"),dn.prototype),mn=_(dn.prototype,"limitX",[Nr,v,Wr,jr,Xr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),yn=_(dn.prototype,"limitY",[Kr,v,Yr,Zr,qr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),vn=_(dn.prototype,"limitZ",[Qr,v,Jr,$r,tn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),bn=_(dn.prototype,"limit",[en,v,rn,nn,an],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),gn=_(dn.prototype,"dampen",[v,on,sn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),wn=_(dn.prototype,"separateAxes",[v,ln,un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mn=_(dn.prototype,"space",[hn,v,cn,_n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Or.Local}}),pn=dn))||pn);function $n(t,e,i){var r=Math.sign(t),n=Math.abs(t);return n>e&&(n=M(n,e,i)),n*r}var ta,ea,ia,ra,na,aa,oa,sa,la,ua,ha,ca,_a,pa,da,fa,ma,ya,va,ba,ga,wa,Ma,Ta,Sa,Oa,xa,za,Ea,Ca,Aa,Ra,Fa,Da,Pa,Ia,La,Ba,Ua,Va,ka,Ga,Ha,Na,Wa,ja,Xa,Ka,Ya,Za,qa,Qa,Ja,$a,to,eo,io,ro,no,ao,oo,so,lo,uo,ho,co,_o,po,fo,mo,yo,vo,bo,go,wo,Mo,To,So,Oo,xo,zo,Eo,Co,Ao,Ro,Fo,Do,Po,Io,Lo,Bo,Uo,Vo,ko,Go,Ho,No,Wo,jo,Xo,Ko,Yo,Zo,qo,Qo,Jo,$o,ts,es,is,rs,ns,as,os,ss,ls,us,hs,cs,_s,ps,ds,fs,ms,ys,vs,bs,gs,ws,Ms,Ts,Ss,Os,xs,zs,Es,Cs,As,Rs,Fs,Ds,Ps,Is,Ls,Bs,Us,Vs,ks,Gs,Hs,Ns,Ws,js,Xs,Ks,Ys,Zs,qs,Qs,Js,$s,tl,el,il,rl,nl,al,ol,sl,ll,ul,hl,cl,_l=(Sn=e("cc.RotationOvertimeModule"),On=z(),xn=z(),zn=f(),En=i(ze),Cn=I(),An=z(),Rn=f(),Fn=i(ze),Dn=I(),Pn=z(),In=f(),Ln=i(ze),Bn=I(),Un=z(),Vn=f(),Sn((Kn=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,o(e,"_enable",Hn,s(e)),o(e,"_separateAxes",Nn,s(e)),o(e,"x",Wn,s(e)),o(e,"y",jn,s(e)),o(e,"z",Xn,s(e)),e.name="rotationModule",e}return n(e,t),e.prototype.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime;if(this._separateAxes){var r=E(t.randomSeed+125292);t.rotation.x+=this.x.evaluate(i,r)*e,t.rotation.y+=this.y.evaluate(i,r)*e,t.rotation.z+=this.z.evaluate(i,r)*e}else t.rotation.z+=this.z.evaluate(i,E(t.randomSeed+125292))*e},a(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}},{key:"separateAxes",get:function(){return this._separateAxes},set:function(t){this._separateAxes=t}}]),e}(Sr),Hn=_((Gn=Kn).prototype,"_enable",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_(Gn.prototype,"enable",[On],Object.getOwnPropertyDescriptor(Gn.prototype,"enable"),Gn.prototype),Nn=_(Gn.prototype,"_separateAxes",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_(Gn.prototype,"separateAxes",[xn,zn],Object.getOwnPropertyDescriptor(Gn.prototype,"separateAxes"),Gn.prototype),Wn=_(Gn.prototype,"x",[En,v,Cn,L,An,Rn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),jn=_(Gn.prototype,"y",[Fn,v,Dn,L,Pn,In],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),Xn=_(Gn.prototype,"z",[Ln,v,Bn,L,Un,Vn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),kn=Gn))||kn),pl=(ta=e("cc.SizeOvertimeModule"),ea=z(),ia=z(),ra=f(),na=i(ze),aa=z(),oa=f(),sa=i(ze),la=z(),ua=f(),ha=i(ze),ca=z(),_a=f(),pa=i(ze),da=z(),fa=f(),ta((Sa=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,o(e,"_enable",va,s(e)),o(e,"separateAxes",ba,s(e)),o(e,"size",ga,s(e)),o(e,"x",wa,s(e)),o(e,"y",Ma,s(e)),o(e,"z",Ta,s(e)),e.name="sizeModule",e}return n(e,t),e.prototype.animate=function(t){if(this.separateAxes){var e=1-t.remainingLifetime/t.startLifetime,i=E(t.randomSeed+39825);t.size.x=t.startSize.x*this.x.evaluate(e,i),t.size.y=t.startSize.y*this.y.evaluate(e,i),t.size.z=t.startSize.z*this.z.evaluate(e,i)}else b.multiplyScalar(t.size,t.startSize,this.size.evaluate(1-t.remainingLifetime/t.startLifetime,E(t.randomSeed+39825)))},a(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(Sr),va=_((ya=Sa).prototype,"_enable",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_(ya.prototype,"enable",[ea],Object.getOwnPropertyDescriptor(ya.prototype,"enable"),ya.prototype),ba=_(ya.prototype,"separateAxes",[v,ia,ra],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ga=_(ya.prototype,"size",[na,v,aa,oa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),wa=_(ya.prototype,"x",[sa,v,la,ua],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),Ma=_(ya.prototype,"y",[ha,v,ca,_a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),Ta=_(ya.prototype,"z",[pa,v,da,fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),ma=ya))||ma),dl=w({Grid:0}),fl=w({WholeSheet:0,SingleRow:1}),ml=(Oa=e("cc.TextureAnimationModule"),xa=B("numTilesX"),za=B("numTilesY"),Ea=z(),Ca=i(dl),Aa=i(dl),Ra=z(),Fa=f(),Da=z(),Pa=f(),Ia=z(),La=f(),Ba=i(fl),Ua=z(),Va=f(),ka=i(ze),Ga=z(),Ha=f(),Na=i(ze),Wa=z(),ja=f(),Xa=z(),Ka=f(),Ya=z(),Za=f(),qa=z(),Qa=f(),Oa((po=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,o(e,"_enable",to,s(e)),o(e,"_numTilesX",eo,s(e)),o(e,"_numTilesY",io,s(e)),o(e,"_mode",ro,s(e)),o(e,"animation",no,s(e)),o(e,"frameOverTime",ao,s(e)),o(e,"startFrame",oo,s(e)),o(e,"cycleCount",so,s(e)),o(e,"_flipU",lo,s(e)),o(e,"_flipV",uo,s(e)),o(e,"_uvChannelMask",ho,s(e)),o(e,"randomRow",co,s(e)),o(e,"rowIndex",_o,s(e)),e.name="textureModule",e}n(e,t);var i=e.prototype;return i.init=function(t){t.startRow=Math.floor(Math.random()*this.numTilesY)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=this.startFrame.evaluate(e,E(t.randomSeed+90794))/(this.numTilesX*this.numTilesY);if(this.animation===fl.WholeSheet)t.frameIndex=O(this.cycleCount*(this.frameOverTime.evaluate(e,E(t.randomSeed+90794))+i),1);else if(this.animation===fl.SingleRow){var r=1/this.numTilesY;if(this.randomRow){var n=O(this.cycleCount*(this.frameOverTime.evaluate(e,E(t.randomSeed+90794))+i),1),a=t.startRow*r,o=a+r;t.frameIndex=M(a,o,n)}else{var s=this.rowIndex*r,l=s+r;t.frameIndex=M(s,l,O(this.cycleCount*(this.frameOverTime.evaluate(e,E(t.randomSeed+90794))+i),1))}}},a(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&(this.target.updateMaterialParams(),this.target.enableModule(this.name,t,this)))}},{key:"mode",get:function(){return this._mode},set:function(t){t===dl.Grid||console.error("particle texture animation's sprites is not supported!")}},{key:"numTilesX",get:function(){return this._numTilesX},set:function(t){this._numTilesX!==t&&(this._numTilesX=t,this.target.updateMaterialParams())}},{key:"numTilesY",get:function(){return this._numTilesY},set:function(t){this._numTilesY!==t&&(this._numTilesY=t,this.target.updateMaterialParams())}},{key:"flipU",get:function(){return this._flipU},set:function(){console.error("particle texture animation's flipU is not supported!")}},{key:"flipV",get:function(){return this._flipV},set:function(){console.error("particle texture animation's flipV is not supported!")}},{key:"uvChannelMask",get:function(){return this._uvChannelMask},set:function(){console.error("particle texture animation's uvChannelMask is not supported!")}}]),e}(Sr),to=_(($a=po).prototype,"_enable",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),eo=_($a.prototype,"_numTilesX",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),io=_($a.prototype,"_numTilesY",[za],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_($a.prototype,"enable",[Ea],Object.getOwnPropertyDescriptor($a.prototype,"enable"),$a.prototype),ro=_($a.prototype,"_mode",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dl.Grid}}),_($a.prototype,"mode",[Aa,Ra,Fa],Object.getOwnPropertyDescriptor($a.prototype,"mode"),$a.prototype),_($a.prototype,"numTilesX",[Da,Pa],Object.getOwnPropertyDescriptor($a.prototype,"numTilesX"),$a.prototype),_($a.prototype,"numTilesY",[Ia,La],Object.getOwnPropertyDescriptor($a.prototype,"numTilesY"),$a.prototype),no=_($a.prototype,"animation",[Ba,v,Ua,Va],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fl.WholeSheet}}),ao=_($a.prototype,"frameOverTime",[ka,v,Ga,Ha],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),oo=_($a.prototype,"startFrame",[Na,v,Wa,ja],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),so=_($a.prototype,"cycleCount",[v,Xa,Ka],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lo=_($a.prototype,"_flipU",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uo=_($a.prototype,"_flipV",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ho=_($a.prototype,"_uvChannelMask",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),co=_($a.prototype,"randomRow",[v,Ya,Za],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_o=_($a.prototype,"rowIndex",[v,qa,Qa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ja=$a))||Ja),yl=new b,vl=(fo=e("cc.VelocityOvertimeModule"),mo=z(),yo=i(ze),vo=I(),bo=z(),go=f(),wo=i(ze),Mo=I(),To=z(),So=f(),Oo=i(ze),xo=I(),zo=z(),Eo=f(),Co=i(ze),Ao=I(),Ro=z(),Fo=f(),Do=i(Or),Po=z(),Io=f(),fo((Wo=function(t){function e(){var e;return e=t.call(this)||this,o(e,"_enable",Uo,s(e)),o(e,"x",Vo,s(e)),o(e,"y",ko,s(e)),o(e,"z",Go,s(e)),o(e,"speedModifier",Ho,s(e)),o(e,"space",No,s(e)),e.rotation=void 0,e.needTransform=void 0,e.name="velocityModule",e.rotation=new R,e.speedModifier.constant=1,e.needTransform=!1,e.needUpdate=!0,e}n(e,t),a(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]);var i=e.prototype;return i.update=function(t,e){this.needTransform=Pr(t,this.space,e,this.rotation)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=b.set(yl,this.x.evaluate(e,E(197866^t.randomSeed)),this.y.evaluate(e,E(156497^t.randomSeed)),this.z.evaluate(e,E(984136^t.randomSeed)));this.needTransform&&b.transformQuat(i,i,this.rotation),b.add(t.animatedVelocity,t.animatedVelocity,i),b.add(t.ultimateVelocity,t.velocity,t.animatedVelocity),b.multiplyScalar(t.ultimateVelocity,t.ultimateVelocity,this.speedModifier.evaluate(1-t.remainingLifetime/t.startLifetime,E(t.randomSeed+197866)))},e}(Sr),Uo=_((Bo=Wo).prototype,"_enable",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_(Bo.prototype,"enable",[mo],Object.getOwnPropertyDescriptor(Bo.prototype,"enable"),Bo.prototype),Vo=_(Bo.prototype,"x",[yo,v,vo,bo,go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),ko=_(Bo.prototype,"y",[wo,v,Mo,To,So],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),Go=_(Bo.prototype,"z",[Oo,v,xo,zo,Eo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),Ho=_(Bo.prototype,"speedModifier",[Co,v,Ao,Ro,Fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),No=_(Bo.prototype,"space",[Do,v,Po,Io],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Or.Local}}),Lo=Bo))||Lo),bl=(jo=e("cc.Burst"),Xo=i(ze),jo(($o=function(){function t(){o(this,"_time",Zo,this),o(this,"_repeatCount",qo,this),o(this,"repeatInterval",Qo,this),o(this,"count",Jo,this),this._remainingCount=void 0,this._curTime=void 0,this._remainingCount=0,this._curTime=0}a(t,[{key:"time",get:function(){return this._time},set:function(t){this._time=t,this._curTime=t}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t,this._remainingCount=t}}]);var e=t.prototype;return e.update=function(t,e){if(0===this._remainingCount&&(this._remainingCount=this._repeatCount,this._curTime=this._time),this._remainingCount>0){var i=O(t._time-t.startDelay.evaluate(0,1),t.duration)-e;i=i>0?i:0;var r=O(t.time-t.startDelay.evaluate(0,1),t.duration);this._curTime>=i&&this._curTime<r&&(t.emit(this.count.evaluate(this._curTime/t.duration,1),e-(r-this._curTime)),this._curTime+=this.repeatInterval,--this._remainingCount)}},e.getMaxCount=function(t){return this.count.getMax()*Math.min(Math.ceil(t.duration/this.repeatInterval),this.repeatCount)},t}(),Zo=_((Yo=$o).prototype,"_time",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_(Yo.prototype,"time",[S],Object.getOwnPropertyDescriptor(Yo.prototype,"time"),Yo.prototype),qo=_(Yo.prototype,"_repeatCount",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_(Yo.prototype,"repeatCount",[S],Object.getOwnPropertyDescriptor(Yo.prototype,"repeatCount"),Yo.prototype),Qo=_(Yo.prototype,"repeatInterval",[v,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Jo=_(Yo.prototype,"count",[Xo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),Ko=Yo))||Ko),gl=new b(0,0,0),wl=new Array,Ml=new b(.5,.5,.5),Tl=(ts=e("cc.ShapeModule"),es=z(),is=f(),rs=z(),ns=f(),as=z(),os=f(),ss=z(),ls=f(),us=z(),hs=f(),cs=z(),_s=i(zr),ps=B("shapeType"),ds=z(),fs=i(zr),ms=f(),ys=i(Er),vs=z(),bs=f(),gs=z(),ws=f(),Ms=z(),Ts=f(),Ss=z(),Os=f(),xs=z(),zs=f(),Es=z(),Cs=f(),As=z(),Rs=f(),Fs=i(Cr),Ds=z(),Ps=f(),Is=z(),Ls=f(),Bs=i(ze),Us=z(),Vs=f(),ks=z(),Gs=f(),Hs=z(),Ns=f(),ts((cl=function(){function t(){o(this,"_enable",Xs,this),o(this,"_shapeType",Ks,this),o(this,"emitFrom",Ys,this),o(this,"alignToDirection",Zs,this),o(this,"randomDirectionAmount",qs,this),o(this,"sphericalDirectionAmount",Qs,this),o(this,"randomPositionAmount",Js,this),o(this,"radius",$s,this),o(this,"radiusThickness",tl,this),o(this,"arcMode",el,this),o(this,"arcSpread",il,this),o(this,"arcSpeed",rl,this),o(this,"length",nl,this),o(this,"boxThickness",al,this),o(this,"_position",ol,this),o(this,"_rotation",sl,this),o(this,"_scale",ll,this),o(this,"_arc",ul,this),o(this,"_angle",hl,this),this.mat=void 0,this.quat=void 0,this.particleSystem=void 0,this.lastTime=void 0,this.totalAngle=void 0,this.mat=new A,this.quat=new R,this.particleSystem=null,this.lastTime=0,this.totalAngle=0}a(t,[{key:"position",get:function(){return this._position},set:function(t){this._position=t,this.constructMat()}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.constructMat()}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t,this.constructMat()}},{key:"arc",get:function(){return m(this._arc)},set:function(t){this._arc=y(t)}},{key:"angle",get:function(){return Math.round(100*m(this._angle))/100},set:function(t){this._angle=y(t)}},{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"shapeType",get:function(){return this._shapeType},set:function(t){switch(this._shapeType=t,this._shapeType){case zr.Box:this.emitFrom===Er.Base&&(this.emitFrom=Er.Volume);break;case zr.Cone:this.emitFrom===Er.Edge&&(this.emitFrom=Er.Base);break;case zr.Sphere:case zr.Hemisphere:this.emitFrom!==Er.Base&&this.emitFrom!==Er.Edge||(this.emitFrom=Er.Volume)}}}]);var e=t.prototype;return e.onInit=function(t){this.particleSystem=t,this.constructMat(),this.lastTime=this.particleSystem._time},e.emit=function(t){switch(this.shapeType){case zr.Box:!function(t,e,i,r){switch(t){case Er.Volume:n=i,a=Ml,b.set(n,D(-a.x,a.x),D(-a.y,a.y),D(-a.z,a.z));break;case Er.Shell:wl.splice(0,wl.length),wl.push(D(-.5,.5)),wl.push(D(-.5,.5)),wl.push(.5*kr()),Vr(wl),Sl(wl,e),b.set(i,wl[0],wl[1],wl[2]);break;case Er.Edge:wl.splice(0,wl.length),wl.push(D(-.5,.5)),wl.push(.5*kr()),wl.push(.5*kr()),Vr(wl),Sl(wl,e),b.set(i,wl[0],wl[1],wl[2]);break;default:console.warn(t+" is not supported for box emitter.")}var n,a;b.copy(r,Dr)}(this.emitFrom,this.boxThickness,t.position,t.velocity);break;case zr.Circle:e=this.radius,i=this.radiusThickness,r=this.generateArcAngle(),n=t.position,a=t.velocity,Ur(n,e*(1-i),e,r),b.normalize(a,n);break;case zr.Cone:!function(t,e,i,r,n,a,o,s){switch(t){case Er.Base:Ur(o,e*(1-i),e,r),x.multiplyScalar(s,o,Math.sin(n)),s.z=-Math.cos(n)*e,b.normalize(s,s),o.z=0;break;case Er.Shell:Ir(o,r),x.multiplyScalar(s,o,Math.sin(n)),s.z=-Math.cos(n),b.normalize(s,s),x.multiplyScalar(o,o,e),o.z=0;break;case Er.Volume:Ur(o,e*(1-i),e,r),x.multiplyScalar(s,o,Math.sin(n)),s.z=-Math.cos(n)*e,b.normalize(s,s),o.z=0,b.add(o,o,b.multiplyScalar(gl,s,a*F()/-s.z));break;default:console.warn(t+" is not supported for cone emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,this.generateArcAngle(),this._angle,this.length,t.position,t.velocity);break;case zr.Sphere:!function(t,e,i,r,n){switch(t){case Er.Volume:Br(r,e*(1-i),e),b.normalize(n,r);break;case Er.Shell:Lr(r),b.multiplyScalar(r,r,e),b.normalize(n,r);break;default:console.warn(t+" is not supported for sphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;case zr.Hemisphere:!function(t,e,i,r,n){switch(t){case Er.Volume:Br(r,e*(1-i),e),r.z>0&&(r.z*=-1),b.normalize(n,r);break;case Er.Shell:Lr(r),b.multiplyScalar(r,r,e),r.z>0&&(r.z*=-1),b.normalize(n,r);break;default:console.warn(t+" is not supported for hemisphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;default:console.warn(this.shapeType+" shapeType is not supported by ShapeModule.")}var e,i,r,n,a;if(this.randomPositionAmount>0&&(t.position.x+=D(-this.randomPositionAmount,this.randomPositionAmount),t.position.y+=D(-this.randomPositionAmount,this.randomPositionAmount),t.position.z+=D(-this.randomPositionAmount,this.randomPositionAmount)),b.transformQuat(t.velocity,t.velocity,this.quat),b.transformMat4(t.position,t.position,this.mat),this.sphericalDirectionAmount>0){var o=b.normalize(gl,t.position);b.lerp(t.velocity,t.velocity,o,this.sphericalDirectionAmount)}this.lastTime=this.particleSystem._time},e.constructMat=function(){R.fromEuler(this.quat,this._rotation.x,this._rotation.y,this._rotation.z),A.fromRTS(this.mat,this.quat,this._position,this._scale)},e.generateArcAngle=function(){if(this.arcMode===Cr.Random)return D(0,this._arc);var t=this.totalAngle+2*Math.PI*this.arcSpeed.evaluate(this.particleSystem._time,1)*(this.particleSystem._time-this.lastTime);switch(this.totalAngle=t,0!==this.arcSpread&&(t=Math.floor(t/(this._arc*this.arcSpread))*this._arc*this.arcSpread),this.arcMode){case Cr.Loop:return O(t,this._arc);case Cr.PingPong:return U(t,this._arc)}},t}(),_((js=cl).prototype,"position",[es,is],Object.getOwnPropertyDescriptor(js.prototype,"position"),js.prototype),_(js.prototype,"rotation",[rs,ns],Object.getOwnPropertyDescriptor(js.prototype,"rotation"),js.prototype),_(js.prototype,"scale",[as,os],Object.getOwnPropertyDescriptor(js.prototype,"scale"),js.prototype),_(js.prototype,"arc",[ss,ls],Object.getOwnPropertyDescriptor(js.prototype,"arc"),js.prototype),_(js.prototype,"angle",[us,hs],Object.getOwnPropertyDescriptor(js.prototype,"angle"),js.prototype),Xs=_(js.prototype,"_enable",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_(js.prototype,"enable",[cs],Object.getOwnPropertyDescriptor(js.prototype,"enable"),js.prototype),Ks=_(js.prototype,"_shapeType",[_s,ps,ds],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zr.Cone}}),_(js.prototype,"shapeType",[fs,ms],Object.getOwnPropertyDescriptor(js.prototype,"shapeType"),js.prototype),Ys=_(js.prototype,"emitFrom",[ys,v,vs,bs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Er.Volume}}),Zs=_(js.prototype,"alignToDirection",[v,gs,ws],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qs=_(js.prototype,"randomDirectionAmount",[v,Ms,Ts],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Qs=_(js.prototype,"sphericalDirectionAmount",[v,Ss,Os],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Js=_(js.prototype,"randomPositionAmount",[v,xs,zs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$s=_(js.prototype,"radius",[v,Es,Cs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),tl=_(js.prototype,"radiusThickness",[v,As,Rs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),el=_(js.prototype,"arcMode",[Fs,v,Ds,Ps],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cr.Random}}),il=_(js.prototype,"arcSpread",[v,Is,Ls],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rl=_(js.prototype,"arcSpeed",[Bs,v,Us,Vs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),nl=_(js.prototype,"length",[v,ks,Gs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),al=_(js.prototype,"boxThickness",[v,Hs,Ns],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new b(0,0,0)}}),ol=_(js.prototype,"_position",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new b(0,0,0)}}),sl=_(js.prototype,"_rotation",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new b(0,0,0)}}),ll=_(js.prototype,"_scale",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new b(1,1,1)}}),ul=_(js.prototype,"_arc",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return y(360)}}),hl=_(js.prototype,"_angle",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return y(25)}}),Ws=js))||Ws);function Sl(t,e){e.x>0&&(t[0]+=.5*D(-e.x,e.x),t[0]=V(t[0],-.5,.5)),e.y>0&&(t[1]+=.5*D(-e.y,e.y),t[1]=V(t[1],-.5,.5)),e.z>0&&(t[2]+=.5*D(-e.z,e.z),t[2]=V(t[2],-.5,.5))}var Ol,xl,zl,El,Cl,Al,Rl,Fl,Dl,Pl,Il,Ll,Bl,Ul,Vl,kl,Gl,Hl,Nl,Wl,jl,Xl,Kl,Yl,Zl,ql,Ql,Jl,$l,tu=[0,0,1,0,0,1,1,1],eu=function(t){function e(){var e;return(e=t.call(this)||this)._capacity=void 0,e._vertAttrs=void 0,e._vertSize=void 0,e._vBuffer=void 0,e._vertAttrsFloatCount=void 0,e._vdataF32=void 0,e._vdataUint32=void 0,e._iaInfo=void 0,e._iaInfoBuffer=void 0,e._subMeshData=void 0,e._mesh=void 0,e._vertCount=0,e._indexCount=0,e._startTimeOffset=0,e._lifeTimeOffset=0,e._material=null,e.type=lt.PARTICLE_BATCH,e._capacity=0,e._vertAttrs=null,e._vertSize=0,e._vBuffer=null,e._vertAttrsFloatCount=0,e._vdataF32=null,e._vdataUint32=null,e._iaInfo=new ut([new ht]),e._iaInfoBuffer=e._device.createBuffer(new nt(at.INDIRECT,ot.HOST|ot.DEVICE,ct,ct)),e._subMeshData=null,e._mesh=null,e}n(e,t);var i=e.prototype;return i.setCapacity=function(t){var e=this._capacity!==t;this._capacity=t,this._subMeshData&&e&&this.rebuild()},i.setVertexAttributes=function(t,e){if(this._mesh!==t||this._vertAttrs!==e){this._mesh=t,this._vertAttrs=e,this._vertSize=0;for(var i,r=g(this._vertAttrs);!(i=r()).done;){var n=i.value;n.offset=this._vertSize,this._vertSize+=rt[n.format].size}this._vertAttrsFloatCount=this._vertSize/4,this.rebuild()}},i.createSubMeshData=function(){this.destroySubMeshData(),this._vertCount=4,this._indexCount=6,this._mesh&&(this._vertCount=this._mesh.struct.vertexBundles[this._mesh.struct.primitives[0].vertexBundelIndices[0]].view.count,this._indexCount=this._mesh.struct.primitives[0].indexView.count);var t=this._device.createBuffer(new nt(at.VERTEX|at.TRANSFER_DST,ot.HOST|ot.DEVICE,this._vertSize*this._capacity*this._vertCount,this._vertSize)),e=new ArrayBuffer(this._vertSize*this._capacity*this._vertCount);if(this._mesh){var i=this._vertAttrs.findIndex((function(t){return t.name===J.ATTR_TEX_COORD3})),r=this._vertAttrs[i++].offset;if(this._mesh.copyAttribute(0,J.ATTR_POSITION,e,this._vertSize,r),r=this._vertAttrs[i++].offset,this._mesh.copyAttribute(0,J.ATTR_NORMAL,e,this._vertSize,r),r=this._vertAttrs[this._vertAttrs.findIndex((function(t){return t.name===J.ATTR_TEX_COORD}))].offset,this._mesh.copyAttribute(0,J.ATTR_TEX_COORD,e,this._vertSize,r),r=this._vertAttrs[i++].offset,!this._mesh.copyAttribute(0,J.ATTR_COLOR,e,this._vertSize,r))for(var n=new Uint32Array(e),a=0;a<this._vertCount;++a)n[a*this._vertAttrsFloatCount+r/4]=u.WHITE._val;for(var o=new Float32Array(e),s=1;s<this._capacity;s++)o.copyWithin(s*this._vertSize*this._vertCount/4,0,this._vertSize*this._vertCount/4)}t.update(e);var l=new Uint16Array(this._capacity*this._indexCount);if(this._mesh){this._mesh.copyIndices(0,l);for(var h=1;h<this._capacity;h++)for(var c=0;c<this._indexCount;c++)l[h*this._indexCount+c]=l[c]+h*this._vertCount}else for(var _=0,p=0;p<this._capacity;++p){var d=4*p;l[_++]=d,l[_++]=d+1,l[_++]=d+2,l[_++]=d+3,l[_++]=d+2,l[_++]=d+1}var f=this._device.createBuffer(new nt(at.INDEX|at.TRANSFER_DST,ot.HOST|ot.DEVICE,this._capacity*this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));return f.update(l),this._iaInfo.drawInfos[0].vertexCount=this._capacity*this._vertCount,this._iaInfo.drawInfos[0].indexCount=this._capacity*this._indexCount,this._iaInfoBuffer||(this._iaInfoBuffer=this._device.createBuffer(new nt(at.INDIRECT,ot.HOST|ot.DEVICE,ct,ct))),this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new st([t],this._vertAttrs,q.TRIANGLE_LIST,f,this._iaInfoBuffer),this.initSubModel(0,this._subMeshData,this._material),e},i.updateMaterial=function(t){this._material=t,this.setSubModelMaterial(0,t)},i.addParticleVertexData=function(t,e){if(this._mesh)for(var i=0;i<this._vertCount;i++){var r=(t*this._vertCount+i)*this._vertAttrsFloatCount;this._vdataF32[r++]=e[0].x,this._vdataF32[r++]=e[0].y,this._vdataF32[r++]=e[0].z,r+=2,this._vdataF32[r++]=e[1].z,this._vdataF32[r++]=e[2].x,this._vdataF32[r++]=e[2].y,this._vdataF32[r++]=e[2].z,this._vdataF32[r++]=e[3].x,this._vdataF32[r++]=e[3].y,this._vdataF32[r++]=e[3].z,this._vdataUint32[r++]=e[4]}else{var n=t*this._vertAttrsFloatCount;this._vdataF32[n++]=e[0].x,this._vdataF32[n++]=e[0].y,this._vdataF32[n++]=e[0].z,this._vdataF32[n++]=e[1].x,this._vdataF32[n++]=e[1].y,this._vdataF32[n++]=e[1].z,this._vdataF32[n++]=e[2].x,this._vdataF32[n++]=e[2].y,this._vdataF32[n++]=e[2].z,this._vdataF32[n++]=e[3].x,this._vdataF32[n++]=e[3].y,this._vdataF32[n++]=e[3].z,this._vdataUint32[n++]=e[4],e[5]&&(this._vdataF32[n++]=e[5].x,this._vdataF32[n++]=e[5].y,this._vdataF32[n++]=e[5].z)}},i.addGPUParticleVertexData=function(t,e,i){for(var r=e*this._vertAttrsFloatCount*this._vertCount,n=0;n<this._vertCount;n++){var a=r;this._vdataF32[a++]=t.position.x,this._vdataF32[a++]=t.position.y,this._vdataF32[a++]=t.position.z,this._vdataF32[a++]=i,this._vdataF32[a++]=t.startSize.x,this._vdataF32[a++]=t.startSize.y,this._vdataF32[a++]=t.startSize.z,this._vdataF32[a++]=tu[2*n],this._vdataF32[a++]=t.rotation.x,this._vdataF32[a++]=t.rotation.y,this._vdataF32[a++]=t.rotation.z,this._vdataF32[a++]=tu[2*n+1],this._vdataF32[a++]=t.startColor.r/255,this._vdataF32[a++]=t.startColor.g/255,this._vdataF32[a++]=t.startColor.b/255,this._vdataF32[a++]=t.startColor.a/255,this._vdataF32[a++]=t.velocity.x,this._vdataF32[a++]=t.velocity.y,this._vdataF32[a++]=t.velocity.z,this._vdataF32[a++]=t.startLifetime,this._vdataF32[a++]=t.randomSeed,r+=this._vertAttrsFloatCount}},i.updateGPUParticles=function(t,e,i){for(var r=this._vertAttrsFloatCount*this._vertCount,n=0,a=0,o=0,s=0;s<t;++s)n=s*r,a=this._vdataF32[n+this._startTimeOffset],this._vdataF32[n+this._lifeTimeOffset]-(e-a)<i&&(o=--t*r,this._vdataF32.copyWithin(n,o,o+r),s--);return t},i.constructAttributeIndex=function(){if(this._vertAttrs){var t=this._vertAttrs.findIndex((function(t){return"a_position_starttime"===t.name})),e=this._vertAttrs[t].offset;this._startTimeOffset=e/4+3,t=this._vertAttrs.findIndex((function(t){return"a_dir_life"===t.name})),e=this._vertAttrs[t].offset,this._lifeTimeOffset=e/4+3}},i.updateIA=function(t){this._subModels[0].inputAssembler.vertexBuffers[0].update(this._vdataF32),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=this._indexCount*t,this._iaInfoBuffer.update(this._iaInfo)},i.clear=function(){this._subModels[0].inputAssembler.indexCount=0},i.destroy=function(){t.prototype.destroy.call(this),this._vBuffer=null,this._vdataF32=null,this.destroySubMeshData(),this._iaInfoBuffer&&(this._iaInfoBuffer.destroy(),this._iaInfoBuffer=null)},i.rebuild=function(){this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer)},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},e}(tt),iu=function(){function t(t){this._particleSystem=null,this._model=null,this._renderInfo=null,this._vertAttrs=[],this._renderInfo=t}var e=t.prototype;return e.onInit=function(t){this._particleSystem=t},e.onEnable=function(){if(this._particleSystem){this.attachToScene();var t=this._model;t&&(t.node=t.transform=this._particleSystem.node,t.enabled=this._particleSystem.enabledInHierarchy)}},e.onDisable=function(){this.detachFromScene()},e.onDestroy=function(){this._model&&(h.director.root.destroyModel(this._model),this._model=null)},e.attachToScene=function(){this._model&&(this._model.scene&&this.detachFromScene(),this._particleSystem._getRenderScene().addModel(this._model))},e.detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},e.setVertexAttributes=function(){this._model&&this._model.setVertexAttributes(this._renderInfo.renderMode===xr.Mesh?this._renderInfo.mesh:null,this._vertAttrs)},e._initModel=function(){this._model||(this._model=h.director.root.createModel(eu),this._model.setCapacity(this._particleSystem.capacity),this._model.visFlags=this._particleSystem.visibility)},e.updateTrailMaterial=function(){},e.getDefaultTrailMaterial=function(){return null},t}(),ru=new b,nu=new A,au=["_colorOverLifetimeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule"],ou=[0,0,1,0,0,1,1,1],su=[new Q(J.ATTR_POSITION,$.RGB32F),new Q(J.ATTR_TEX_COORD,$.RGB32F),new Q(J.ATTR_TEX_COORD1,$.RGB32F),new Q(J.ATTR_TEX_COORD2,$.RGB32F),new Q(J.ATTR_COLOR,$.RGBA8,!0)],lu=[new Q(J.ATTR_POSITION,$.RGB32F),new Q(J.ATTR_TEX_COORD,$.RGB32F),new Q(J.ATTR_TEX_COORD1,$.RGB32F),new Q(J.ATTR_TEX_COORD2,$.RGB32F),new Q(J.ATTR_COLOR,$.RGBA8,!0),new Q(J.ATTR_COLOR1,$.RGB32F)],uu=[new Q(J.ATTR_POSITION,$.RGB32F),new Q(J.ATTR_TEX_COORD,$.RGB32F),new Q(J.ATTR_TEX_COORD1,$.RGB32F),new Q(J.ATTR_TEX_COORD2,$.RGB32F),new Q(J.ATTR_COLOR,$.RGBA8,!0),new Q(J.ATTR_TEX_COORD3,$.RGB32F),new Q(J.ATTR_NORMAL,$.RGB32F),new Q(J.ATTR_COLOR1,$.RGBA8,!0)],hu={parent:null,owner:null,subModelIdx:0},cu=function(t){function e(e){var i;return(i=t.call(this,e)||this)._defines=void 0,i._trailDefines=void 0,i._frameTile_velLenScale=void 0,i._defaultMat=null,i._node_scale=void 0,i._attrs=void 0,i._particles=null,i._defaultTrailMat=null,i._updateList=new Map,i._animateList=new Map,i._runAnimateList=new Array,i._fillDataFunc=null,i._uScaleHandle=0,i._uLenHandle=0,i._inited=!1,i._model=null,i._frameTile_velLenScale=new l(1,1,0,0),i._node_scale=new l,i._attrs=new Array(5),i._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1},i._trailDefines={CC_USE_WORLD_SPACE:!0},i}n(e,t);var i=e.prototype;return i.onInit=function(e){var i=this;t.prototype.onInit.call(this,e),this._particles=new k((function(){return new wr(i)}),16),this._setVertexAttrib(),this._setFillFunc(),this._initModuleList(),this._initModel(),this.updateMaterialParams(),this.updateTrailMaterial(),this.setVertexAttributes(),this._inited=!0},i.clear=function(){this._particles.reset(),this._particleSystem._trailModule&&this._particleSystem._trailModule.clear(),this.updateRenderData()},i.updateRenderMode=function(){this._setVertexAttrib(),this._setFillFunc(),this.updateMaterialParams(),this.setVertexAttributes()},i.getFreeParticle=function(){return this._particles.length>=this._particleSystem.capacity?null:this._particles.add()},i.getDefaultTrailMaterial=function(){return this._defaultTrailMat},i.setNewParticle=function(){},i._initModuleList=function(){var t=this;au.forEach((function(e){var i=t._particleSystem[e];i&&i.enable&&(i.needUpdate&&(t._updateList[i.name]=i),i.needAnimate&&(t._animateList[i.name]=i))})),this._runAnimateList.length=0;for(var e=0,i=Mr.length;e<i;e++){var r=this._animateList[Mr[e]];r&&this._runAnimateList.push(r)}},i.enableModule=function(t,e,i){e?(i.needUpdate&&(this._updateList[i.name]=i),i.needAnimate&&(this._animateList[i.name]=i)):(delete this._animateList[t],delete this._updateList[t]),this._runAnimateList.length=0;for(var r=0,n=Mr.length;r<n;r++){var a=this._animateList[Mr[r]];a&&this._runAnimateList.push(a)}},i.updateParticles=function(t){var e=this,i=this._particleSystem;if(!i)return this._particles.length;switch(i.node.getWorldMatrix(nu),i.scaleSpace){case Or.Local:i.node.getScale(this._node_scale);break;case Or.World:i.node.getWorldScale(this._node_scale)}(i.getMaterialInstance(0)||this._defaultMat).passes[0].setUniform(this._uScaleHandle,this._node_scale),this._updateList.forEach((function(t){t.update(i._simulationSpace,nu)}));var r=i._trailModule,n=r&&r.enable;n&&r.update();for(var a=function(a){var s=e._particles.data[a];if(s.remainingLifetime-=t,b.set(s.animatedVelocity,0,0,0),s.remainingLifetime<0)return n&&r.removeParticle(s),e._particles.removeAt(a),--a,o=a,"continue";s.velocity.y-=9.8*i.gravityModifier.evaluate(1-s.remainingLifetime/s.startLifetime,E(s.randomSeed))*t,b.copy(s.ultimateVelocity,s.velocity),e._runAnimateList.forEach((function(e){e.animate(s,t)})),b.scaleAndAdd(s.position,s.position,s.ultimateVelocity,t),n&&r.animate(s,t),o=a},o=0;o<this._particles.length;++o)a(o);return this._particles.length},i.updateRenderData=function(){for(var t=0,e=0;e<this._particles.length;++e){var i=this._particles.data[e],r=0,n=this._particleSystem._textureAnimationModule;n&&n.enable&&(r=i.frameIndex),t=4*e,this._fillDataFunc(i,t,r)}this._model.updateIA(this._particles.length)},i.getParticleCount=function(){return this._particles.length},i.onMaterialModified=function(t){this._inited&&(0===t?this.updateMaterialParams():this.updateTrailMaterial())},i.onRebuildPSO=function(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e);var i=this._particleSystem._trailModule;i&&i._trailModel&&1===t&&i._trailModel.setSubModelMaterial(0,e)},i._setFillFunc=function(){this._renderInfo.renderMode===xr.Mesh?this._fillDataFunc=this._fillMeshData:this._renderInfo.renderMode===xr.StrecthedBillboard?this._fillDataFunc=this._fillStrecthedData:this._fillDataFunc=this._fillNormalData},i._fillMeshData=function(t,e,i){var r=e/4,n=0;this._attrs[n++]=t.position,ru.z=i,this._attrs[n++]=ru,this._attrs[n++]=t.size,this._attrs[n++]=t.rotation,this._attrs[n++]=t.color._val,this._model.addParticleVertexData(r,this._attrs)},i._fillStrecthedData=function(t,e,i){for(var r=0,n=0;n<4;++n)r=0,this._attrs[r++]=t.position,ru.x=ou[2*n],ru.y=ou[2*n+1],ru.z=i,this._attrs[r++]=ru,this._attrs[r++]=t.size,this._attrs[r++]=t.rotation,this._attrs[r++]=t.color._val,this._attrs[r++]=t.ultimateVelocity,this._attrs[r++]=t.ultimateVelocity,this._model.addParticleVertexData(e++,this._attrs)},i._fillNormalData=function(t,e,i){for(var r=0,n=0;n<4;++n)r=0,this._attrs[r++]=t.position,ru.x=ou[2*n],ru.y=ou[2*n+1],ru.z=i,this._attrs[r++]=ru,this._attrs[r++]=t.size,this._attrs[r++]=t.rotation,this._attrs[r++]=t.color._val,this._attrs[r++]=null,this._model.addParticleVertexData(e++,this._attrs)},i._setVertexAttrib=function(){switch(this._renderInfo.renderMode){case xr.StrecthedBillboard:this._vertAttrs=lu.slice();break;case xr.Mesh:this._vertAttrs=uu.slice();break;default:this._vertAttrs=su.slice()}},i.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,e=t.sharedMaterial;if(null!=e){var i=e._effectAsset._name;this._renderInfo.mainTexture=e.getProperty("mainTexture",0),-1!==i.indexOf("particle")&&-1===i.indexOf("particle-gpu")||t.setMaterial(null,0)}null==t.sharedMaterial&&null==this._defaultMat&&(hu.parent=it.get("default-particle-material"),hu.owner=this._particleSystem,hu.subModelIdx=0,this._defaultMat=new yt(hu),null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));var r=t.getMaterialInstance(0)||this._defaultMat;t._simulationSpace===Or.World?this._defines.CC_USE_WORLD_SPACE=!0:this._defines.CC_USE_WORLD_SPACE=!1;var n=r.passes[0];this._uScaleHandle=n.getHandle("scale"),this._uLenHandle=n.getHandle("frameTile_velLenScale");var a=this._renderInfo.renderMode,o=this._frameTile_velLenScale;a===xr.Billboard?this._defines.CC_RENDER_MODE=0:a===xr.StrecthedBillboard?(this._defines.CC_RENDER_MODE=1,o.z=this._renderInfo.velocityScale,o.w=this._renderInfo.lengthScale):a===xr.HorizontalBillboard?this._defines.CC_RENDER_MODE=2:a===xr.VerticalBillboard?this._defines.CC_RENDER_MODE=3:a===xr.Mesh?this._defines.CC_RENDER_MODE=4:console.warn("particle system renderMode "+a+" not support.");var s=t._textureAnimationModule;s&&s.enable?(x.set(o,s.numTilesX,s.numTilesY),n.setUniform(this._uLenHandle,o)):n.setUniform(this._uLenHandle,o),r.recompileShaders(this._defines),this._model&&this._model.updateMaterial(r)}},i.updateTrailMaterial=function(){if(this._particleSystem){var t=this._particleSystem,e=t._trailModule;if(e&&e.enable){t.simulationSpace===Or.World||e.space===Or.World?this._trailDefines.CC_USE_WORLD_SPACE=!0:this._trailDefines.CC_USE_WORLD_SPACE=!1;var i=t.getMaterialInstance(1);null===i&&null===this._defaultTrailMat&&(hu.parent=it.get("default-trail-material"),hu.owner=this._particleSystem,hu.subModelIdx=1,this._defaultTrailMat=new yt(hu)),(i=i||this._defaultTrailMat).recompileShaders(this._trailDefines),e.updateMaterial()}}},e}(iu),_u=new A,pu=new l,du=new R,fu=[new Q("a_position_starttime",$.RGBA32F),new Q("a_size_uv",$.RGBA32F),new Q("a_rotation_uv",$.RGBA32F),new Q("a_color",$.RGBA32F),new Q("a_dir_life",$.RGBA32F),new Q("a_rndSeed",$.R32F)],mu=[new Q("a_position_starttime",$.RGBA32F),new Q("a_size_uv",$.RGBA32F),new Q("a_rotation_uv",$.RGBA32F),new Q("a_color",$.RGBA32F),new Q("a_dir_life",$.RGBA32F),new Q("a_rndSeed",$.R32F),new Q(J.ATTR_TEX_COORD,$.RGB32F),new Q(J.ATTR_TEX_COORD3,$.RGB32F),new Q(J.ATTR_NORMAL,$.RGB32F),new Q(J.ATTR_COLOR1,$.RGBA8,!0)],yu={parent:null,owner:null,subModelIdx:0},vu=function(t){function e(e){var i;return(i=t.call(this,e)||this)._defines=void 0,i._frameTile_velLenScale=void 0,i._node_scale=void 0,i._vertAttrs=[],i._defaultMat=null,i._particleNum=0,i._tempParticle=null,i._colorTexture=null,i._forceTexture=null,i._velocityTexture=null,i._rotationTexture=null,i._sizeTexture=null,i._animTexture=null,i._uTimeHandle=0,i._uRotHandle=0,i._inited=!1,i._frameTile_velLenScale=new l(1,1,0,0),i._node_scale=new l,i._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1,COLOR_OVER_TIME_MODULE_ENABLE:!1},i._tempParticle=new wr(null),i._particleNum=0,i}n(e,t);var i=e.prototype;return i.onInit=function(e){t.prototype.onInit.call(this,e),this._setVertexAttrib(),this._initModel(),this.updateMaterialParams(),this.setVertexAttributes(),this._inited=!0},i.updateRenderMode=function(){this._setVertexAttrib(),this.updateMaterialParams(),this.setVertexAttributes()},i.setVertexAttributes=function(){t.prototype.setVertexAttributes.call(this),this._model.constructAttributeIndex()},i.clear=function(){this._particleNum=0,this.updateRenderData()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._forceTexture&&this._forceTexture.destroy(),this._velocityTexture&&this._velocityTexture.destroy(),this._colorTexture&&this._colorTexture.destroy(),this._sizeTexture&&this._sizeTexture.destroy(),this._rotationTexture&&this._rotationTexture.destroy(),this._animTexture&&this._animTexture.destroy()},i.enableModule=function(){var t=this._particleSystem.getMaterialInstance(0)||this._defaultMat;t&&(this.initShaderUniform(t),t.recompileShaders(this._defines),this._model&&this._model.setSubModelMaterial(0,t))},i.getFreeParticle=function(){return this._particleNum>=this._particleSystem._capacity?null:this._tempParticle},i.setNewParticle=function(t){this._model.addGPUParticleVertexData(t,this._particleNum,this._particleSystem._time),this._particleNum++},i.updateParticles=function(t){return this._particleNum=this._model.updateGPUParticles(this._particleNum,this._particleSystem._time,t),this.updateShaderUniform(t),this._particleNum},i.updateRenderData=function(){this._model.updateIA(this._particleNum)},i.updateShaderUniform=function(t){var e=this._particleSystem.getMaterialInstance(0)||this._defaultMat;if(e){var i=e.passes[0];pu.x=this._particleSystem._time,pu.y=t,i.setUniform(this._uTimeHandle,pu),this._particleSystem.node.getWorldRotation(du),i.setUniform(this._uRotHandle,du)}},i.initShaderUniform=function(t){var e=t.passes[0];this._uTimeHandle=e.getHandle("u_timeDelta"),this._uRotHandle=e.getHandle("u_worldRot"),e.setUniform(e.getHandle("scale"),this._node_scale),e.setUniform(e.getHandle("frameTile_velLenScale"),this._frameTile_velLenScale),pu.x=32,pu.y=1/32,e.setUniform(e.getHandle("u_sampleInfo"),pu);var i=!1,r=this._particleSystem._forceOvertimeModule;if(i=r&&r.enable,this._defines.FORCE_OVER_TIME_MODULE_ENABLE=i,i){this._forceTexture&&this._forceTexture.destroy(),this._forceTexture=Re(32,r.x,r.y,r.z);var n=e.getHandle("force_over_time_tex0"),a=vt.getBindingFromHandle(n);e.bindSampler(a,this._forceTexture.getGFXSampler()),e.bindTexture(a,this._forceTexture.getGFXTexture());var o=e.getHandle("u_force_space");e.setUniform(o,r.space);var s=e.getHandle("u_force_mode");e.setUniform(s,this._forceTexture.height)}var l=this._particleSystem._velocityOvertimeModule;if(i=l&&l.enable,this._defines.VELOCITY_OVER_TIME_MODULE_ENABLE=i,i){this._velocityTexture&&this._velocityTexture.destroy(),this._velocityTexture=function(t,e,i,r,n){for(var a=Math.max(Ce(e),Ce(i),Ce(r),Ce(n)),o=new Float32Array(128*a),s=[e,i,r,n],l=0;l<a;l++)for(var u=0;u<4;u++)for(var h=s[u],c=0,_=0,p=0;p<32;p++){var d=Ee(h,1/31*p,l);_=(c+=d)/(p+1),o[4*p+u]=_}return Ae(o,32,a)}(0,l.x,l.y,l.z,l.speedModifier);var u=e.getHandle("velocity_over_time_tex0"),h=vt.getBindingFromHandle(u);e.bindSampler(h,this._velocityTexture.getGFXSampler()),e.bindTexture(h,this._velocityTexture.getGFXTexture());var c=e.getHandle("u_velocity_space");e.setUniform(c,l.space);var _=e.getHandle("u_velocity_mode");e.setUniform(_,this._velocityTexture.height)}var p=this._particleSystem._colorOverLifetimeModule;if(i=p&&p.enable,this._defines.COLOR_OVER_TIME_MODULE_ENABLE=i,i){this._colorTexture&&this._colorTexture.destroy(),this._colorTexture=function(t,e){for(var i=function(t){switch(t.mode){case Ii.TwoColors:case Ii.TwoGradients:return 2;default:return 1}}(e),r=new Uint8Array(t*i*4),n=1/(t-1),a=0,o=0;o<i;o++)for(var s=0;s<t;s++){var l=Bi(e,n*s,o);r[a]=l.r,r[a+1]=l.g,r[a+2]=l.b,r[a+3]=l.a,a+=4}var u=new Y;return u.create(t,i,dt.RGBA8888),u.setFilters(ft.LINEAR,ft.LINEAR),u.setWrapMode(mt.CLAMP_TO_EDGE,mt.CLAMP_TO_EDGE),u.uploadData(r),u}(32,p.color);var d=e.getHandle("color_over_time_tex0"),f=vt.getBindingFromHandle(d);e.bindSampler(f,this._colorTexture.getGFXSampler()),e.bindTexture(f,this._colorTexture.getGFXTexture());var m=e.getHandle("u_color_mode");e.setUniform(m,this._colorTexture.height)}var y=this._particleSystem._rotationOvertimeModule;if(i=y&&y.enable,this._defines.ROTATION_OVER_TIME_MODULE_ENABLE=i,i){this._rotationTexture&&this._rotationTexture.destroy(),y.separateAxes?this._rotationTexture=Re(32,y.x,y.y,y.z):this._rotationTexture=function(t,e){for(var i=Ce(e),r=new Float32Array(128*i),n=0,a=0;a<i;a++)for(var o=0;o<32;o++){var s=Ee(e,1/31*o,a);r[n+2]=s,n+=4}return Ae(r,32,i)}(0,y.z);var v=e.getHandle("rotation_over_time_tex0"),b=vt.getBindingFromHandle(v);e.bindSampler(b,this._rotationTexture.getGFXSampler()),e.bindTexture(b,this._rotationTexture.getGFXTexture());var g=e.getHandle("u_rotation_mode");e.setUniform(g,this._rotationTexture.height)}var w=this._particleSystem._sizeOvertimeModule;if(i=w&&w.enable,this._defines.SIZE_OVER_TIME_MODULE_ENABLE=i,i){this._sizeTexture&&this._sizeTexture.destroy(),w.separateAxes?this._sizeTexture=Re(32,w.x,w.y,w.z,!0):this._sizeTexture=function(t,e){for(var i=Ce(e),r=new Float32Array(128*i),n=0,a=0,o=0;o<i;o++){0;for(var s=0;s<32;s++){var l=Ee(e,1/31*s,o);n=l,r[a]=n,r[a+1]=n,r[a+2]=n,a+=4}}return Ae(r,32,i)}(0,w.size);var M=e.getHandle("size_over_time_tex0"),T=vt.getBindingFromHandle(M);e.bindSampler(T,this._sizeTexture.getGFXSampler()),e.bindTexture(T,this._sizeTexture.getGFXTexture());var S=e.getHandle("u_size_mode");e.setUniform(S,this._sizeTexture.height)}var O=this._particleSystem._textureAnimationModule;if(i=O&&O.enable,this._defines.TEXTURE_ANIMATION_MODULE_ENABLE=i,i){this._animTexture&&this._animTexture.destroy(),this._animTexture=function(t,e,i){for(var r=Math.max(Ce(e),Ce(i)),n=new Float32Array(128*r),a=[e,i],o=0;o<r;o++)for(var s=0;s<2;s++)for(var l=a[s],u=0,h=0,c=0;c<32;c++){var _=Ee(l,1/31*c,o);h=(u+=_)/(c+1),n[4*c+s]=h}return Ae(n,32,r)}(0,O.startFrame,O.frameOverTime);var x=e.getHandle("texture_animation_tex0"),z=vt.getBindingFromHandle(x);e.bindSampler(z,this._animTexture.getGFXSampler()),e.bindTexture(z,this._animTexture.getGFXTexture());var E=e.getHandle("u_anim_info");pu.x=this._animTexture.height,pu.y=O.numTilesX*O.numTilesY,pu.z=O.cycleCount,e.setUniform(E,pu)}},i.getParticleCount=function(){return this._particleNum},i.onMaterialModified=function(){this._inited&&this.updateMaterialParams()},i.onRebuildPSO=function(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e)},i._setVertexAttrib=function(){switch(this._renderInfo.renderMode){case xr.StrecthedBillboard:this._vertAttrs=fu.slice();break;case xr.Mesh:this._vertAttrs=mu.slice();break;default:this._vertAttrs=fu.slice()}},i.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,e=t.sharedMaterial;if(null!==e){var i=e._effectAsset._name;this._renderInfo.mainTexture=e.getProperty("mainTexture",0),-1===i.indexOf("particle-gpu")&&(this._renderInfo.mainTexture=e.getProperty("mainTexture",0),this._particleSystem.setMaterial(null,0))}null==t.sharedMaterial&&null==this._defaultMat&&(yu.parent=it.get("default-particle-gpu-material"),yu.owner=t,yu.subModelIdx=0,this._defaultMat=new yt(yu),null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));var r=t.getMaterialInstance(0)||this._defaultMat;switch(t.node.getWorldMatrix(_u),t.scaleSpace){case Or.Local:t.node.getScale(this._node_scale);break;case Or.World:t.node.getWorldScale(this._node_scale)}t._simulationSpace===Or.World?this._defines.CC_USE_WORLD_SPACE=!0:this._defines.CC_USE_WORLD_SPACE=!1;var n=this._renderInfo.renderMode;n===xr.Billboard?this._defines.CC_RENDER_MODE=0:n===xr.StrecthedBillboard?(this._defines.CC_RENDER_MODE=1,this._frameTile_velLenScale.z=this._renderInfo.velocityScale,this._frameTile_velLenScale.w=this._renderInfo.lengthScale):n===xr.HorizontalBillboard?this._defines.CC_RENDER_MODE=2:n===xr.VerticalBillboard?this._defines.CC_RENDER_MODE=3:n===xr.Mesh?this._defines.CC_RENDER_MODE=4:console.warn("particle system renderMode "+n+" not support.");var a=t._textureAnimationModule;a&&a.enable&&x.set(this._frameTile_velLenScale,a.numTilesX,a.numTilesY),this.initShaderUniform(r),r.recompileShaders(this._defines),this._model&&this._model.updateMaterial(r)}},e}(iu);function bu(){var t=Ot.root.device;return!!(t.maxVertexTextureUnits>=8&&t.hasFeature(gt.TEXTURE_FLOAT))||(h.warn("Maybe the device has restrictions on vertex textures or does not support float textures."),!1)}var gu,wu,Mu,Tu,Su,Ou,xu,zu,Eu,Cu,Au,Ru,Fu,Du,Pu,Iu,Lu,Bu,Uu,Vu,ku,Gu,Hu,Nu,Wu,ju,Xu,Ku,Yu,Zu,qu,Qu,Ju,$u,th,eh,ih,rh,nh,ah,oh,sh,lh,uh,hh,ch,_h,ph,dh,fh,mh,yh,vh,bh,gh,wh,Mh,Th,Sh,Oh,xh,zh,Eh,Ch,Ah,Rh,Fh,Dh,Ph,Ih,Lh,Bh,Uh,Vh,kh,Gh,Hh,Nh,Wh,jh,Xh,Kh,Yh,Zh,qh,Qh,Jh,$h,tc,ec,ic,rc,nc,ac,oc,sc,lc,uc,hc,cc,_c,pc,dc,fc,mc,yc,vc,bc,gc,wc,Mc,Tc,Sc,Oc,xc,zc,Ec,Cc,Ac,Rc,Fc,Dc,Pc,Ic,Lc,Bc,Uc,Vc,kc,Gc,Hc,Nc,Wc,jc,Xc,Kc,Yc,Zc,qc,Qc,Jc,$c,t_,e_,i_,r_,n_,a_,o_,s_,l_,u_,h_,c_,__,p_,d_,f_,m_,y_,v_,b_,g_,w_,M_,T_,S_,O_,x_,z_,E_,C_,A_,R_,F_,D_,P_,I_,L_,B_,U_,V_,k_,G_,H_,N_,W_,j_,X_,K_,Y_,Z_,q_,Q_,J_,$_,tp,ep,ip,rp,np,ap,op,sp=(Ol=e("cc.ParticleSystemRenderer"),xl=i(xr),zl=z(),El=f(),Cl=z(),Al=f(),Rl=z(),Fl=f(),Dl=i(xr),Pl=i(bt),Il=z(),Ll=f(),Bl=i(et),Ul=z(),Vl=f(),kl=i(et),Gl=z(),Hl=f(),Nl=z(),Wl=f(),Ol(($l=function(){function t(){o(this,"_renderMode",Kl,this),o(this,"_velocityScale",Yl,this),o(this,"_lengthScale",Zl,this),o(this,"_mesh",ql,this),o(this,"_mainTexture",Ql,this),o(this,"_useGPU",Jl,this),this._particleSystem=null}var e=t.prototype;return e.onInit=function(t){this._particleSystem=t;var e=this._useGPU&&bu();this._particleSystem.processor=e?new vu(this):new cu(this),this._particleSystem.processor.onInit(t)},e._switchProcessor=function(){this._particleSystem.processor&&(this._particleSystem.processor.detachFromScene(),this._particleSystem.processor.clear(),this._particleSystem.processor=null),this._particleSystem.processor=this._useGPU?new vu(this):new cu(this),this._particleSystem.processor.onInit(this._particleSystem),this._particleSystem.processor.onEnable(),this._particleSystem.bindModule()},a(t,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode!==t&&(this._renderMode=t,this._particleSystem.processor.updateRenderMode())}},{key:"velocityScale",get:function(){return this._velocityScale},set:function(t){this._velocityScale=t,this._particleSystem.processor.updateMaterialParams()}},{key:"lengthScale",get:function(){return this._lengthScale},set:function(t){this._lengthScale=t,this._particleSystem.processor.updateMaterialParams()}},{key:"mesh",get:function(){return this._mesh},set:function(t){this._mesh=t,this._particleSystem.processor.setVertexAttributes()}},{key:"particleMaterial",get:function(){return this._particleSystem?this._particleSystem.getMaterial(0):null},set:function(t){this._particleSystem.setMaterial(t,0)}},{key:"trailMaterial",get:function(){return this._particleSystem?this._particleSystem.getMaterial(1):null},set:function(t){this._particleSystem.setMaterial(t,1)}},{key:"mainTexture",get:function(){return this._mainTexture},set:function(t){this._mainTexture=t}},{key:"useGPU",get:function(){return this._useGPU},set:function(t){this._useGPU!==t&&(bu()?this._useGPU=t:this._useGPU=!1,this._switchProcessor())}}]),t}(),_((Xl=$l).prototype,"renderMode",[xl,zl,El],Object.getOwnPropertyDescriptor(Xl.prototype,"renderMode"),Xl.prototype),_(Xl.prototype,"velocityScale",[Cl,Al],Object.getOwnPropertyDescriptor(Xl.prototype,"velocityScale"),Xl.prototype),_(Xl.prototype,"lengthScale",[Rl,Fl],Object.getOwnPropertyDescriptor(Xl.prototype,"lengthScale"),Xl.prototype),Kl=_(Xl.prototype,"_renderMode",[Dl,v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xr.Billboard}}),Yl=_(Xl.prototype,"_velocityScale",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Zl=_(Xl.prototype,"_lengthScale",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ql=_(Xl.prototype,"_mesh",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(Xl.prototype,"mesh",[Pl,Il,Ll],Object.getOwnPropertyDescriptor(Xl.prototype,"mesh"),Xl.prototype),_(Xl.prototype,"particleMaterial",[Bl,Ul,Vl],Object.getOwnPropertyDescriptor(Xl.prototype,"particleMaterial"),Xl.prototype),_(Xl.prototype,"trailMaterial",[kl,Gl,Hl],Object.getOwnPropertyDescriptor(Xl.prototype,"trailMaterial"),Xl.prototype),Ql=_(Xl.prototype,"_mainTexture",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jl=_(Xl.prototype,"_useGPU",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_(Xl.prototype,"useGPU",[Nl,Wl],Object.getOwnPropertyDescriptor(Xl.prototype,"useGPU"),Xl.prototype),jl=Xl))||jl),lp=Math.cos(y(100)),up={position:new b,velocity:new b},hp=new R,cp=new A,_p=new b,pp=new b,dp=new u,fp=function(){function t(t){for(this.start=void 0,this.end=void 0,this.trailElements=void 0,this.start=-1,this.end=-1,this.trailElements=[];t--;)this.trailElements.push({position:new b,lifetime:0,width:0,velocity:new b,direction:0,color:new u})}var e=t.prototype;return e.getElement=function(t){return-1===this.start?null:(t<0&&(t=(t+this.trailElements.length)%this.trailElements.length),t>=this.trailElements.length&&(t%=this.trailElements.length),this.trailElements[t])},e.addElement=function(){if(0===this.trailElements.length)return null;if(-1===this.start)return this.start=0,this.end=1,this.trailElements[0];this.start===this.end&&(this.trailElements.splice(this.end,0,{position:new b,lifetime:0,width:0,velocity:new b,direction:0,color:new u}),this.start++,this.start%=this.trailElements.length);var t=this.end++;return this.end%=this.trailElements.length,this.trailElements[t]},e.iterateElement=function(t,e,i,r){for(var n=this.start>=this.end?this.end+this.trailElements.length:this.end,a=this.start;a<n;a++)e(t,this.trailElements[a%this.trailElements.length],i,r)&&(this.start++,this.start%=this.trailElements.length);this.start===n&&(this.start=-1,this.end=-1)},e.count=function(){return this.start<this.end?this.end-this.start:this.trailElements.length+this.end-this.start},e.clear=function(){this.start=-1,this.end=-1},t}(),mp=(gu=e("cc.TrailModule"),wu=z(),Mu=i(Ar),Tu=z(),Su=f(),Ou=i(ze),xu=z(),zu=f(),Eu=z(),Cu=f(),Au=i(Or),Ru=z(),Fu=f(),Du=i(Rr),Pu=z(),Iu=f(),Lu=z(),Bu=f(),Uu=i(ze),Vu=z(),ku=f(),Gu=z(),Hu=f(),Nu=i(Li),Wu=z(),ju=f(),Xu=i(Li),Ku=z(),Yu=f(),Zu=i(Or),gu((ch=function(){function t(){o(this,"_enable",Ju,this),o(this,"mode",$u,this),o(this,"lifeTime",th,this),o(this,"_minParticleDistance",eh,this),o(this,"existWithParticles",ih,this),o(this,"textureMode",rh,this),o(this,"widthFromParticle",nh,this),o(this,"widthRatio",ah,this),o(this,"colorFromParticle",oh,this),o(this,"colorOverTrail",sh,this),o(this,"colorOvertime",lh,this),o(this,"_space",uh,this),o(this,"_particleSystem",hh,this),this._minSquaredDistance=0,this._vertSize=void 0,this._trailNum=0,this._trailLifetime=0,this.vbOffset=0,this.ibOffset=0,this._trailSegments=null,this._particleTrail=void 0,this._trailModel=null,this._iaInfo=void 0,this._iaInfoBuffer=null,this._subMeshData=null,this._vertAttrs=void 0,this._vbF32=null,this._vbUint32=null,this._iBuffer=null,this._needTransform=!1,this._material=null,this._iaInfo=new ut([new ht]),this._vertAttrs=[new Q(J.ATTR_POSITION,$.RGB32F),new Q(J.ATTR_TEX_COORD,$.RGBA32F),new Q(J.ATTR_TEX_COORD1,$.RGB32F),new Q(J.ATTR_COLOR,$.RGBA8,!0)],this._vertSize=0;for(var t,e=g(this._vertAttrs);!(t=e()).done;){var i=t.value;this._vertSize+=rt[i.format].size}this._particleTrail=new Map}a(t,[{key:"enable",get:function(){return this._enable},set:function(t){t===this._enable&&this._trailModel||(t&&!this._enable&&(this._enable=t,this._particleSystem.processor.updateTrailMaterial()),t&&!this._trailModel&&(this._createModel(),this.rebuild()),this._enable=t,this._trailModel&&(this._trailModel.enabled=t),t?this.onEnable():this.onDisable())}},{key:"minParticleDistance",get:function(){return this._minParticleDistance},set:function(t){this._minParticleDistance=t,this._minSquaredDistance=t*t}},{key:"space",get:function(){return this._space},set:function(t){this._space=t,this._particleSystem&&this._particleSystem.processor.updateTrailMaterial()}}]);var e=t.prototype;return e.onInit=function(t){this._particleSystem=t,this.minParticleDistance=this._minParticleDistance;for(var e=0,i=t.startLifetime.getMax(),r=t.rateOverTime.getMax(),n=t.duration,a=0,o=t.bursts.length;a<o;a++)e+=t.bursts[a].getMaxCount(t)*Math.ceil(i/n);this._trailNum=Math.ceil(i*this.lifeTime.getMax()*60*(r*n+e)),this._trailSegments=new G((function(){return new fp(10)}),Math.ceil(r*n)),this._enable&&(this.enable=this._enable)},e.onEnable=function(){this._attachToScene()},e.onDisable=function(){this._particleTrail.clear(),this._detachFromScene()},e._attachToScene=function(){this._trailModel&&(this._trailModel.scene&&this._detachFromScene(),this._particleSystem._getRenderScene().addModel(this._trailModel))},e._detachFromScene=function(){this._trailModel&&this._trailModel.scene&&this._trailModel.scene.removeModel(this._trailModel)},e.destroy=function(){this.destroySubMeshData(),this._trailModel&&(Ot.root.destroyModel(this._trailModel),this._trailModel=null),this._trailSegments&&(this._trailSegments.destroy((function(t){t.trailElements.length=0})),this._trailSegments=null)},e.clear=function(){if(this.enable){for(var t=this._particleTrail.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this._particleTrail.clear(),this.updateRenderData()}},e.updateMaterial=function(){this._particleSystem&&(this._material=this._particleSystem.getMaterialInstance(1)||this._particleSystem.processor._defaultTrailMat,this._trailModel&&this._trailModel.setSubModelMaterial(0,this._material))},e.update=function(){this._trailLifetime=this.lifeTime.evaluate(this._particleSystem._time,1),this.space===Or.World&&this._particleSystem._simulationSpace===Or.Local?(this._needTransform=!0,this._particleSystem.node.getWorldMatrix(cp),this._particleSystem.node.getWorldRotation(hp)):this._needTransform=!1},e.animate=function(t,e){if(this._trailSegments){var i=this._particleTrail.get(t);if(!i)return i=this._trailSegments.alloc(),void this._particleTrail.set(t,i);var r=i.getElement(i.end-1);if(this._needTransform?b.transformMat4(_p,t.position,cp):b.copy(_p,t.position),!(r&&(i.iterateElement(this,this._updateTrailElement,t,e),b.squaredDistance(r.position,_p)<this._minSquaredDistance))&&(r=i.addElement())){b.copy(r.position,_p),r.lifetime=0,this.widthFromParticle?r.width=t.size.x*this.widthRatio.evaluate(0,1):r.width=this.widthRatio.evaluate(0,1);var n=i.count();if(2===n){var a=i.getElement(i.end-2);b.subtract(a.velocity,r.position,a.position)}else if(n>2){var o=i.getElement(i.end-2),s=i.getElement(i.end-3);b.subtract(_p,s.position,o.position),b.subtract(pp,r.position,o.position),b.subtract(o.velocity,pp,_p),b.equals(b.ZERO,o.velocity)&&b.copy(o.velocity,_p),b.normalize(o.velocity,o.velocity),this._checkDirectionReverse(o,s)}this.colorFromParticle?r.color.set(t.color):r.color.set(this.colorOvertime.evaluate(0,1))}}},e.removeParticle=function(t){var e=this._particleTrail.get(t);e&&this._trailSegments&&(e.clear(),this._trailSegments.free(e),this._particleTrail.delete(t))},e.updateRenderData=function(){this.vbOffset=0,this.ibOffset=0;for(var t,e=g(this._particleTrail.keys());!(t=e()).done;){var i=t.value,r=this._particleTrail.get(i);if(-1!==r.start){var n=4*this.vbOffset/this._vertSize,a=r.start>=r.end?r.end+r.trailElements.length:r.end,o=a-r.start,s=1/o,l=r.trailElements[r.start];this._fillVertexBuffer(l,this.colorOverTrail.evaluate(1,1),n,1,0,4);for(var u=r.start+1;u<a;u++){var h=r.trailElements[u%r.trailElements.length],c=u-r.start;this._fillVertexBuffer(h,this.colorOverTrail.evaluate(1-c/o,1),n,1-c*s,c,5)}if(this._needTransform?b.transformMat4(up.position,i.position,cp):b.copy(up.position,i.position),1===o||2===o){var _=r.getElement(r.end-1);b.subtract(_.velocity,up.position,_.position),this._vbF32[this.vbOffset-this._vertSize/4-4]=_.velocity.x,this._vbF32[this.vbOffset-this._vertSize/4-3]=_.velocity.y,this._vbF32[this.vbOffset-this._vertSize/4-2]=_.velocity.z,this._vbF32[this.vbOffset-4]=_.velocity.x,this._vbF32[this.vbOffset-3]=_.velocity.y,this._vbF32[this.vbOffset-2]=_.velocity.z,b.subtract(up.velocity,up.position,_.position),this._checkDirectionReverse(up,_)}else if(o>2){var p=r.getElement(r.end-1),d=r.getElement(r.end-2);b.subtract(_p,d.position,p.position),b.subtract(pp,up.position,p.position),b.normalize(_p,_p),b.normalize(pp,pp),b.subtract(p.velocity,pp,_p),b.normalize(p.velocity,p.velocity),this._checkDirectionReverse(p,d),this.vbOffset-=this._vertSize/4*2,this.ibOffset-=6,this._fillVertexBuffer(p,this.colorOverTrail.evaluate(s,1),n,s,o-1,5),b.subtract(up.velocity,up.position,p.position),b.normalize(up.velocity,up.velocity),this._checkDirectionReverse(up,p)}this.widthFromParticle?up.width=i.size.x*this.widthRatio.evaluate(0,1):up.width=this.widthRatio.evaluate(0,1),up.color=i.color,b.equals(up.velocity,b.ZERO)?this.ibOffset-=3:this._fillVertexBuffer(up,this.colorOverTrail.evaluate(0,1),n,0,o,1)}}this.updateIA(this.ibOffset)},e.updateIA=function(t){var e=this._trailModel&&this._trailModel.subModels;if(e&&e.length>0){var i=e[0];i.inputAssembler.vertexBuffers[0].update(this._vbF32),i.inputAssembler.indexBuffer.update(this._iBuffer),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=t,this._iaInfoBuffer.update(this._iaInfo)}},e._createModel=function(){this._trailModel||(this._trailModel=h.director.root.createModel(tt))},e.rebuild=function(){var t=Ot.root.device,e=t.createBuffer(new nt(at.VERTEX|at.TRANSFER_DST,ot.HOST|ot.DEVICE,this._vertSize*(this._trailNum+1)*2,this._vertSize)),i=new ArrayBuffer(this._vertSize*(this._trailNum+1)*2);this._vbF32=new Float32Array(i),this._vbUint32=new Uint32Array(i),e.update(i);var r=t.createBuffer(new nt(at.INDEX|at.TRANSFER_DST,ot.HOST|ot.DEVICE,6*this._trailNum*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));this._iBuffer=new Uint16Array(6*this._trailNum),r.update(this._iBuffer),this._iaInfoBuffer=t.createBuffer(new nt(at.INDIRECT,ot.HOST|ot.DEVICE,ct,ct)),this._iaInfo.drawInfos[0].vertexCount=2*(this._trailNum+1),this._iaInfo.drawInfos[0].indexCount=6*this._trailNum,this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new st([e],this._vertAttrs,q.TRIANGLE_LIST,r,this._iaInfoBuffer);var n=this._trailModel;n&&(n.node=n.transform=this._particleSystem.node,n.visFlags=this._particleSystem.visibility,n.initSubModel(0,this._subMeshData,this._material),n.enabled=!0)},e._updateTrailElement=function(t,e,i,r){return e.lifetime+=r,t.colorFromParticle?(e.color.set(i.color),e.color.multiply(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1))):e.color.set(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1)),t.widthFromParticle?e.width=i.size.x*t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1):e.width=t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1),e.lifetime>t._trailLifetime},e._fillVertexBuffer=function(t,e,i,r,n,a){this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=r,this._vbF32[this.vbOffset++]=0,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,dp.set(t.color),dp.multiply(e),this._vbUint32[this.vbOffset++]=dp._val,this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=1-t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=r,this._vbF32[this.vbOffset++]=1,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,this._vbUint32[this.vbOffset++]=dp._val,1&a&&(this._iBuffer[this.ibOffset++]=i+2*n,this._iBuffer[this.ibOffset++]=i+2*n-1,this._iBuffer[this.ibOffset++]=i+2*n+1),4&a&&(this._iBuffer[this.ibOffset++]=i+2*n,this._iBuffer[this.ibOffset++]=i+2*n+1,this._iBuffer[this.ibOffset++]=i+2*n+2)},e._checkDirectionReverse=function(t,e){b.dot(t.velocity,e.velocity)<lp?t.direction=1-e.direction:t.direction=e.direction},e.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},t}(),_((Qu=ch).prototype,"enable",[wu],Object.getOwnPropertyDescriptor(Qu.prototype,"enable"),Qu.prototype),Ju=_(Qu.prototype,"_enable",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$u=_(Qu.prototype,"mode",[Mu,v,Tu,Su],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ar.Particles}}),th=_(Qu.prototype,"lifeTime",[Ou,v,xu,zu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),eh=_(Qu.prototype,"_minParticleDistance",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),_(Qu.prototype,"minParticleDistance",[Eu,Cu],Object.getOwnPropertyDescriptor(Qu.prototype,"minParticleDistance"),Qu.prototype),_(Qu.prototype,"space",[Au,Ru,Fu],Object.getOwnPropertyDescriptor(Qu.prototype,"space"),Qu.prototype),ih=_(Qu.prototype,"existWithParticles",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rh=_(Qu.prototype,"textureMode",[Du,v,Pu,Iu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Rr.Stretch}}),nh=_(Qu.prototype,"widthFromParticle",[v,Lu,Bu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ah=_(Qu.prototype,"widthRatio",[Uu,v,Vu,ku],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),oh=_(Qu.prototype,"colorFromParticle",[v,Gu,Hu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sh=_(Qu.prototype,"colorOverTrail",[Nu,v,Wu,ju],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Li}}),lh=_(Qu.prototype,"colorOvertime",[Xu,v,Ku,Yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Li}}),uh=_(Qu.prototype,"_space",[Zu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Or.World}}),hh=_(Qu.prototype,"_particleSystem",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qu=Qu))||qu),yp=new A,vp=new R,bp=Object.getOwnPropertyDescriptor(wt.prototype,"sharedMaterials"),gp=function(e){return t({ParticleSystem:e,ParticleSystemComponent:e}),e}((_h=e("cc.ParticleSystem"),ph=p(),dh=d(),fh=Mt(99),mh=z(),yh=f(),vh=i(Li),bh=z(),gh=f(),wh=i(Or),Mh=z(),Th=f(),Sh=z(),Oh=f(),xh=B("startSize"),zh=i(ze),Eh=z(),Ch=f(),Ah=i(ze),Rh=z(),Fh=f(),Dh=i(ze),Ph=z(),Ih=f(),Lh=i(ze),Bh=I(),Uh=z(),Vh=f(),kh=z(),Gh=f(),Hh=i(ze),Nh=I(),Wh=z(),jh=f(),Xh=i(ze),Kh=I(),Yh=z(),Zh=f(),qh=i(ze),Qh=B("startRotation"),Jh=I(),$h=z(),tc=f(),ec=i(ze),ic=z(),rc=f(),nc=i(ze),ac=z(),oc=f(),sc=z(),lc=f(),uc=z(),hc=f(),cc=z(),_c=f(),pc=i(Or),dc=z(),fc=f(),mc=z(),yc=f(),vc=z(),bc=f(),gc=i(ze),wc=I(),Mc=z(),Tc=f(),Sc=i(ze),Oc=z(),xc=f(),zc=i(ze),Ec=z(),Cc=f(),Ac=i([bl]),Rc=z(),Fc=f(),Dc=i(et),Pc=W(),Ic=j(),Lc=i(Fr),Bc=i(Fr),Uc=z(),Vc=f(),kc=i(Tl),Gc=i(Tl),Hc=z(),Nc=f(),Wc=i(pl),jc=i(pl),Xc=z(),Kc=f(),Yc=i(vl),Zc=i(vl),qc=z(),Qc=f(),Jc=i(Zn),$c=i(Zn),t_=z(),e_=f(),i_=i(Jn),r_=i(Jn),n_=z(),a_=f(),o_=i(_l),s_=i(_l),l_=z(),u_=f(),h_=i(ml),c_=i(ml),__=z(),p_=f(),d_=i(mp),f_=i(mp),m_=z(),y_=f(),v_=i(sp),b_=z(),g_=f(),w_=z(),M_=f(),_h(T_=ph(T_=dh(T_=fh(T_=r((op=function(t){function e(){var e;return e=t.call(this)||this,o(e,"startColor",O_,s(e)),o(e,"scaleSpace",x_,s(e)),o(e,"startSize3D",z_,s(e)),o(e,"startSizeX",E_,s(e)),o(e,"startSizeY",C_,s(e)),o(e,"startSizeZ",A_,s(e)),o(e,"startSpeed",R_,s(e)),o(e,"startRotation3D",F_,s(e)),o(e,"startRotationX",D_,s(e)),o(e,"startRotationY",P_,s(e)),o(e,"startRotationZ",I_,s(e)),o(e,"startDelay",L_,s(e)),o(e,"startLifetime",B_,s(e)),o(e,"duration",U_,s(e)),o(e,"loop",V_,s(e)),o(e,"simulationSpeed",k_,s(e)),o(e,"playOnAwake",G_,s(e)),o(e,"gravityModifier",H_,s(e)),o(e,"rateOverTime",N_,s(e)),o(e,"rateOverDistance",W_,s(e)),o(e,"bursts",j_,s(e)),o(e,"_colorOverLifetimeModule",X_,s(e)),o(e,"_shapeModule",K_,s(e)),o(e,"_sizeOvertimeModule",Y_,s(e)),o(e,"_velocityOvertimeModule",Z_,s(e)),o(e,"_forceOvertimeModule",q_,s(e)),o(e,"_limitVelocityOvertimeModule",Q_,s(e)),o(e,"_rotationOvertimeModule",J_,s(e)),o(e,"_textureAnimationModule",$_,s(e)),o(e,"_trailModule",tp,s(e)),o(e,"renderer",ep,s(e)),o(e,"enableCulling",ip,s(e)),e._isPlaying=void 0,e._isPaused=void 0,e._isStopped=void 0,e._isEmitting=void 0,e._time=void 0,e._emitRateTimeCounter=void 0,e._emitRateDistanceCounter=void 0,e._oldWPos=void 0,e._curWPos=void 0,e._customData1=void 0,e._customData2=void 0,e._subEmitters=void 0,o(e,"_prewarm",rp,s(e)),o(e,"_capacity",np,s(e)),o(e,"_simulationSpace",ap,s(e)),e.processor=null,e.rateOverTime.constant=10,e.startLifetime.constant=5,e.startSizeX.constant=1,e.startSpeed.constant=5,e._isPlaying=!1,e._isPaused=!1,e._isStopped=!0,e._isEmitting=!1,e._time=0,e._emitRateTimeCounter=0,e._emitRateDistanceCounter=0,e._oldWPos=new b,e._curWPos=new b,e._customData1=new x,e._customData2=new x,e._subEmitters=[],e}n(e,t),a(e,[{key:"capacity",get:function(){return this._capacity},set:function(t){this._capacity=Math.floor(t),this.processor&&this.processor._model&&this.processor._model.setCapacity(this._capacity)}},{key:"prewarm",get:function(){return this._prewarm},set:function(t){!0===t&&this.loop,this._prewarm=t}},{key:"simulationSpace",get:function(){return this._simulationSpace},set:function(t){t!==this._simulationSpace&&(this._simulationSpace=t,this.processor&&(this.processor.updateMaterialParams(),this.processor.updateTrailMaterial()))}},{key:"sharedMaterials",get:function(){return bp.get.call(this)},set:function(t){bp.set.call(this,t)}},{key:"colorOverLifetimeModule",get:function(){return this._colorOverLifetimeModule},set:function(t){t&&(this._colorOverLifetimeModule=t)}},{key:"shapeModule",get:function(){return this._shapeModule},set:function(t){t&&(this._shapeModule=t)}},{key:"sizeOvertimeModule",get:function(){return this._sizeOvertimeModule},set:function(t){t&&(this._sizeOvertimeModule=t)}},{key:"velocityOvertimeModule",get:function(){return this._velocityOvertimeModule},set:function(t){t&&(this._velocityOvertimeModule=t)}},{key:"forceOvertimeModule",get:function(){return this._forceOvertimeModule},set:function(t){t&&(this._forceOvertimeModule=t)}},{key:"limitVelocityOvertimeModule",get:function(){return this._limitVelocityOvertimeModule},set:function(t){t&&(this._limitVelocityOvertimeModule=t)}},{key:"rotationOvertimeModule",get:function(){return this._rotationOvertimeModule},set:function(t){t&&(this._rotationOvertimeModule=t)}},{key:"textureAnimationModule",get:function(){return this._textureAnimationModule},set:function(t){t&&(this._textureAnimationModule=t)}},{key:"trailModule",get:function(){return this._trailModule},set:function(t){t&&(this._trailModule=t)}}]);var i=e.prototype;return i.onLoad=function(){this.renderer.onInit(this),this._shapeModule&&this._shapeModule.onInit(this),this._trailModule&&this._trailModule.onInit(this),this.bindModule(),this._resetPosition()},i._onMaterialModified=function(t,e){this.processor.onMaterialModified(t,e)},i._onRebuildPSO=function(t,e){this.processor.onRebuildPSO(t,e)},i._collectModels=function(){return this._models.length=0,this._models.push(this.processor._model),this._trailModule&&this._trailModule.enable&&this._trailModule._trailModel&&this._models.push(this._trailModule._trailModel),this._models},i._attachToScene=function(){this.processor.attachToScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._attachToScene()},i._detachFromScene=function(){this.processor.detachFromScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._detachFromScene()},i.bindModule=function(){this._colorOverLifetimeModule&&this._colorOverLifetimeModule.bindTarget(this.processor),this._sizeOvertimeModule&&this._sizeOvertimeModule.bindTarget(this.processor),this._rotationOvertimeModule&&this._rotationOvertimeModule.bindTarget(this.processor),this._forceOvertimeModule&&this._forceOvertimeModule.bindTarget(this.processor),this._limitVelocityOvertimeModule&&this._limitVelocityOvertimeModule.bindTarget(this.processor),this._velocityOvertimeModule&&this._velocityOvertimeModule.bindTarget(this.processor),this._textureAnimationModule&&this._textureAnimationModule.bindTarget(this.processor)},i.play=function(){this._isPaused&&(this._isPaused=!1),this._isStopped&&(this._isStopped=!1),this._isPlaying=!0,this._isEmitting=!0,this._resetPosition(),this._prewarm&&this._prewarmSystem()},i.pause=function(){this._isStopped?console.warn("pause(): particle system is already stopped."):(this._isPlaying&&(this._isPlaying=!1),this._isPaused=!0)},i.stop=function(){(this._isPlaying||this._isPaused)&&this.clear(),this._isPlaying&&(this._isPlaying=!1),this._isPaused&&(this._isPaused=!1),this._time=0,this._emitRateTimeCounter=0,this._emitRateDistanceCounter=0,this._isStopped=!0},i.clear=function(){this.enabledInHierarchy&&(this.processor.clear(),this._trailModule&&this._trailModule.clear())},i.getParticleCount=function(){return this.processor.getParticleCount()},i.setCustomData1=function(t,e){x.set(this._customData1,t,e)},i.setCustomData2=function(t,e){x.set(this._customData2,t,e)},i.onDestroy=function(){this.processor.onDestroy(),this._trailModule&&this._trailModule.destroy()},i.onEnable=function(){this.playOnAwake&&this.play(),this.processor.onEnable(),this._trailModule&&this._trailModule.onEnable()},i.onDisable=function(){this.processor.onDisable(),this._trailModule&&this._trailModule.onDisable()},i.update=function(t){var e=t*this.simulationSpeed;this._isPlaying&&(this._time+=e,this._emit(e),0!==this.processor.updateParticles(e)||this._isEmitting||this.stop(),this.processor.updateRenderData(),this._trailModule&&this._trailModule.enable&&this._trailModule.updateRenderData())},i._onVisibilityChange=function(t){this.processor._model&&(this.processor._model.visFlags=t)},i.emit=function(t,e){var i=this._time/this.duration;this._simulationSpace===Or.World&&(this.node.getWorldMatrix(yp),this.node.getWorldRotation(vp));for(var r=0;r<t;++r){var n=this.processor.getFreeParticle();if(null===n)return;var a=E(P(0,H));this._shapeModule&&this._shapeModule.enable?this._shapeModule.emit(n):(b.set(n.position,0,0,0),b.copy(n.velocity,Dr)),this._textureAnimationModule&&this._textureAnimationModule.enable&&this._textureAnimationModule.init(n),b.multiplyScalar(n.velocity,n.velocity,this.startSpeed.evaluate(i,a)),this._simulationSpace===Or.World&&(b.transformMat4(n.position,n.position,yp),b.transformQuat(n.velocity,n.velocity,vp)),b.copy(n.ultimateVelocity,n.velocity),this.startRotation3D?b.set(n.rotation,this.startRotationX.evaluate(i,a),this.startRotationY.evaluate(i,a),this.startRotationZ.evaluate(i,a)):b.set(n.rotation,0,0,this.startRotationZ.evaluate(i,a)),this.startSize3D?b.set(n.startSize,this.startSizeX.evaluate(i,a),this.startSizeY.evaluate(i,a),this.startSizeZ.evaluate(i,a)):(b.set(n.startSize,this.startSizeX.evaluate(i,a),1,1),n.startSize.y=n.startSize.x),b.copy(n.size,n.startSize),n.startColor.set(this.startColor.evaluate(i,a)),n.color.set(n.startColor),n.startLifetime=this.startLifetime.evaluate(i,a)+e,n.remainingLifetime=n.startLifetime,n.randomSeed=P(0,233280),this.processor.setNewParticle(n)}},i._prewarmSystem=function(){this.startDelay.mode=xe.Constant,this.startDelay.constant=0;for(var t=this.duration/1,e=0;e<t;++e)this._time+=1,this._emit(1),this.processor.updateParticles(1)},i._emit=function(t){var e=this.startDelay.evaluate(0,1);if(this._time>e){if(this._time>this.duration+e&&!this.loop)return void(this._isEmitting=!1);if(this._emitRateTimeCounter+=this.rateOverTime.evaluate(this._time/this.duration,1)*t,this._emitRateTimeCounter>1&&this._isEmitting){var i=Math.floor(this._emitRateTimeCounter);this._emitRateTimeCounter-=i,this.emit(i,t)}this.node.getWorldPosition(this._curWPos);var r=b.distance(this._curWPos,this._oldWPos);if(b.copy(this._oldWPos,this._curWPos),this._emitRateDistanceCounter+=r*this.rateOverDistance.evaluate(this._time/this.duration,1),this._emitRateDistanceCounter>1&&this._isEmitting){var n=Math.floor(this._emitRateDistanceCounter);this._emitRateDistanceCounter-=n,this.emit(n,t)}for(var a,o=g(this.bursts);!(a=o()).done;)a.value.update(this,t)}},i._resetPosition=function(){this.node.getWorldPosition(this._oldWPos),b.copy(this._curWPos,this._oldWPos)},i.addSubEmitter=function(t){this._subEmitters.push(t)},i.removeSubEmitter=function(t){this._subEmitters.splice(this._subEmitters.indexOf(t),1)},i.addBurst=function(t){this.bursts.push(t)},i.removeBurst=function(t){this.bursts.splice(this.bursts.indexOf(t),1)},i._onBeforeSerialize=function(t){var e=this;return this.enableCulling?t.filter((function(t){return!Tr.includes(t)||e[t]&&e[t].enable})):t},a(e,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isStopped",get:function(){return this._isStopped}},{key:"isEmitting",get:function(){return this._isEmitting}},{key:"time",get:function(){return this._time}}]),e}(wt),_((S_=op).prototype,"capacity",[mh,yh],Object.getOwnPropertyDescriptor(S_.prototype,"capacity"),S_.prototype),O_=_(S_.prototype,"startColor",[vh,v,bh,gh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Li}}),x_=_(S_.prototype,"scaleSpace",[wh,v,Mh,Th],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Or.Local}}),z_=_(S_.prototype,"startSize3D",[v,Sh,Oh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),E_=_(S_.prototype,"startSizeX",[xh,zh,Eh,Ch],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),C_=_(S_.prototype,"startSizeY",[Ah,v,Rh,Fh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),A_=_(S_.prototype,"startSizeZ",[Dh,v,Ph,Ih],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),R_=_(S_.prototype,"startSpeed",[Lh,v,Bh,Uh,Vh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),F_=_(S_.prototype,"startRotation3D",[v,kh,Gh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),D_=_(S_.prototype,"startRotationX",[Hh,v,Nh,L,Wh,jh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),P_=_(S_.prototype,"startRotationY",[Xh,v,Kh,L,Yh,Zh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),I_=_(S_.prototype,"startRotationZ",[qh,Qh,Jh,L,$h,tc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),L_=_(S_.prototype,"startDelay",[ec,v,ic,rc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),B_=_(S_.prototype,"startLifetime",[nc,v,ac,oc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),U_=_(S_.prototype,"duration",[v,sc,lc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),V_=_(S_.prototype,"loop",[v,uc,hc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_(S_.prototype,"prewarm",[cc,_c],Object.getOwnPropertyDescriptor(S_.prototype,"prewarm"),S_.prototype),_(S_.prototype,"simulationSpace",[pc,v,dc,fc],Object.getOwnPropertyDescriptor(S_.prototype,"simulationSpace"),S_.prototype),k_=_(S_.prototype,"simulationSpeed",[v,mc,yc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),G_=_(S_.prototype,"playOnAwake",[v,vc,bc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),H_=_(S_.prototype,"gravityModifier",[gc,v,wc,Mc,Tc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),N_=_(S_.prototype,"rateOverTime",[Sc,v,Oc,xc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),W_=_(S_.prototype,"rateOverDistance",[zc,v,Ec,Cc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze}}),j_=_(S_.prototype,"bursts",[Ac,v,Rc,Fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_(S_.prototype,"sharedMaterials",[N,Dc,v,Pc,Ic],Object.getOwnPropertyDescriptor(S_.prototype,"sharedMaterials"),S_.prototype),X_=_(S_.prototype,"_colorOverLifetimeModule",[Lc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(S_.prototype,"colorOverLifetimeModule",[Bc,Uc,Vc],Object.getOwnPropertyDescriptor(S_.prototype,"colorOverLifetimeModule"),S_.prototype),K_=_(S_.prototype,"_shapeModule",[kc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(S_.prototype,"shapeModule",[Gc,Hc,Nc],Object.getOwnPropertyDescriptor(S_.prototype,"shapeModule"),S_.prototype),Y_=_(S_.prototype,"_sizeOvertimeModule",[Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(S_.prototype,"sizeOvertimeModule",[jc,Xc,Kc],Object.getOwnPropertyDescriptor(S_.prototype,"sizeOvertimeModule"),S_.prototype),Z_=_(S_.prototype,"_velocityOvertimeModule",[Yc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(S_.prototype,"velocityOvertimeModule",[Zc,qc,Qc],Object.getOwnPropertyDescriptor(S_.prototype,"velocityOvertimeModule"),S_.prototype),q_=_(S_.prototype,"_forceOvertimeModule",[Jc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(S_.prototype,"forceOvertimeModule",[$c,t_,e_],Object.getOwnPropertyDescriptor(S_.prototype,"forceOvertimeModule"),S_.prototype),Q_=_(S_.prototype,"_limitVelocityOvertimeModule",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(S_.prototype,"limitVelocityOvertimeModule",[r_,n_,a_],Object.getOwnPropertyDescriptor(S_.prototype,"limitVelocityOvertimeModule"),S_.prototype),J_=_(S_.prototype,"_rotationOvertimeModule",[o_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(S_.prototype,"rotationOvertimeModule",[s_,l_,u_],Object.getOwnPropertyDescriptor(S_.prototype,"rotationOvertimeModule"),S_.prototype),$_=_(S_.prototype,"_textureAnimationModule",[h_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(S_.prototype,"textureAnimationModule",[c_,__,p_],Object.getOwnPropertyDescriptor(S_.prototype,"textureAnimationModule"),S_.prototype),tp=_(S_.prototype,"_trailModule",[d_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(S_.prototype,"trailModule",[f_,m_,y_],Object.getOwnPropertyDescriptor(S_.prototype,"trailModule"),S_.prototype),ep=_(S_.prototype,"renderer",[v_,v,b_,g_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new sp}}),ip=_(S_.prototype,"enableCulling",[v,w_,M_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rp=_(S_.prototype,"_prewarm",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),np=_(S_.prototype,"_capacity",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),ap=_(S_.prototype,"_simulationSpace",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Or.Local}}),T_=S_))||T_)||T_)||T_)||T_)||T_)),wp=t("ParticleUtils",function(){function t(){}return t.instantiate=function(t){return this.registeredSceneEvent||(Ot.on(xt.EVENT_BEFORE_SCENE_LAUNCH,this.onSceneUnload,this),this.registeredSceneEvent=!0),this.particleSystemPool.has(t._uuid)||this.particleSystemPool.set(t._uuid,new G((function(){return St(t)||new Tt}),1)),this.particleSystemPool.get(t._uuid).alloc()},t.destroy=function(t){this.particleSystemPool.has(t._prefab.asset._uuid)&&(this.stop(t),this.particleSystemPool.get(t._prefab.asset._uuid).free(t))},t.play=function(t){for(var e,i=g(t.getComponentsInChildren(gp));!(e=i()).done;)e.value.play()},t.stop=function(t){for(var e,i=g(t.getComponentsInChildren(gp));!(e=i()).done;)e.value.stop()},t.onSceneUnload=function(){this.particleSystemPool.forEach((function(t){t.destroy((function(t){t.destroy()}))})),this.particleSystemPool.clear()},t}());wp.particleSystemPool=new Map,wp.registeredSceneEvent=!1,X(bl.prototype,"Burst.prototype",[{name:"minCount"},{name:"maxCount"}]),h.ParticleSystemComponent=gp,K.setClassAlias(gp,"cc.ParticleSystemComponent"),h.BillboardComponent=ge,K.setClassAlias(ge,"cc.BillboardComponent"),h.LineComponent=gr,K.setClassAlias(gr,"cc.LineComponent"),h.ParticleUtils=wp}}}));
