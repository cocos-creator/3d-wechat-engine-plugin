System.register(["./deprecated-0768b3d4.js","./deprecated-4df5f565.js","./deprecated-88eb2353.js","./screen-f991c158.js"],(function(t){"use strict";var e,i,n,r,a,s,o,u,h,l,c,f,p,m,d,_,g,v,y,b,w,S,T,A,k,x,E,C,I,N,P,M,R,O,D,B,F,z,L,V,U,W,j,H,q,G,Y,K,X,$,Q,J,Z,tt,et,it,nt,rt,at,st,ot,ut,ht,lt,ct,ft,pt,mt,dt,_t,gt,vt,yt,bt,wt,St,Tt,At,kt,xt,Et,Ct,It,Nt,Pt,Mt,Rt,Ot,Dt,Bt,Ft,zt,Lt,Vt,Ut,Wt,jt,Ht,qt,Gt,Yt,Kt,Xt,$t,Qt,Jt,Zt,te,ee,ie,ne,re,ae,se,oe,ue,he,le,ce,fe,pe,me,de,_e,ge,ve,ye,be,we,Se,Te,Ae,ke,xe,Ee,Ce,Ie,Ne,Pe,Me,Re,Oe,De,Be,Fe,ze,Le,Ve,Ue,We,je,He,qe,Ge,Ye,Ke,Xe,$e,Qe,Je,Ze,ti,ei,ii,ni,ri,ai,si,oi,ui,hi,li,ci,fi,pi,mi,di,_i,gi,vi,yi,bi,wi,Si,Ti,Ai,ki,xi,Ei;return{setters:[function(t){e=t.U,i=t.W,n=t.X,r=t.V,a=t.Y,s=t.Z,o=t.$,u=t.a0,h=t.a1,l=t.a2,c=t.a3,f=t.a4,p=t.a5,m=t.a6,d=t.a7,_=t.a8,g=t.a9,v=t.aa,y=t.ab,b=t.ac,w=t.ad,S=t.ae,T=t.g,A=t.af,k=t.ag,x=t.ah,E=t.ai,C=t.aj,I=t.ak,N=t.al,P=t.am,M=t.an,R=t.ao,O=t.ap,D=t.aq,B=t.ar,F=t.as,z=t.at,L=t.au,V=t.c,U=t.bc,W=t.b5,j=t.m,H=t.b_,q=t.bn,G=t.b$,Y=t.h,K=t.t,X=t.c0,$=t.c1,Q=t.c2,J=t.bz,Z=t.aF,tt=t.l,et=t.n,it=t.j,nt=t.aw,rt=t.b,at=t.e,st=t.s,ot=t._,ut=t.a,ht=t.f,lt=t.d,ct=t.T,ft=t.aK,pt=t.o,mt=t.bh,dt=t.E,_t=t.C,gt=t.bA,vt=t.r,yt=t.c3,bt=t.aC,wt=t.aB,St=t.w,Tt=t.Q,At=t.z,kt=t.A,xt=t.q,Et=t.S,Ct=t.c4,It=t.bw,Nt=t.c5,Pt=t.y,Mt=t.aN,Rt=t.bD,Ot=t.bd},function(t){Dt=t.ed,Bt=t.ee,Ft=t.ef,zt=t.eg,Lt=t.eh,Vt=t.e0,Ut=t.ei,Wt=t.ej,jt=t.ek,Ht=t.el,qt=t.em,Gt=t.en,Yt=t.eo,Kt=t.ep,Xt=t.eq,$t=t.er,Qt=t.es,Jt=t.et,Zt=t.eu,te=t.ev,ee=t.ew,ie=t.ex,ne=t.ey,re=t.ez,ae=t.dS,se=t.eA,oe=t.bo,ue=t.eB,he=t.eC,le=t.eD,ce=t.e6,fe=t.e5,pe=t.e7,me=t.dQ,de=t.m,_e=t.S,ge=t.dV,ve=t.A,ye=t.a,be=t.F,we=t.cN,Se=t.bp,Te=t.bK,Ae=t.cX,ke=t.bH,xe=t.eE,Ee=t.ec,Ce=t.dZ,Ie=t.cf,Ne=t.L,Pe=t.G,Me=t.D,Re=t.U,Oe=t.E,De=t.W,Be=t.ab,Fe=t._,ze=t.a8,Le=t.dU,Ve=t.d_,Ue=t.ah,We=t.eF,je=t.dX,He=t.eG,qe=t.bm,Ge=t.bC,Ye=t.bj,Ke=t.bn,Xe=t.eH,$e=t.eI,Qe=t.bl,Je=t.i,Ze=t.l,ti=t.k,ei=t.dx,ii=t.cs,ni=t.ct,ri=t.dR,ai=t.cG,si=t.cS,oi=t.dN,ui=t.eJ,hi=t.aq,li=t.ar,ci=t.aE,fi=t.aD,pi=t.B,mi=t.b,di=t.M,_i=t.I,gi=t.cQ,vi=t.dp,yi=t.cr,bi=t.bW,wi=t.X},function(t){Si=t.e,Ti=t.o,Ai=t.h,ki=t.g,xi=t.f,Ei=t.n},function(){}],execute:function(){t({B:Ds,F:Bs,i:Gi,r:Su,s:Tu,t:Au,x:ks,y:Ms});var Ci=Object.freeze({__proto__:null,bits:e,Vec2:i,v2:n,Vec3:r,v3:a,Vec4:s,v4:o,Quat:u,quat:h,Mat3:l,Mat4:c,mat4:f,AffineTransform:p,Size:m,size:d,Rect:_,rect:g,Color:v,color:y,EPSILON:b,equals:w,approx:S,clamp:T,clamp01:A,lerp:k,toRadian:x,toDegree:E,random:C,randomRange:I,randomRangeInt:N,pseudoRandom:P,pseudoRandomRange:M,pseudoRandomRangeInt:R,nextPow2:O,repeat:D,pingPong:B,inverseLerp:F,absMaxComponent:z,absMax:L});t("m",Ci);var Ii=Object.freeze({__proto__:null,distance:Dt,enums:Bt,intersect:Ft,Line:zt,Plane:Lt,Ray:Vt,Triangle:Ut,Sphere:Wt,AABB:jt,OBB:Ht,Capsule:qt,Frustum:Gt,Keyframe:Yt,AnimationCurve:Kt,get ERaycastMode(){return Xt},line:$t,plane:Qt,ray:Jt,triangle:Zt,sphere:te,aabb:ee,obb:ie,capsule:ne,frustum:re});t("g",Ii);var Ni=Object.freeze({__proto__:null,find:ae,toPPM:function(t,e,i){return"P3 "+e+" "+i+" 255\n"+t.filter((function(t,e){return e%4<3})).toString()+"\n"},readMesh:se,createMesh:oe,readBuffer:ue,writeBuffer:he,mapBuffer:le});t("u",Ni);var Pi=Object.freeze({__proto__:null,ccclass:V,property:U,requireComponent:ce,executionOrder:fe,disallowMultiple:pe,executeInEditMode:W,menu:j,playOnFocus:H,inspector:q,icon:G,help:Y,type:K,integer:X,float:$,boolean:Q,string:J});t("_",Pi);var Mi,Ri,Oi,Di,Bi,Fi,zi,Li,Vi,Ui,Wi,ji=Z.Flags.Destroyed,Hi=Z.Flags.PersistentMask,qi=[];function Gi(t){var e;if(t instanceof Z){if(t._instantiate)return tt.game._isCloning=!0,e=t._instantiate(),tt.game._isCloning=!1,e;if(t instanceof tt.Asset)throw new TypeError(et(6903))}return tt.game._isCloning=!0,e=Yi(t),tt.game._isCloning=!1,e}function Yi(t,e){var i;Ki(t,i=t._iN$t?t._iN$t:t.constructor?new(0,t.constructor):Object.create(null),e);for(var n=0,r=qi.length;n<r;++n)qi[n]._iN$t=null;return qi.length=0,i}function Ki(t,e,i){it.value(t,"_iN$t",e,!0),qi.push(t);var n=t.constructor;if(tt.Class._isCCClass(n))!function(t,e,i,n){for(var r=t.__values__,a=0;a<r.length;a++){var s=r[a],o=e[s];if("object"==typeof o&&o){var u=i[s];u instanceof nt&&u.constructor===o.constructor?u.set(o):i[s]=o._iN$t||Xi(o,n)}else i[s]=o}}(n,t,e,i);else for(var r in t)if(t.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var a=t[r];if("object"==typeof a&&a){if(a===e)continue;e[r]=a._iN$t||Xi(a,i)}else e[r]=a}t instanceof Z&&(e._objFlags&=Hi)}function Xi(t,e){if(t instanceof nt)return t.clone();if(t instanceof tt.Asset)return t;var i;if(ArrayBuffer.isView(t)){var n=t.length;i=new t.constructor(n),t._iN$t=i,qi.push(t);for(var r=0;r<n;++r)i[r]=t[r];return i}if(Array.isArray(t)){var a=t.length;i=new Array(a),t._iN$t=i,qi.push(t);for(var s=0;s<a;++s){var o=t[s];i[s]="object"==typeof o&&o?o._iN$t||Xi(o,e):o}return i}if(t._objFlags&ji)return null;var u=t.constructor;if(tt.Class._isCCClass(u)){if(e)if(e instanceof tt.Component){if(t instanceof tt._BaseNode||t instanceof tt.Component)return t}else if(e instanceof tt._BaseNode)if(t instanceof tt._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof tt.Component&&!t.node.isChildOf(e))return t;i=new u}else if(u===Object)i={};else{if(u)return t;i=Object.create(null)}return Ki(t,i,e),i}function $i(t,e){return(e<<3)+t}Gi._clone=Yi,tt.instantiate=Gi,function(t){t[t.Uint8=0]="Uint8",t[t.Uint16=1]="Uint16",t[t.Uint32=2]="Uint32",t[t.Int8=3]="Int8",t[t.Int16=4]="Int16",t[t.Int32=5]="Int32",t[t.Float32=6]="Float32",t[t.Float64=7]="Float64"}(Ui||(Ui={})),function(t){t[t.Scalar=0]="Scalar",t[t.Vec2=1]="Vec2",t[t.Vec3=2]="Vec3",t[t.Vec4=3]="Vec4",t[t.Quat=4]="Quat",t[t.Mat4=5]="Mat4"}(Wi||(Wi={}));var Qi=t("f",V("cc.CompactValueTypeArray")((Li=zi=function(){function t(){at(this,"_byteOffset",Oi,this),at(this,"_unitCount",Di,this),at(this,"_unitElement",Bi,this),at(this,"_length",Fi,this)}return t.lengthFor=function(t,e,i){return Ji(e).requiredUnits*t.length*Zi(i).BYTES_PER_ELEMENT},t.compress=function(e,i,n,r,a,s){for(var o=Ji(i),u=Zi(n),h=o.requiredUnits*e.length,l=new u(r,a,h),c=0;c<e.length;++c)o.compress(l,c,e[c]);var f=new t;return f._unitElement=$i(n,i),f._byteOffset=s,f._unitCount=h,f._length=e.length,f},t.prototype.decompress=function(t){for(var e,i={storageUnit:7&(e=this._unitElement),elementType:e>>3},n=i.storageUnit,r=Ji(i.elementType),a=new(Zi(n))(t,this._byteOffset,this._unitCount),s=new Array(this._length),o=0;o<this._length;++o)s[o]=r.decompress(a,o);return s},t}(),zi.StorageUnit=Ui,zi.ElementType=Wi,Oi=rt((Ri=Li).prototype,"_byteOffset",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Di=rt(Ri.prototype,"_unitCount",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bi=rt(Ri.prototype,"_unitElement",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $i(Ui.Uint8,Wi.Scalar)}}),Fi=rt(Ri.prototype,"_length",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mi=Ri))||Mi);function Ji(t){return dn[t]}function Zi(t){switch(t){case Ui.Uint8:return Uint8Array;case Ui.Uint16:return Uint16Array;case Ui.Uint32:return Uint32Array;case Ui.Int8:return Int8Array;case Ui.Int16:return Int16Array;case Ui.Int32:return Int32Array;case Ui.Float32:return Float32Array;case Ui.Float64:return Float64Array}}var tn,en,nn,rn,an,sn,on,un,hn,ln,cn,fn,pn,mn,dn=((Vi={})[Wi.Scalar]={requiredUnits:1,compress:function(t,e,i){t[e]=i},decompress:function(t,e){return t[e]}},Vi[Wi.Vec2]={requiredUnits:2,compress:function(t,e,i){t[2*e]=i.x,t[2*e+1]=i.y},decompress:function(t,e){return new r(t[2*e],t[2*e+1])}},Vi[Wi.Vec3]={requiredUnits:3,compress:function(t,e,i){t[3*e]=i.x,t[3*e+1]=i.y,t[3*e+2]=i.z},decompress:function(t,e){return new r(t[3*e],t[3*e+1],t[3*e+2])}},Vi[Wi.Vec4]={requiredUnits:4,compress:function(t,e,i){t[4*e]=i.x,t[4*e+1]=i.y,t[4*e+2]=i.z,t[4*e+3]=i.w},decompress:function(t,e){return new s(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},Vi[Wi.Quat]={requiredUnits:4,compress:function(t,e,i){t[4*e]=i.x,t[4*e+1]=i.y,t[4*e+2]=i.z,t[4*e+3]=i.w},decompress:function(t,e){return new u(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},Vi[Wi.Mat4]={requiredUnits:16,compress:function(t,e,i){c.toArray(t,i,16*e)},decompress:function(t,e){return c.fromArray(new c,t,16*e)}},Vi);tt._decorator=Pi;var _n,gn,vn,yn,bn,wn,Sn,Tn,An,kn,xn,En,Cn,In,Nn,Pn,Mn,Rn,On,Dn,Bn,Fn,zn,Ln,Vn,Un,Wn,jn,Hn,qn,Gn,Yn,Kn,Xn,$n,Qn,Jn,Zn,tr,er,ir,nr,rr,ar,sr,or,ur,hr,lr,cr,fr,pr,mr,dr,_r,gr,vr,yr,br,wr,Sr,Tr,Ar,kr,xr,Er,Cr,Ir,Nr,Pr,Mr,Rr,Or,Dr,Br,Fr,zr,Lr,Vr,Ur,Wr,jr,Hr,qr,Gr,Yr,Kr,Xr,$r,Qr,Jr,Zr,ta,ea,ia,na,ra,aa,sa,oa,ua,ha,la,ca,fa,pa=t("S",(tn=V("cc.SkinnedMeshRenderer"),en=Y(),nn=fe(100),rn=j(),an=K(Si),sn=K(me),on=K(Si),un=K(me),hn=lt(),tn(ln=en(ln=nn(ln=W(ln=rn((mn=function(t){function e(){var e;return e=t.call(this)||this,at(e,"_skeleton",fn,ht(e)),at(e,"_skinningRoot",pn,ht(e)),e._clip=null,e._modelType=de,e}ot(e,t),ut(e,[{key:"skeleton",get:function(){return this._skeleton},set:function(t){t!==this._skeleton&&(this._skeleton=t,this._update())}},{key:"skinningRoot",get:function(){return this._skinningRoot},set:function(t){t!==this._skinningRoot&&(this._skinningRoot=t,this._updateModelType(),this._update())}},{key:"model",get:function(){return this._model}}]);var i=e.prototype;return i.__preload=function(){this._updateModelType()},i.uploadAnimation=function(t){this._clip=t,this.model&&this.model.uploadAnimation&&this.model.uploadAnimation(t)},i.setUseBakedAnimation=function(t){void 0===t&&(t=!0);var e=t?de:_e;this._modelType!==e&&(this._modelType=e,this._model&&(tt.director.root.destroyModel(this._model),this._model=null,this._models.length=0,this._updateModels(),this._updateCastShadow(),this.enabledInHierarchy&&this._attachToScene()))},i.setMaterial=function(e,i){t.prototype.setMaterial.call(this,e,i),this._modelType===_e&&this.getMaterialInstance(i)},i._updateModelParams=function(){this._update(),t.prototype._updateModelParams.call(this)},i._updateModelType=function(){if(this._skinningRoot){var t=this._skinningRoot.getComponent("cc.SkeletalAnimation");t&&this.setUseBakedAnimation(t.useBakedAnimation)}},i._update=function(){this.model&&(this.model.bindSkeleton(this._skeleton,this._skinningRoot,this._mesh),this.model.uploadAnimation&&this.model.uploadAnimation(this._clip))},e}(ge),fn=rt((cn=mn).prototype,"_skeleton",[an],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pn=rt(cn.prototype,"_skinningRoot",[sn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt(cn.prototype,"skeleton",[on],Object.getOwnPropertyDescriptor(cn.prototype,"skeleton"),cn.prototype),rt(cn.prototype,"skinningRoot",[un,hn],Object.getOwnPropertyDescriptor(cn.prototype,"skinningRoot"),cn.prototype),ln=cn))||ln)||ln)||ln)||ln)||ln)),ma=new ve(ye.ATTR_BATCH_ID,be.R32F),da=new ve(ye.ATTR_BATCH_UV,be.RG32F),_a=we[ma.format].size+we[da.format].size,ga=t("j",(_n=V("cc.SkinnedMeshUnit"),gn=K(Se),vn=K(Si),yn=K(Te),bn=K(pa),_n((In=function(){function t(){at(this,"mesh",Tn,this),at(this,"skeleton",An,this),at(this,"material",kn,this),at(this,"_localTransform",xn,this),at(this,"_offset",En,this),at(this,"_size",Cn,this)}return ut(t,[{key:"offset",set:function(t){i.copy(this._offset,t)},get:function(){return this._offset}},{key:"size",set:function(t){i.copy(this._size,t)},get:function(){return this._size}},{key:"copyFrom",set:function(t){t&&(this.mesh=t.mesh,this.skeleton=t.skeleton,this.material=t.getMaterial(0),t.skinningRoot&&Ce(t.node,t.skinningRoot,this._localTransform))},get:function(){return null}}]),t}(),Tn=rt((Sn=In).prototype,"mesh",[gn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),An=rt(Sn.prototype,"skeleton",[vn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kn=rt(Sn.prototype,"material",[yn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xn=rt(Sn.prototype,"_localTransform",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new c}}),En=rt(Sn.prototype,"_offset",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new i(0,0)}}),Cn=rt(Sn.prototype,"_size",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new i(1,1)}}),rt(Sn.prototype,"offset",[ct],Object.getOwnPropertyDescriptor(Sn.prototype,"offset"),Sn.prototype),rt(Sn.prototype,"size",[ct],Object.getOwnPropertyDescriptor(Sn.prototype,"size"),Sn.prototype),rt(Sn.prototype,"copyFrom",[bn],Object.getOwnPropertyDescriptor(Sn.prototype,"copyFrom"),Sn.prototype),wn=Sn))||wn)),va=new c,ya=(new c,new r),ba=t("h",(Nn=V("cc.SkinnedMeshBatchRenderer"),Pn=Y(),Mn=fe(100),Rn=j(),On=lt(),Dn=K([ft]),Bn=lt(),Fn=K([ga]),zn=lt(),Ln=mt(),Vn=mt(),Nn(Un=Pn(Un=Mn(Un=W(Un=Rn((Gn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,at(e,"atlasSize",jn,ht(e)),at(e,"batchableTextureNames",Hn,ht(e)),at(e,"units",qn,ht(e)),e._textures={},e._batchMaterial=null,e}ot(e,t);var i=e.prototype;return i.onLoad=function(){t.prototype.onLoad.call(this),this.cook()},i.onDestroy=function(){for(var e in this._textures)this._textures[e].destroy();this._textures={},this._mesh&&(this._mesh.destroy(),this._mesh=null),t.prototype.onDestroy.call(this)},i._onMaterialModified=function(e){this.cookMaterials(),t.prototype._onMaterialModified.call(this,e,this.getMaterialInstance(e))},i.cook=function(){this.cookMaterials(),this.cookSkeletons(),this.cookMeshes()},i.cookMaterials=function(){var t=this;this._batchMaterial||(this._batchMaterial=this.getMaterial(0));var e=this.getMaterialInstance(0);if(e&&this._batchMaterial&&this._batchMaterial.effectAsset){e.copy(this._batchMaterial),this.resizeAtlases();for(var i=e.effectAsset.techniques[e.technique],n=function(n){var r=i.passes[n];if(!r.properties)return"continue";var a=function(i){if(r.properties[i].type>=Ie.SAMPLER1D){var a=null;t.batchableTextureNames.find((function(t){return t===i}))?((a=t._textures[i])||(a=t.createTexture(i)),t.cookTextures(a,i,n)):t.units.some((function(t){return a=t.material&&t.material.getProperty(i,n)})),a&&e.setProperty(i,a,n)}else{for(var s=[],o=0;o<t.units.length;o++){var u=t.units[o];u.material&&s.push(u.material.getProperty(i.slice(0,-3),n))}e.setProperty(i,s,n)}};for(var s in r.properties)a(s)},r=0;r<i.passes.length;r++)n(r)}else console.warn("incomplete batch material!")},i.cookSkeletons=function(){if(this._skinningRoot){for(var t=[],e=[],i=0;i<this.units.length;i++){var n=this.units[i];if(n&&n.skeleton){var r=n.skeleton;c.invert(va,n._localTransform);for(var a=function(i){var n=r.joints[i];if(t.findIndex((function(t){return t===n}))>=0)return"continue";t.push(n),e.push(c.multiply(new c,r.bindposes[i]||c.IDENTITY,va))},s=0;s<r.joints.length;s++)a(s)}}var o=Array.from(Array(t.length).keys()).sort((function(e,i){return t[e]>t[i]?1:t[e]<t[i]?-1:0})),u=new Si;u.joints=t.map((function(t,e,i){return i[o[e]]})),u.bindposes=e.map((function(t,e,i){return i[o[e]]})),this._skeleton&&this._skeleton.destroy(),this.skeleton=u}else console.warn("no skinning root specified!")},i.cookMeshes=function(){for(var t=this,e=!1,i=0;i<this.units.length;i++)if(this.units[i].mesh){e=!0;break}if(e&&this._skinningRoot){this._mesh?this._mesh.destroyRenderingMesh():this._mesh=new Se;for(var n=0,a=be.UNKNOWN,s=0,o=be.UNKNOWN,u=0,h=be.UNKNOWN,l=0,f=be.UNKNOWN,p=0,m=be.UNKNOWN,d=new Array(this.units.length),_=this.units.length,g=0;g<_;g++){var v=this.units[g];v&&v.skeleton&&(d[g]=v.skeleton.joints.map((function(e){return t._skeleton.joints.findIndex((function(t){return e===t}))})))}for(var y=function(e){var i=t.units[e];if(!i||!i.mesh||!i.mesh.data)return"continue";var _=t._createUnitMesh(e,i.mesh),g=new DataView(_.data.buffer);c.inverseTranspose(va,i._localTransform);for(var v=i.offset,y=i.size,b=function(t){var c=_.struct.vertexBundles[t];n=c.view.offset,a=be.UNKNOWN;for(var b=0;b<c.attributes.length;b++){var w=c.attributes[b];if(w.name===ye.ATTR_POSITION){a=w.format;break}n+=we[w.format].size}if(a){for(var S=ue(g,a,n,c.view.length,c.view.stride),T=0;T<S.length;T+=3)r.fromArray(ya,S,T),r.transformMat4(ya,ya,i._localTransform),r.toArray(S,ya,T);he(g,S,a,n,c.view.stride)}s=c.view.offset,o=be.UNKNOWN;for(var A=0;A<c.attributes.length;A++){var k=c.attributes[A];if(k.name===ye.ATTR_NORMAL){o=k.format;break}s+=we[k.format].size}if(o){for(var x=ue(g,o,s,c.view.length,c.view.stride),E=0;E<x.length;E+=3)r.fromArray(ya,x,E),r.transformMat4Normal(ya,ya,va),r.toArray(x,ya,E);he(g,x,o,s,c.view.stride)}u=c.view.offset,h=be.UNKNOWN;for(var C=0;C<c.attributes.length;C++){var I=c.attributes[C];if(I.name===ye.ATTR_TANGENT){h=I.format;break}u+=we[I.format].size}if(h){for(var N=ue(g,h,u,c.view.length,c.view.stride),P=0;P<N.length;P+=3)r.fromArray(ya,N,P),r.transformMat4Normal(ya,ya,va),r.toArray(N,ya,P);he(g,N,h,u,c.view.stride)}l=c.view.offset,f=be.UNKNOWN;for(var M=0;M<c.attributes.length;M++){var R=c.attributes[M];if(R.name===ye.ATTR_BATCH_UV){f=R.format;break}l+=we[R.format].size}f&&le(g,(function(t,e){var i,n=0===e?"x":"y";return(t=(i=t)-Math.floor(i))*y[n]+v[n]}),f,l,c.view.length,c.view.stride,g);var O=d[e];if(!O)return"continue";p=c.view.offset,m=be.UNKNOWN;for(var D=0;D<c.attributes.length;D++){var B=c.attributes[D];if(B.name===ye.ATTR_JOINTS){m=B.format;break}p+=we[B.format].size}m&&le(g,(function(t){return O[t]}),m,p,c.view.length,c.view.stride,g)},w=0;w<_.struct.vertexBundles.length;w++)b(w);t._mesh.merge(_)},b=0;b<_;b++)y(b);this._onMeshChanged(this._mesh),this._updateModels()}},i.cookTextures=function(t,e,i){for(var n=[],r=[],a=[],s=[],o=0;o<this.units.length;o++){var u=this.units[o];if(u.material){var h=u.material.getProperty(e,i);if(h&&h.image&&h.image.data){var l=new Ae;l.texOffset.x=u.offset.x*this.atlasSize,l.texOffset.y=u.offset.y*this.atlasSize,l.texExtent.width=u.size.x*this.atlasSize,l.texExtent.height=u.size.y*this.atlasSize;var c=h.image.data;ArrayBuffer.isView(c)?(a.push(c),s.push(l)):(n.push(c),r.push(l))}}}var f=t.getGFXTexture(),p=tt.director.root.device;a.length>0&&p.copyBuffersToTexture(a,f,s),n.length>0&&p.copyTexImagesToTexture(n,f,r)},i.createTexture=function(t){var e=new ke;return e.setFilters(xe.LINEAR,xe.LINEAR),e.setMipFilter(xe.NEAREST),e.reset({width:this.atlasSize,height:this.atlasSize,format:Ee.RGBA8888}),e.loaded=!0,this._textures[t]=e,e},i.resizeAtlases=function(){for(var t in this._textures)this._textures[t].reset({width:this.atlasSize,height:this.atlasSize,format:Ee.RGBA8888})},i._createUnitMesh=function(t,e){for(var i=JSON.parse(JSON.stringify(e.struct)),n={},r=0;r<e.struct.primitives.length;r++){for(var a=e.struct.primitives[r],s=0,o=be.UNKNOWN,u=0;u<a.vertexBundelIndices.length;u++){var h=e.struct.vertexBundles[a.vertexBundelIndices[u]];s=h.view.offset,o=be.UNKNOWN;for(var l=0;l<h.attributes.length;l++){var c=h.attributes[l];if(c.name===ye.ATTR_TEX_COORD){o=c.format;break}s+=we[c.format].size}if(o)break}if(void 0===n[u]){n[u]=[o,s];var f=i.vertexBundles[u];f.attributes.push(ma),f.attributes.push(da),f.view.offset=0,f.view.length+=f.view.count*_a,f.view.stride+=_a}}for(var p=0,m=0;m<i.vertexBundles.length;m++)p+=i.vertexBundles[m].view.length;for(var d=0;d<i.primitives.length;d++){var _=i.primitives[d];_.indexView&&(_.indexView.offset=p,p+=_.indexView.length)}var g=new Uint8Array(p),v=e.data,y=new DataView(g.buffer),b=new DataView(v.buffer),w=tt.sys.isLittleEndian;for(var S in n)for(var T=i.vertexBundles[S],A=e.struct.vertexBundles[S],k=n[S],x=k[0],E=k[1],C=ue(b,x,E,A.view.length,A.view.stride),I=A.view,N=T.view,P=I.stride,M=N.stride,R=I.offset,O=N.offset,D=0;D<N.count;D++){var B=v.subarray(R,R+P);g.set(B,O),y.setFloat32(O+P,t),y.setFloat32(O+P+4,C[2*D],w),y.setFloat32(O+P+8,C[2*D+1],w),O+=M,R+=P}for(var F=0;F<i.primitives.length;F++){var z=e.struct.primitives[F],L=i.primitives[F];if(z.indexView&&L.indexView)for(var V=z.indexView.stride,U=L.indexView.stride,W=z.indexView.offset,j=L.indexView.offset,H=0;H<L.indexView.count;H++){var q=v.subarray(W,W+V);g.set(q,j),j+=U,W+=V}}var G=new Se;return G.reset({struct:i,data:g}),G},ut(e,[{key:"mesh",get:function(){return t.prototype.mesh},set:function(t){this.mesh=t}},{key:"skeleton",get:function(){return t.prototype.skeleton},set:function(t){this.skeleton=t}}]),e}(pa),jn=rt((Wn=Gn).prototype,"atlasSize",[st,On],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1024}}),Hn=rt(Wn.prototype,"batchableTextureNames",[Dn,st,Bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qn=rt(Wn.prototype,"units",[Fn,st,zn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rt(Wn.prototype,"mesh",[pt,Ln],Object.getOwnPropertyDescriptor(Wn.prototype,"mesh"),Wn.prototype),rt(Wn.prototype,"skeleton",[pt,Vn],Object.getOwnPropertyDescriptor(Wn.prototype,"skeleton"),Wn.prototype),Un=Wn))||Un)||Un)||Un)||Un)||Un)),wa=dt({LUMINOUS_POWER:0,LUMINANCE:1}),Sa=new r,Ta=V("cc.StaticLightSettings")((Jn=function(){function t(){at(this,"_editorOnly",Xn,this),at(this,"_bakeable",$n,this),at(this,"_castShadow",Qn,this)}return ut(t,[{key:"editorOnly",get:function(){return this._editorOnly},set:function(t){this._editorOnly=t}},{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}}]),t}(),Xn=rt((Kn=Jn).prototype,"_editorOnly",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$n=rt(Kn.prototype,"_bakeable",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Qn=rt(Kn.prototype,"_castShadow",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rt(Kn.prototype,"editorOnly",[ct],Object.getOwnPropertyDescriptor(Kn.prototype,"editorOnly"),Kn.prototype),rt(Kn.prototype,"bakeable",[ct],Object.getOwnPropertyDescriptor(Kn.prototype,"bakeable"),Kn.prototype),rt(Kn.prototype,"castShadow",[ct],Object.getOwnPropertyDescriptor(Kn.prototype,"castShadow"),Kn.prototype),Yn=Kn))||Yn,Aa=t("L",(Zn=V("cc.Light"),tr=lt(),er=lt(),ir=vt(),nr=lt(),rr=K(Ta),Zn((fr=cr=function(t){function e(){var e;return e=t.call(this)||this,at(e,"_color",or,ht(e)),at(e,"_useColorTemperature",ur,ht(e)),at(e,"_colorTemperature",hr,ht(e)),at(e,"_staticSettings",lr,ht(e)),e._type=Ne.UNKNOWN,e._lightType=void 0,e._light=null,e._lightType=Pe,e}ot(e,t),ut(e,[{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._light&&(Sa.x=t.r/255,Sa.y=t.g/255,Sa.z=t.b/255,this._light.color=Sa)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(t){this._useColorTemperature=t,this._light&&(this._light.useColorTemperature=t)}},{key:"colorTemperature",get:function(){return this._colorTemperature},set:function(t){this._colorTemperature=t,this._light&&(this._light.colorTemperature=t)}},{key:"staticSettings",get:function(){return this._staticSettings},set:function(t){this._staticSettings=t}},{key:"type",get:function(){return this._type}}]);var i=e.prototype;return i.onLoad=function(){this._createLight()},i.onEnable=function(){this._attachToScene()},i.onDisable=function(){this._detachFromScene()},i.onDestroy=function(){this._destroyLight()},i._createLight=function(){this._light||(this._light=tt.director.root.createLight(this._lightType)),this.color=this._color,this.useColorTemperature=this._useColorTemperature,this.colorTemperature=this._colorTemperature,this._light.node=this.node},i._destroyLight=function(){this._light&&(tt.director.root.destroyLight(this),this._light=null)},i._attachToScene=function(){if(this._detachFromScene(),this._light&&!this._light.scene&&this.node.scene){var t=this._getRenderScene();switch(this._type){case Ne.DIRECTIONAL:t.addDirectionalLight(this._light),t.setMainLight(this._light);break;case Ne.SPHERE:t.addSphereLight(this._light);break;case Ne.SPOT:t.addSpotLight(this._light)}}},i._detachFromScene=function(){if(this._light&&this._light.scene){var t=this._light.scene;switch(this._type){case Ne.DIRECTIONAL:t.removeDirectionalLight(this._light),t.unsetMainLight(this._light);break;case Ne.SPHERE:t.removeSphereLight(this._light);break;case Ne.SPOT:t.removeSpotLight(this._light)}}},e}(_t),cr.Type=Ne,cr.PhotometricTerm=wa,or=rt((sr=fr).prototype,"_color",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return v.WHITE.clone()}}),ur=rt(sr.prototype,"_useColorTemperature",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),hr=rt(sr.prototype,"_colorTemperature",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6550}}),lr=rt(sr.prototype,"_staticSettings",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ta}}),rt(sr.prototype,"color",[tr],Object.getOwnPropertyDescriptor(sr.prototype,"color"),sr.prototype),rt(sr.prototype,"useColorTemperature",[er],Object.getOwnPropertyDescriptor(sr.prototype,"useColorTemperature"),sr.prototype),rt(sr.prototype,"colorTemperature",[gt,ir,nr],Object.getOwnPropertyDescriptor(sr.prototype,"colorTemperature"),sr.prototype),rt(sr.prototype,"staticSettings",[rr],Object.getOwnPropertyDescriptor(sr.prototype,"staticSettings"),sr.prototype),ar=sr))||ar)),ka=t("D",(pr=V("cc.DirectionalLight"),mr=Y(),dr=j(),_r=yt(),gr=lt(),pr(vr=mr(vr=dr(vr=W((wr=function(t){function e(){var e;return e=t.call(this)||this,at(e,"_illuminance",br,ht(e)),e._type=Ne.DIRECTIONAL,e._light=null,e._lightType=Me,e}return ot(e,t),ut(e,[{key:"illuminance",get:function(){return this._illuminance},set:function(t){this._illuminance=t,this._light&&(this._light.illuminance=this._illuminance)}}]),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.illuminance=this._illuminance)},e}(Aa),br=rt((yr=wr).prototype,"_illuminance",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 65e3}}),rt(yr.prototype,"illuminance",[_r,gr],Object.getOwnPropertyDescriptor(yr.prototype,"illuminance"),yr.prototype),vr=yr))||vr)||vr)||vr)||vr)),xa=t("k",(Sr=V("cc.SphereLight"),Tr=Y(),Ar=j(),kr=yt(),xr=lt(),Er=yt(),Cr=lt(),Ir=K(wa),Nr=lt(),Pr=lt(),Mr=lt(),Sr(Rr=Tr(Rr=Ar(Rr=W((Lr=function(t){function e(){var e;return e=t.call(this)||this,at(e,"_size",Dr,ht(e)),at(e,"_luminance",Br,ht(e)),at(e,"_term",Fr,ht(e)),at(e,"_range",zr,ht(e)),e._type=Ne.SPHERE,e._light=null,e._lightType=Re,e}return ot(e,t),ut(e,[{key:"luminousPower",get:function(){return this._luminance*Oe(this._size)},set:function(t){this._luminance=t/Oe(this._size),this._light&&(this._light.luminance=this._luminance)}},{key:"luminance",get:function(){return this._luminance},set:function(t){this._luminance=t,this._light&&(this._light.luminance=t)}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}}]),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.luminance=this._luminance,this.size=this._size,this.range=this._range)},e}(Aa),Dr=rt((Or=Lr).prototype,"_size",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),Br=rt(Or.prototype,"_luminance",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1700/Oe(.15)}}),Fr=rt(Or.prototype,"_term",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wa.LUMINOUS_POWER}}),zr=rt(Or.prototype,"_range",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),rt(Or.prototype,"luminousPower",[kr,xr],Object.getOwnPropertyDescriptor(Or.prototype,"luminousPower"),Or.prototype),rt(Or.prototype,"luminance",[Er,Cr],Object.getOwnPropertyDescriptor(Or.prototype,"luminance"),Or.prototype),rt(Or.prototype,"term",[Ir,Nr],Object.getOwnPropertyDescriptor(Or.prototype,"term"),Or.prototype),rt(Or.prototype,"size",[Pr],Object.getOwnPropertyDescriptor(Or.prototype,"size"),Or.prototype),rt(Or.prototype,"range",[Mr],Object.getOwnPropertyDescriptor(Or.prototype,"range"),Or.prototype),Rr=Or))||Rr)||Rr)||Rr)||Rr)),Ea=t("l",(Vr=V("cc.SpotLight"),Ur=Y(),Wr=j(),jr=yt(),Hr=lt(),qr=yt(),Gr=lt(),Yr=K(wa),Kr=lt(),Xr=lt(),$r=lt(),Qr=vt(),Jr=lt(),Vr(Zr=Ur(Zr=Wr(Zr=W((sa=function(t){function e(){var e;return e=t.call(this)||this,at(e,"_size",ea,ht(e)),at(e,"_luminance",ia,ht(e)),at(e,"_term",na,ht(e)),at(e,"_range",ra,ht(e)),at(e,"_spotAngle",aa,ht(e)),e._type=Ne.SPOT,e._light=null,e._lightType=De,e}return ot(e,t),ut(e,[{key:"luminousPower",get:function(){return this._luminance*Oe(this._size)},set:function(t){this._luminance=t/Oe(this._size),this._light&&(this._light.luminance=this._luminance)}},{key:"luminance",get:function(){return this._luminance},set:function(t){this._luminance=t,this._light&&(this._light.luminance=t)}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._spotAngle=t,this._light&&(this._light.spotAngle=x(t))}}]),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.luminance=this._luminance,this.size=this._size,this.range=this._range,this.spotAngle=this._spotAngle)},e}(Aa),ea=rt((ta=sa).prototype,"_size",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),ia=rt(ta.prototype,"_luminance",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1700/Oe(.15)}}),na=rt(ta.prototype,"_term",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wa.LUMINOUS_POWER}}),ra=rt(ta.prototype,"_range",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),aa=rt(ta.prototype,"_spotAngle",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),rt(ta.prototype,"luminousPower",[jr,Hr],Object.getOwnPropertyDescriptor(ta.prototype,"luminousPower"),ta.prototype),rt(ta.prototype,"luminance",[qr,Gr],Object.getOwnPropertyDescriptor(ta.prototype,"luminance"),ta.prototype),rt(ta.prototype,"term",[Yr,Kr],Object.getOwnPropertyDescriptor(ta.prototype,"term"),ta.prototype),rt(ta.prototype,"size",[Xr],Object.getOwnPropertyDescriptor(ta.prototype,"size"),ta.prototype),rt(ta.prototype,"range",[$r],Object.getOwnPropertyDescriptor(ta.prototype,"range"),ta.prototype),rt(ta.prototype,"spotAngle",[gt,Qr,Jr],Object.getOwnPropertyDescriptor(ta.prototype,"spotAngle"),ta.prototype),Zr=ta))||Zr)||Zr)||Zr)||Zr));bt(ge.prototype,"MeshRenderer.prototype",[{name:"enableDynamicBatching"},{name:"recieveShadows"}]),wt(Ti,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),wt(Ti.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),tt.CameraComponent=Ti,it.setClassAlias(Ti,"cc.CameraComponent"),tt.LightComponent=Aa,it.setClassAlias(Aa,"cc.LightComponent"),tt.DirectionalLightComponent=ka,it.setClassAlias(ka,"cc.DirectionalLightComponent"),tt.SphereLightComponent=xa,it.setClassAlias(xa,"cc.SphereLightComponent"),tt.SpotLightComponent=Ea,it.setClassAlias(Ea,"cc.SpotLightComponent"),tt.ModelComponent=ge,it.setClassAlias(ge,"cc.ModelComponent"),tt.SkinningModelComponent=pa,it.setClassAlias(pa,"cc.SkinningModelComponent"),tt.SkinningModelUnit=ga,it.setClassAlias(ga,"cc.SkinningModelUnit"),tt.BatchedSkinningModelComponent=ba,it.setClassAlias(ba,"cc.BatchedSkinningModelComponent"),tt.utils=Ni;var Ca,Ia,Na,Pa,Ma,Ra,Oa,Da,Ba,Fa,za,La=t("U",V("cc.animation.UniformProxyFactory")((fa=function(){function t(t,e){at(this,"passIndex",ha,this),at(this,"uniformName",la,this),at(this,"channelIndex",ca,this),this.passIndex=e||0,this.uniformName=t||""}return t.prototype.forTarget=function(t){var e=t.passes[this.passIndex],i=e.getHandle(this.uniformName);if(!i)throw new Error('Material "'+t.name+'" has no uniform "'+this.uniformName+'"');var n=Be.getPropertyTypeFromHandle(i);if(n===Fe.UBO){var r=void 0===this.channelIndex?i:e.getHandle(this.uniformName,this.channelIndex,Ie.FLOAT);if(!r)throw new Error('Uniform "'+this.uniformName+" (in material "+t.name+") has no channel "+this.channelIndex+'"');return function(t,e){for(var i,n=Tt(t.shaderInfo.blocks);!(i=n()).done;)for(var r,a=i.value,s=Tt(a.members);!(r=s()).done;){var o=r.value;if(o.name===e)return o.count>1}return!1}(e,this.uniformName)?{set:function(t){e.setUniformArray(r,t)}}:{set:function(t){e.setUniform(r,t)}}}if(n===Fe.SAMPLER){var a=Be.getBindingFromHandle(i),s=e.properties[this.uniformName],o=s&&s.value?s.value+"-texture":ze(s.type),u=Le.get(o);return u||(St("Illegal texture default value: "+o+"."),u=Le.get("default-texture")),{set:function(t){t||(t=u);var i=t.getGFXTexture();i&&i.width&&i.height&&(e.bindTexture(a,i),t instanceof Ve&&e.bindSampler(a,Ue.getSampler(tt.game._gfxDevice,t.getSamplerHash())))}}}throw new Error("Animations are not available for uniforms with property type "+n+".")},t}(),ha=rt((ua=fa).prototype,"passIndex",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),la=rt(ua.prototype,"uniformName",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ca=rt(ua.prototype,"channelIndex",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),oa=ua))||oa);function Va(t,e,i,n){var r,a,s,o,h,l,c=new e,f=new e,p=new e,m=V(t)((l=function(){function t(t,i,n){at(this,"dataPoint",s,this),at(this,"inTangent",o,this),at(this,"outTangent",h,this),this.dataPoint=t||new e,this.inTangent=i||new e,this.outTangent=n||new e}var r=t.prototype;return r.lerp=function(t,e,r){var a=this.dataPoint,s=t.dataPoint;f=i(f,this.inTangent,r),p=i(p,t.outTangent,r);var o=e*e*e,u=e*e,h=o-2*u+e,l=-2*o+3*u,m=o-u;return c=i(c,a,2*o-3*u+1),c=n(c,c,f,h),c=n(c,c,s,l),c=n(c,c,p,m)},r.getNoLerp=function(){return this.dataPoint},t}(),s=rt((a=l).prototype,"dataPoint",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),o=rt(a.prototype,"inTangent",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),h=rt(a.prototype,"outTangent",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),r=a))||r;if(e===u){var d=m.prototype.lerp;m.prototype.lerp=function(t,e,i){var n=d.call(this,t,e,i);return u.normalize(n,n),n}}return m}t("M",V("cc.animation.MorphWeightsValueProxy")((Pa=function(){function t(){at(this,"subMeshIndex",Na,this)}return t.prototype.forTarget=function(t){var e=this;return{set:function(i){t.setWeights(i,e.subMeshIndex)}}},t}(),Na=rt((Ia=Pa).prototype,"subMeshIndex",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ca=Ia))||Ca),t("a",V("cc.animation.MorphWeightsAllValueProxy")(Ma=function(){function t(){}return t.prototype.forTarget=function(t){return{set:function(e){for(var i,n,r=null!==(i=null===(n=t.mesh)||void 0===n?void 0:n.struct.primitives.length)&&void 0!==i?i:0,a=0;a<r;++a)t.setWeights(e,a)}}},t}())||Ma);var Ua=t("C",Va("cc.CubicSplineVec2Value",i,i.multiplyScalar,i.scaleAndAdd));tt.CubicSplineVec2Value=Ua;var Wa=t("b",Va("cc.CubicSplineVec3Value",r,r.multiplyScalar,r.scaleAndAdd));tt.CubicSplineVec3Value=Wa;var ja=t("c",Va("cc.CubicSplineVec4Value",s,s.multiplyScalar,s.scaleAndAdd));tt.CubicSplineVec4Value=ja;var Ha=t("d",Va("cc.CubicSplineQuatValue",u,u.multiplyScalar,u.scaleAndAdd));tt.CubicSplineQuatValue=Ha;var qa=t("e",V("cc.CubicSplineNumberValue")((za=function(){function t(t,e,i){at(this,"dataPoint",Da,this),at(this,"inTangent",Ba,this),at(this,"outTangent",Fa,this),this.dataPoint=t,this.inTangent=e,this.outTangent=i}var e=t.prototype;return e.lerp=function(t,e,i){var n=this.dataPoint,r=t.dataPoint,a=e*e*e,s=e*e;return n*(2*a-3*s+1)+this.outTangent*i*(a-2*s+e)+r*(-2*a+3*s)+t.inTangent*i*(a-s)},e.getNoLerp=function(){return this.dataPoint},t}(),Da=rt((Oa=za).prototype,"dataPoint",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ba=rt(Oa.prototype,"inTangent",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fa=rt(Oa.prototype,"outTangent",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ra=Oa))||Ra);function Ga(t){return t*t}function Ya(t){return t*(2-t)}function Ka(t){return t*t*t}function Xa(t){return--t*t*t+1}function $a(t){return t*t*t*t}function Qa(t){return 1- --t*t*t*t}function Ja(t){return t*t*t*t*t}function Za(t){return--t*t*t*t*t+1}function ts(t){return 1-Math.cos(t*Math.PI/2)}function es(t){return Math.sin(t*Math.PI/2)}function is(t){return 0===t?0:Math.pow(1024,t-1)}function ns(t){return 1===t?1:1-Math.pow(2,-10*t)}function rs(t){return 1-Math.sqrt(1-t*t)}function as(t){return Math.sqrt(1- --t*t)}function ss(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4))}function os(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/.4)+1)}function us(t){var e=1.70158;return t*t*((e+1)*t-e)}function hs(t){var e=1.70158;return--t*t*((e+1)*t+e)+1}function ls(t){return 1-cs(1-t)}function cs(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}tt.CubicSplineNumberValue=qa;var fs=Ss(Ga,Ya),ps=Ss(Ka,Xa),ms=Ss($a,Qa),ds=Ss(Ja,Za),_s=Ss(ts,es),gs=Ss(is,ns),vs=Ss(rs,as),ys=Ss(ss,os),bs=Ss(us,hs),ws=Ss(ls,cs);function Ss(t,e){return function(i){return i<.5?e(2*i)/2:t(2*i-1)/2+.5}}var Ts=Object.freeze({__proto__:null,constant:function(){return 0},linear:function(t){return t},quadIn:Ga,quadOut:Ya,quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:Ka,cubicOut:Xa,cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:$a,quartOut:Qa,quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:Ja,quintOut:Za,quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:ts,sineOut:es,sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:is,expoOut:ns,expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circIn:rs,circOut:as,circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:ss,elasticOut:os,elasticInOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*.5+1)},backIn:us,backOut:hs,backInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)},bounceIn:ls,bounceOut:cs,bounceInOut:function(t){return t<.5?.5*ls(2*t):.5*cs(2*t-1)+.5},smooth:function(t){return t<=0?0:t>=1?1:t*t*(3-2*t)},fade:function(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)},quadOutIn:fs,cubicOutIn:ps,quartOutIn:ms,quintOutIn:ds,sineOutIn:_s,expoOutIn:gs,circOutIn:vs,elasticOutIn:ys,backOutIn:bs,bounceOutIn:ws});function As(t,e){for(var i=0,n=t.length-1,r=n>>>1;i<=n;r=i+n>>>1){var a=t[r];if(a>e+1e-6)n=r-1;else{if(!(a<e-1e-6))return r;i=r+1}}return~i}function ks(t,e,i,n,r){var a=1-r;return a*(a*(t+(3*e-t)*r)+3*i*r*r)+n*r*r*r}t("n",Ts),tt.bezier=ks;var xs=Math.cos,Es=Math.acos,Cs=Math.max,Is=2*Math.PI,Ns=Math.sqrt;function Ps(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function Ms(t,e){var i=function(t,e){var i,n,r,a,s=e-0,o=e-t[0],u=3*s,h=3*o,l=3*(e-t[2]),c=1/(-s+h-l+(e-1)),f=(u-6*o+l)*c,p=f*(1/3),m=(-u+h)*c,d=1/3*(3*m-f*f),_=d*(1/3),g=(2*f*f*f-9*f*m+s*c*27)/27,v=g/2,y=v*v+_*_*_;if(y<0){var b=1/3*-d,w=Ns(b*b*b),S=-g/(2*w),T=Es(S<-1?-1:S>1?1:S),A=2*Ps(w);return n=A*xs(T*(1/3))-p,r=A*xs((T+Is)*(1/3))-p,a=A*xs((T+2*Is)*(1/3))-p,0<=n&&n<=1?0<=r&&r<=1?0<=a&&a<=1?Cs(n,r,a):Cs(n,r):0<=a&&a<=1?Cs(n,a):n:0<=r&&r<=1?0<=a&&a<=1?Cs(r,a):r:a}if(0===y)return r=-(i=v<0?Ps(-v):-Ps(v))-p,0<=(n=2*i-p)&&n<=1?0<=r&&r<=1?Cs(n,r):n:r;var k=Ns(y);return(i=Ps(-v+k))-Ps(v+k)-p}(t,e),n=t[1];return((1-i)*(n+(t[3]-n)*i)*3+i*i)*i}tt.bezierByTime=Ms;var Rs=t("R",function(){function t(t){var e,i;this.ratios=void 0,this._findRatio=void 0,this.ratios=t;for(var n=!0,r=1,a=t.length;r<a;r++)if(e=t[r]-t[r-1],1===r)i=e;else if(Math.abs(e-i)>1e-6){n=!1;break}this._findRatio=n?Fs:As}return t.prototype.sample=function(t){return this._findRatio(this.ratios,t)},t}());tt.RatioSampler=Rs;var Os=t("z",function(){function t(e,i){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=i,this._values=e.values;var n=function(e){return"string"==typeof e?e:Array.isArray(e)?e[0]===e[1]&&e[2]===e[3]?t.Linear:t.Bezier(e):t.Linear};if(void 0!==e.easingMethod)this.type=n(e.easingMethod);else if(Array.isArray(e.easingMethods))this.types=e.easingMethods.map(n);else if(void 0!==e.easingMethods){this.types=new Array(this._values.length).fill(null);for(var r=0,a=Object.keys(e.easingMethods);r<a.length;r++){var s=a[r];this.types[s]=n(e.easingMethods[s])}}else this.type=null;var o=e.values[0];(void 0===e.interpolate||e.interpolate)&&(this._lerp=Js(o)),void 0!==e._arrayLength&&(this._array=new Array(e._arrayLength))}t.Bezier=function(t){return t};var e=t.prototype;return e.hasLerp=function(){return!!this._lerp},e.valueAt=function(t){if(void 0===this._array){var e=this._values[t];return e&&e.getNoLerp?e.getNoLerp():e}for(var i=0;i<this._array.length;++i)this._array[i]=this._values[this._array.length*t+i];return this._array},e.valueBetween=function(t,e,i,n,r){if(this._lerp){var a=this.types?this.types[e]:this.type,s=r-i,o=(t-i)/s;if(a&&(o=Bs(o,a)),void 0===this._array){var u=this._values[e],h=this._values[n];return this._lerp(u,h,o,s*this._duration)}for(var l=0;l<this._array.length;++l){var c=this._values[this._array.length*e+l],f=this._values[this._array.length*n+l];this._array[l]=this._lerp(c,f,o,s*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(e);for(var p=0;p<this._array.length;++p)this._array[p]=this._values[this._array.length*e+p];return this._array},e.empty=function(){return 0===this._values.length},e.constant=function(){return 1===this._values.length},t}());function Ds(t,e,i){var n=e.sample(i);if(n<0)if((n=~n)<=0)n=0;else{if(!(n>=e.ratios.length))return t.valueBetween(i,n-1,e.ratios[n-1],n,e.ratios[n]);n=e.ratios.length-1}return t.valueAt(n)}function Bs(t,e){if("string"==typeof e){var i=Ts[e];i?t=i(t):At(3906,e)}else Array.isArray(e)&&(t=Ms(e,t));return t}function Fs(t,e){var i=t.length-1;if(0===i)return 0;var n=t[0];if(e<n)return 0;var r=t[i];if(e>r)return i;var a=(e=(e-n)/(r-n))/(1/i),s=0|a;return a-s<1e-6?s:s+1-a<1e-6?s+1:~(s+1)}Os.Linear=null,tt.AnimCurve=Os,t("E",function(){function t(){this.events=[]}return t.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})},t}()),tt.sampleAnimationCurve=Ds;var zs,Ls,Vs,Us,Ws,js,Hs,qs,Gs,Ys,Ks,Xs,$s,Qs,Js=function(){function t(t,e,i,n){return t.lerp(e,i,n)}return function(e){if(null!==e){if("number"==typeof e)return k;if("object"==typeof e&&e.constructor){if(e instanceof u)return i=new u,function(t,e,n){return u.slerp(i,t,e,n)};if(e instanceof nt)return function(t){var e=new t;return function(i,n,r){return t.lerp(e,i,n,r),e}}(e.constructor);if(e.constructor===Number)return k;if(We(e))return t}var i}}}(),Zs=t("G",V("cc.AnimationClip")((Qs=$s=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,at(e,"sample",Vs,ht(e)),at(e,"speed",Us,ht(e)),at(e,"wrapMode",Ws,ht(e)),at(e,"events",js,ht(e)),at(e,"_duration",Hs,ht(e)),at(e,"_keys",qs,ht(e)),at(e,"_stepness",Gs,ht(e)),at(e,"_curves",Ys,ht(e)),at(e,"_commonTargets",Ks,ht(e)),at(e,"_hash",Xs,ht(e)),e.frameRate=0,e._ratioSamplers=[],e._runtimeCurves=void 0,e._runtimeEvents=void 0,e._data=null,e}ot(e,t),e.createWithSpriteFrames=function(t,i){if(!Array.isArray(t))return At(3905),null;var n=new e;n.sample=i||n.sample,n.duration=t.length/n.sample;for(var r=1/n.sample,a=new Array(t.length),s=new Array(a.length),o=0;o<t.length;o++)a[o]=o*r,s[o]=t[o];return n.keys=[a],n.curves=[{modifiers:[new qe("cc.Sprite"),"spriteFrame"],data:{keys:0,values:s}}],n};var i=e.prototype;return i.onLoaded=function(){this.frameRate=this.sample,this._decodeCVTAs()},i.getPropertyCurves=function(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves},i.updateEventDatas=function(){delete this._runtimeEvents},i.getEventGroupIndexAtRatio=function(t){return this._runtimeEvents||this._createRuntimeEvents(),function(t,e){for(var i=0,n=t.length-1,r=n>>>1;i<=n;r=i+n>>>1){var a=t[r];if(a>e+1e-6)n=r-1;else{if(!(a<e-1e-6))return r;i=r+1}}return~i}(this._runtimeEvents.ratios,t)},i.hasEvents=function(){return 0!==this.events.length},i.destroy=function(){return tt.director.root.dataPoolManager.releaseAnimationClip(this),je.destroy(this),t.prototype.destroy.call(this)},i._createPropertyCurves=function(){var t=this;this._ratioSamplers=this._keys.map((function(e){return new Rs(e.map((function(e){return e/t._duration})))})),this._runtimeCurves=this._curves.map((function(e){return{curve:new Os(e.data,t._duration),modifiers:e.modifiers,valueAdapter:e.valueAdapter,sampler:t._ratioSamplers[e.data.keys],commonTarget:e.commonTarget}})),this._applyStepness()},i._createRuntimeEvents=function(){for(var t,e=this,i=[],n=[],r=this.events.sort((function(t,e){return t.frame-e.frame})),a=function(){var r=t.value,a=r.frame/e._duration,s=i.findIndex((function(t){return t===a}));s<0&&(s=i.length,i.push(a),n.push({events:[]})),n[s].events.push({functionName:r.func,parameters:r.params})},s=Tt(r);!(t=s()).done;)a();this._runtimeEvents={ratios:i,eventGroups:n}},i._applyStepness=function(){this._runtimeCurves},i._decodeCVTAs=function(){var t=ArrayBuffer.isView(this._nativeAsset)?this._nativeAsset.buffer:this._nativeAsset;if(t){for(var e=this._keys,i=0;i<e.length;++i){var n=e[i];n instanceof Qi&&(e[i]=n.decompress(t))}for(var r=0;r<this._curves.length;++r){var a=this._curves[r];a.data.values instanceof Qi&&(a.data.values=a.data.values.decompress(t))}}},ut(e,[{key:"duration",get:function(){return this._duration},set:function(t){this._duration=t}},{key:"keys",get:function(){return this._keys},set:function(t){this._keys=t}},{key:"eventGroups",get:function(){return this._runtimeEvents||this._createRuntimeEvents(),this._runtimeEvents.eventGroups}},{key:"stepness",get:function(){return this._stepness},set:function(t){this._stepness=t,this._applyStepness()}},{key:"hash",get:function(){if(this._hash)return this._hash;var t=this._nativeAsset,e=new Uint8Array(ArrayBuffer.isView(t)?t.buffer:t);return this._hash=Ge(e,666)}},{key:"curves",get:function(){return this._curves},set:function(t){this._curves=t,delete this._runtimeCurves}},{key:"data",get:function(){return this._data}},{key:"commonTargets",get:function(){return this._commonTargets},set:function(t){this._commonTargets=t}}]),e}(kt),$s.preventDeferredLoadDependents=!0,$s.WrapMode=He,Vs=rt((Ls=Qs).prototype,"sample",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),Us=rt(Ls.prototype,"speed",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ws=rt(Ls.prototype,"wrapMode",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return He.Normal}}),js=rt(Ls.prototype,"events",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Hs=rt(Ls.prototype,"_duration",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qs=rt(Ls.prototype,"_keys",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Gs=rt(Ls.prototype,"_stepness",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ys=rt(Ls.prototype,"_curves",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ks=rt(Ls.prototype,"_commonTargets",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xs=rt(Ls.prototype,"_hash",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zs=Ls))||zs);function to(t,e,i){var n,r=e[e.length-1];if(0!==e.length&&Ye(r)&&!i){var a=Ke.apply(void 0,[t].concat(e.slice(0,e.length-1)));if(null===a)return null;n={isProxy:!1,object:a,property:r}}else{if(!i)return xt("Empty animation curve."),null;var s=Ke.apply(void 0,[t].concat(e));if(null===s)return null;n={isProxy:!0,proxy:i.forTarget(s)}}return{setValue:function(t){n.isProxy?n.proxy.set(t):n.object[n.property]=t},getValue:function(){return n.isProxy?n.proxy.get?n.proxy.get():(xt("Target doesn't provide a get method."),null):n.object[n.property]}}}function eo(t,e,i){var n=to(t,e,i);if(null===n)return null;var r=n.getValue(),a=no(r);if(!a)return xt("Value is not copyable!"),null;var s=a.createBuffer(),o=a.copy;return Object.assign(n,{peek:function(){return s},pull:function(){var t=n.getValue();o(s,t)},push:function(){n.setValue(s)}})}tt.AnimationClip=Zs;var io,no=((io=new Map).set(i,{createBuffer:function(){return new i},copy:i.copy}),io.set(r,{createBuffer:function(){return new r},copy:r.copy}),io.set(s,{createBuffer:function(){return new s},copy:s.copy}),io.set(v,{createBuffer:function(){return new v},copy:v.copy}),function(t){return io.get(null==t?void 0:t.constructor)}),ro=function(){function t(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var e=t.prototype;return e.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(et(3912)):(this._isPlaying=!0,this.onPlay())},e.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},e.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},e.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},e.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.update=function(){},e.onPlay=function(){},e.onPause=function(){},e.onResume=function(){},e.onStop=function(){},e.onError=function(){},ut(t,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),t}(),ao=function(){function t(){this._nodeBlendStates=new Map,this._states=new Set}var e=t.prototype;return e.ref=function(t,e){var i=this._nodeBlendStates.get(t);i||(i={dirty:!1,properties:{}},this._nodeBlendStates.set(t,i));var n=i.properties[e];return n||(n=i.properties[e]=new uo(i,so(e)?new r:new u)),++n.refCount,n},e.deRef=function(t,e){var i=this._nodeBlendStates.get(t);if(i){var n=i.properties[e];n&&(--n.refCount,n.refCount>0||(delete i.properties[e],function(t){return!(t.properties.position||t.properties.rotation||t.properties.eulerAngles||t.properties.scale)}(i)&&this._nodeBlendStates.delete(t)))}},e.apply=function(){this._nodeBlendStates.forEach((function(t,e){if(t.dirty){t.dirty=!1;var i,n,r,a=t.properties,s=a.position,o=a.scale,u=a.rotation,h=a.eulerAngles,l=!1;s&&0!==s.weight&&(s.weight=0,i=s.value,l=!0),o&&0!==o.weight&&(o.weight=0,n=o.value,l=!0),u&&0!==u.weight&&(u.weight=0,r=u.value,l=!0),h&&0!==h.weight&&(h.weight=0,r=h.value,l=!0),l&&e.setRTS(r,i,n)}})),this._states.forEach((function(t){t.onBlendFinished()}))},e.bindState=function(t){this._states.add(t)},e.unbindState=function(t){this._states.delete(t)},t}();function so(t){return!function(t){return"rotation"===t}(t)}var oo,uo=function(){function t(t,e){this.weight=0,this.value=void 0,this.refCount=0,this._node=void 0,this._node=t,this.value=e}return t.prototype.markAsDirty=function(){this._node.dirty=!0},t}();function ho(t,e,i){return 0===i.weight&&r.zero(i.value),0===e?i.value:1===e?r.copy(i.value,t):r.scaleAndAdd(i.value,i.value,t,e)}function lo(t,e,i){if(0===i.weight&&u.identity(i.value),0===e)return i.value;if(1===e)return u.copy(i.value,t);var n=e/(i.weight+e);return u.slerp(i.value,i.value,t,n)}!function(t){t.PLAY="play",t.STOP="stop",t.PAUSE="pause",t.RESUME="resume",t.LASTFRAME="lastframe",t.FINISHED="finished"}(oo||(oo={})),Et(oo);var co=function(){function t(t,e,i){this.commonTargetIndex=void 0,this._curve=void 0,this._boundTarget=void 0,this._rootTargetProperty=void 0,this._curveDetail=void 0,this._curve=t.curve,this._curveDetail=t,this._boundTarget=i}var e=t.prototype;return e.applySample=function(t,e,i,n,r){var a;this._curve.empty()||(a=this._curve.hasLerp()&&i?this._curve.valueBetween(t,n.from,n.fromRatio,n.to,n.toRatio):this._curve.valueAt(e),this._setValue(a,r))},e._setValue=function(t){this._boundTarget.setValue(t)},ut(t,[{key:"propertyName",get:function(){return this._rootTargetProperty||""}},{key:"curveDetail",get:function(){return this._curveDetail}}]),t}(),fo=t("A",function(t){function e(e,i){var n;return void 0===i&&(i=""),(n=t.call(this)||this).duration=1,n.speed=1,n.time=0,n.weight=0,n.frameRate=0,n._wrapMode=He.Normal,n._repeatCount=1,n._currentFramePlayed=!1,n._delay=0,n._delayTime=0,n._wrappedInfo=new Xe,n._lastWrapInfo=null,n._lastWrapInfoEvent=null,n._process=n.process,n._target=null,n._targetNode=null,n._clip=void 0,n._name=void 0,n._lastIterations=void 0,n._samplerSharedGroups=[],n._commonTargetStatuses=[],n._curveLoaded=!1,n._ignoreIndex=-1,n._blendStateBuffer=null,n._blendStateWriters=[],n._allowLastFrame=!1,n._blendStateWriterHost={weight:0,enabled:!1},n._clip=e,n._name=i||e&&e.name,n}ot(e,t),ut(e,[{key:"clip",get:function(){return this._clip}},{key:"name",get:function(){return this._name}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this._wrapMode},set:function(t){this._wrapMode=t,this.time=0,t&$e.Loop?this.repeatCount=1/0:this.repeatCount=1}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t;var e=this._wrapMode&$e.ShouldWrap,i=(this.wrapMode&$e.Reverse)===$e.Reverse;this._process=t!==1/0||e||i?this.process:this.simpleProcess}},{key:"delay",get:function(){return this._delay},set:function(t){this._delayTime=this._delay=t}}]);var i=e.prototype;return i.initialize=function(t,e){var i,n,r=this;if(!this._curveLoaded){this._curveLoaded=!0,this._destroyBlendStateWriters(),this._samplerSharedGroups.length=0,this._blendStateBuffer=null!==(i=null===(n=tt.director.getAnimationManager())||void 0===n?void 0:n.blendState)&&void 0!==i?i:null,this._blendStateBuffer&&this._blendStateBuffer.bindState(this),this._targetNode=t;var a=this._clip;this.duration=a.duration,this.speed=a.speed,this.wrapMode=a.wrapMode,this.frameRate=a.sample,(this.wrapMode&$e.Loop)===$e.Loop?this.repeatCount=1/0:this.repeatCount=1;var s=function(t,e,i,n,a){if(!function(t){var e;if(1===t.length&&"string"==typeof t[0])e=t[0];else if(t.length>1){for(var i=0;i<t.length-1;++i)if(!(t[i]instanceof Qe))return!1;e=t[t.length-1]}switch(e){case"position":case"scale":case"rotation":case"eulerAngles":return!0;default:return!1}}(i)||!r._blendStateBuffer)return t(e,i,n);var s=Ke.apply(void 0,[e].concat(i.slice(0,i.length-1)));if(null!==s&&s instanceof me){var o=i[i.length-1],u=function(t,e,i,n,r){var a=so(i)?ho:lo,s=t.ref(e,i),o=!1,u=-1;return{destroy:function(){s&&(t.deRef(e,i),s=null)},forTarget:function(){return{get:function(){return e[i]},set:function(t){if(s&&n.enabled){var e=n.weight;if(r)if(1!==e||e!==u)o=!1;else if(o)return;a(t,e,s),s.weight+=e,s.markAsDirty(),o=!0,u=e}}}}}}(r._blendStateBuffer,s,o,r._blendStateWriterHost,a);return r._blendStateWriters.push(u),t(e,[],u)}return null};this._commonTargetStatuses=a.commonTargets.map((function(e){var i=s(eo,t,e.modifiers,e.valueAdapter,!1);return null===i?null:{target:i,changed:!1}})),e||(e=a.getPropertyCurves());for(var o=function(i){var n=e[i],a=r._samplerSharedGroups.find((function(t){return t.sampler===n.sampler}));a||(a={sampler:n.sampler,curves:[],samplerResultCache:{from:0,fromRatio:0,to:0,toRatio:0}},r._samplerSharedGroups.push(a));var o=void 0;if(void 0===n.commonTarget)o=t;else{var u=r._commonTargetStatuses[n.commonTarget];if(!u)return"continue";o=u.target.peek()}var h=s(to,o,n.modifiers,n.valueAdapter,n.curve.constant());if(null===h);else{var l=new co(n,o,h);l.commonTargetIndex=n.commonTarget,a.curves.push(l)}},u=0;u<e.length;++u)o(u)}},i.destroy=function(){this._destroyBlendStateWriters()},i.onBlendFinished=function(){this._blendStateWriterHost.enabled=!1},i.emit=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];tt.director.getAnimationManager().pushDelayEvent(this._emit,this,e)},i.on=function(t,e,i){return this._target&&this._target.isValid?this._target.on(t,e,i):null},i.once=function(t,e,i){return this._target&&this._target.isValid?this._target.once(t,e,i):null},i.off=function(t,e,i){this._target&&this._target.isValid&&this._target.off(t,e,i)},i.allowLastFrameEvent=function(t){this._allowLastFrame=t},i._setEventTarget=function(t){this._target=t},i.setTime=function(t){this._currentFramePlayed=!1,this.time=t||0,this._lastWrapInfoEvent=null,this._ignoreIndex=-1;var e=this.getWrappedInfo(t,this._wrappedInfo),i=e.direction,n=this._clip.getEventGroupIndexAtRatio(e.ratio);n<0&&(n=~n-1,i<0&&(n+=1),this._ignoreIndex=n)},i.update=function(t){this._delayTime>0&&(this._delayTime-=t,this._delayTime>0)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process())},i._needReverse=function(t){var e=this.wrapMode,i=!1;return(e&$e.PingPong)===$e.PingPong&&(t-(0|t)==0&&t>0&&(t-=1),1&t&&(i=!i)),(e&$e.Reverse)===$e.Reverse&&(i=!i),i},i.getWrappedInfo=function(t,e){e=e||new Xe;var i=!1,n=this.duration,r=this.repeatCount,a=t>0?t/n:-t/n;if(a>=r){a=r,i=!0;var s=r-(0|r);0===s&&(s=1),t=s*n*(t>0?1:-1)}if(t>n){var o=t%n;t=0===o?n:o}else t<0&&0!=(t%=n)&&(t+=n);var u=!1,h=this._wrapMode&$e.ShouldWrap;h&&(u=this._needReverse(a));var l=u?-1:1;return this.speed<0&&(l*=-1),h&&u&&(t=n-t),e.ratio=t/n,e.time=t,e.direction=l,e.stopped=i,e.iterations=a,e},i.sample=function(){var t=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(t.ratio),this._sampleEvents(t),t},i.process=function(){var t,e=this.sample();this._allowLastFrame&&(t=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new Xe(e),this.repeatCount>1&&(0|e.iterations)>(0|t.iterations)&&this.emit(oo.LASTFRAME,this),t.set(e)),e.stopped&&(this.stop(),this.emit(oo.FINISHED,this))},i.simpleProcess=function(){var t=this.duration,e=this.time%t;e<0&&(e+=t);var i=e/t;this._sampleCurves(i),this._clip.hasEvents()&&this._sampleEvents(this.getWrappedInfo(this.time,this._wrappedInfo)),this._allowLastFrame&&(void 0===this._lastIterations&&(this._lastIterations=i),(this.time>0&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit(oo.LASTFRAME,this),this._lastIterations=i)},i.cache=function(){},i.onPlay=function(){this.setTime(0),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(oo.PLAY,this)},i.onStop=function(){this.isPaused||this._onPauseOrStop(),this.emit(oo.STOP,this)},i.onResume=function(){this._onReplayOrResume(),this.emit(oo.RESUME,this)},i.onPause=function(){this._onPauseOrStop(),this.emit(oo.PAUSE,this)},i._sampleCurves=function(t){this._blendStateWriterHost.weight=this.weight,this._blendStateWriterHost.enabled=!0;for(var e=0;e<this._commonTargetStatuses.length;++e){var i=this._commonTargetStatuses[e];i&&(i.target.pull(),i.changed=!1)}for(var n=0,r=this._samplerSharedGroups.length;n<r;++n){var a=this._samplerSharedGroups[n],s=a.sampler,o=a.samplerResultCache,u=0,h=!1;s?(u=s.sample(t))<0&&((u=~u)<=0?u=0:u>=s.ratios.length?u=s.ratios.length-1:(h=!0,o.from=u-1,o.fromRatio=s.ratios[o.from],o.to=u,o.toRatio=s.ratios[o.to],u=o.from)):u=0;for(var l=0,c=a.curves.length;l<c;++l){var f=a.curves[l];if(f.applySample(t,u,h,o,this.weight),void 0!==f.commonTargetIndex){var p=this._commonTargetStatuses[f.commonTargetIndex];p&&(p.changed=!0)}}}for(var m=0;m<this._commonTargetStatuses.length;++m){var d=this._commonTargetStatuses[m];d&&d.changed&&d.target.push()}},i._sampleEvents=function(t){var e=this._clip.eventGroups.length,i=t.direction,n=this._clip.getEventGroupIndexAtRatio(t.ratio);if(n<0&&(n=~n-1,i<0&&(n+=1)),this._ignoreIndex!==n&&(this._ignoreIndex=-1),t.frameIndex=n,!this._lastWrapInfoEvent)return this._fireEvent(n),void(this._lastWrapInfoEvent=new Xe(t));var r=this.wrapMode,a=po(t.iterations),s=this._lastWrapInfoEvent,o=po(s.iterations),u=s.frameIndex,h=s.direction,l=-1!==o&&a!==o;if(u===n&&l&&1===e)this._fireEvent(0);else if(u!==n||l){i=h;do{if(u!==n){if(-1===i&&0===u&&n>0?((r&$e.PingPong)===$e.PingPong?i*=-1:u=e,o++):1===i&&u===e-1&&n<e-1&&((r&$e.PingPong)===$e.PingPong?i*=-1:u=-1,o++),u===n)break;if(o>a)break}u+=i,tt.director.getAnimationManager().pushDelayEvent(this._fireEvent,this,[u])}while(u!==n&&u>-1&&u<e)}this._lastWrapInfoEvent.set(t)},i._emit=function(t,e){this._target&&this._target.isValid&&this._target.emit(t,t,e)},i._fireEvent=function(t){if(this._targetNode&&this._targetNode.isValid){var e=this._clip.eventGroups;if(!(t<0||t>=e.length||this._ignoreIndex===t))for(var i,n=e[t],r=this._targetNode.components,a=Tt(n.events);!(i=a()).done;)for(var s,o=i.value,u=o.functionName,h=Tt(r);!(s=h()).done;){var l=s.value,c=l[u];"function"==typeof c&&c.apply(l,o.parameters)}}},i._onReplayOrResume=function(){tt.director.getAnimationManager().addAnimation(this)},i._onPauseOrStop=function(){tt.director.getAnimationManager().removeAnimation(this)},i._destroyBlendStateWriters=function(){for(var t=0;t<this._blendStateWriters.length;++t)this._blendStateWriters[t].destroy();this._blendStateWriters.length=0,this._blendStateBuffer&&(this._blendStateBuffer.unbindState(this),this._blendStateBuffer=null),this._blendStateWriterHost.enabled=!1},ut(e,[{key:"curveLoaded",get:function(){return this._curveLoaded}}]),e}(ro));function po(t){return t-(0|t)==0&&(t-=1),0|t}tt.AnimationState=fo;var mo,_o,go,vo,yo,bo,wo,So,To,Ao,ko,xo,Eo,Co,Io,No,Po,Mo=function(t){function e(){var e;return(e=t.call(this)||this)._managedStates=[],e._fadings=[],e}ot(e,t);var i=e.prototype;return i.update=function(t){if(!this.isMotionless){for(var e=0;e<this._managedStates.length;++e){var i=this._managedStates[e].state;i&&(i.weight=0)}for(var n=1,r=this._fadings.length,a=0;a<this._fadings.length;++a){var s=this._fadings[a];s.easeTime+=t;var o=0===s.easeDuration?1:A(s.easeTime/s.easeDuration),u=o*n;if(n*=1-o,s.target.state&&(s.target.state.weight+=u),s.easeTime>=s.easeDuration){r=a+1,s.easeTime=s.easeDuration;break}}if(r!==this._fadings.length){for(var h=r;h<this._fadings.length;++h){var l=this._fadings[h];--l.target.reference,l.target.reference<=0&&(l.target.state&&l.target.state.stop(),Ct(this._managedStates,l.target))}this._fadings.splice(r)}for(var c=0;c<this._managedStates.length;++c){var f=this._managedStates[c].state;f&&f.isMotionless&&f.sample()}}},i.crossFade=function(t,e){var i;0===this._managedStates.length&&(e=0),0===e&&this.clear();var n=this._managedStates.find((function(e){return e.state===t}));n?(null===(i=n.state)||void 0===i?void 0:i.isMotionless)&&n.state.play():(n={state:t,reference:0},t&&t.play(),this._managedStates.push(n)),++n.reference,this._fadings.unshift({easeDuration:e,easeTime:0,target:n})},i.clear=function(){for(var t=0;t<this._managedStates.length;++t){var e=this._managedStates[t].state;e&&e.stop()}this._managedStates.length=0,this._fadings.length=0},i.onPlay=function(){t.prototype.onPlay.call(this),tt.director.getAnimationManager().addCrossFade(this)},i.onPause=function(){t.prototype.onPause.call(this),tt.director.getAnimationManager().removeCrossFade(this);for(var e=0;e<this._managedStates.length;++e){var i=this._managedStates[e].state;i&&i.pause()}},i.onResume=function(){t.prototype.onResume.call(this),tt.director.getAnimationManager().addCrossFade(this);for(var e=0;e<this._managedStates.length;++e){var i=this._managedStates[e].state;i&&i.resume()}},i.onStop=function(){t.prototype.onStop.call(this),tt.director.getAnimationManager().removeCrossFade(this),this.clear()},e}(ro),Ro=t("v",(mo=V("cc.Animation"),_o=Y(),go=fe(99),vo=j(),yo=K([Zs]),bo=lt(),wo=K(Zs),So=lt(),To=lt(),Ao=K([Zs]),mo(ko=_o(ko=go(ko=W(ko=vo((Po=No=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,at(e,"playOnLoad",Eo,ht(e)),e._crossFade=new Mo,e._nameToState=It(!0),at(e,"_clips",Co,ht(e)),at(e,"_defaultClip",Io,ht(e)),e._hasBeenPlayed=!1,e}ot(e,t);var i=e.prototype;return i.onLoad=function(){for(var t in this.clips=this._clips,this._nameToState)this._nameToState[t].initialize(this.node)},i.start=function(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},i.onEnable=function(){this._crossFade.resume()},i.onDisable=function(){this._crossFade.pause()},i.onDestroy=function(){for(var t in this._crossFade.stop(),this._nameToState)this._nameToState[t].destroy();this._nameToState=It(!0)},i.play=function(t){if(this._hasBeenPlayed=!0,!t){if(!this._defaultClip)return;t=this._defaultClip.name}this.crossFade(t,0)},i.crossFade=function(t,e){void 0===e&&(e=.3),this._hasBeenPlayed=!0;var i=this._nameToState[t];i&&(this._crossFade.play(),this._crossFade.crossFade(i,e))},i.pause=function(){this._crossFade.pause()},i.resume=function(){this._crossFade.resume()},i.stop=function(){this._crossFade.stop()},i.getAnimationState=function(t){return this.getState(t)},i.getState=function(t){var e=this._nameToState[t];return e&&!e.curveLoaded&&e.initialize(this.node),e||null},i.createState=function(t,e){return e=e||t.name,this.removeState(e),this._doCreateState(t,e)},i.removeState=function(t){var e=this._nameToState[t];e&&(e.allowLastFrameEvent(!1),e.stop(),delete this._nameToState[t])},i.addClip=function(t,e){return Nt(this._clips,t)||this._clips.push(t),this.createState(t,e)},i.removeClip=function(t,e){var i;for(var n in this._nameToState){var r=this._nameToState[n];if(r.clip===t){i=r;break}}if(t===this._defaultClip){if(!e)return void Pt(3902);this._defaultClip=null}if(i&&i.isPlaying){if(!e)return void Pt(3903);i.stop()}this._clips=this._clips.filter((function(e){return e!==t})),i&&delete this._nameToState[i.name]},i.on=function(e,i,n,r){var a=t.prototype.on.call(this,e,i,n,r);return e===oo.LASTFRAME&&this._syncAllowLastFrameEvent(),a},i.once=function(e,i,n){var r=t.prototype.once.call(this,e,i,n);return e===oo.LASTFRAME&&this._syncAllowLastFrameEvent(),r},i.off=function(e,i,n){t.prototype.off.call(this,e,i,n),e===oo.LASTFRAME&&this._syncDisallowLastFrameEvent()},i._createState=function(t,e){return new fo(t,e)},i._doCreateState=function(t,e){var i=this._createState(t,e);return i._setEventTarget(this),i.allowLastFrameEvent(this.hasEventListener(oo.LASTFRAME)),this.node&&i.initialize(this.node),this._nameToState[i.name]=i,i},i._getStateByNameOrDefaultClip=function(t){if(!t){if(!this._defaultClip)return null;t=this._defaultClip.name}return this._nameToState[t]||null},i._removeStateOfAutomaticClip=function(t){for(var e in this._nameToState){var i=this._nameToState[e];Oo(t,i.clip)&&(i.stop(),delete this._nameToState[e])}},i._syncAllowLastFrameEvent=function(){if(this.hasEventListener(oo.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!0)},i._syncDisallowLastFrameEvent=function(){if(!this.hasEventListener(oo.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!1)},ut(e,[{key:"clips",get:function(){return this._clips},set:function(t){var e=this;this._crossFade&&this._crossFade.clear();for(var i,n=Tt(this._clips);!(i=n()).done;){var r=i.value;r&&this._removeStateOfAutomaticClip(r)}for(var a,s=Tt(t);!(a=s()).done;){var o=a.value;o&&this.createState(o)}var u=t.find((function(t){return Oo(t,e._defaultClip)}));this._defaultClip=u||null,this._clips=t}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(t){this._defaultClip=t,t&&(this._clips.findIndex((function(e){return Oo(e,t)}))>=0||(this._clips.push(t),this.createState(t)))}}]),e}(Mt(_t)),No.EventType=oo,rt((xo=Po).prototype,"clips",[yo,bo],Object.getOwnPropertyDescriptor(xo.prototype,"clips"),xo.prototype),rt(xo.prototype,"defaultClip",[wo,So],Object.getOwnPropertyDescriptor(xo.prototype,"defaultClip"),xo.prototype),Eo=rt(xo.prototype,"playOnLoad",[st,To],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Co=rt(xo.prototype,"_clips",[Ao],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Io=rt(xo.prototype,"_defaultClip",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ko=xo))||ko)||ko)||ko)||ko)||ko));function Oo(t,e){return t===e||!(!t||!e||t.name!==e.name&&t._uuid!==e._uuid)}var Do,Bo,Fo,zo,Lo,Vo,Uo,Wo,jo,Ho,qo,Go,Yo,Ko,Xo,$o,Qo,Jo,Zo,tu,eu=new c,iu=new c,nu=[],ru=t("J",function(t){function e(e,i){var n;return void 0===i&&(i=""),(n=t.call(this,e,i)||this)._frames=1,n._bakedDuration=0,n._animInfo=null,n._sockets=[],n._animInfoMgr=void 0,n._comps=[],n._parent=null,n._curvesInited=!1,n._animInfoMgr=tt.director.root.dataPoolManager.jointAnimationInfo,n}ot(e,t);var i=e.prototype;return i.initialize=function(e){if(!this._curveLoaded){this._comps.length=0;for(var i=e.getComponentsInChildren(pa),n=0;n<i.length;++n){var r=i[n];r.skinningRoot===e&&this._comps.push(r)}this._parent=e.getComponent("cc.SkeletalAnimation");var a=this._parent.useBakedAnimation;t.prototype.initialize.call(this,e,a?nu:void 0),this._curvesInited=!a;var s=je.getOrExtract(this.clip).info;this._frames=s.frames-1,this._animInfo=this._animInfoMgr.getData(e.uuid),this._bakedDuration=this._frames/s.sample}},i.onPlay=function(){if(t.prototype.onPlay.call(this),this._parent.useBakedAnimation){this._sampleCurves=this._sampleCurvesBaked,this.duration=this._bakedDuration,this._animInfoMgr.switchClip(this._animInfo,this._clip);for(var e=0;e<this._comps.length;++e)this._comps[e].uploadAnimation(this.clip)}else this._sampleCurves=t.prototype._sampleCurves,this.duration=this._clip.duration,this._curvesInited||(this._curveLoaded=!1,t.prototype.initialize.call(this,this._targetNode),this._curvesInited=!0)},i.rebuildSocketCurves=function(t){if(this._sockets.length=0,this._targetNode)for(var e=this._targetNode,i=0;i<t.length;++i){var n=t[i],a=e.getChildByPath(n.path);if(n.target){for(var s=je.getOrExtract(this.clip),o=n.path,h=s.data[o],l=a,f=void 0;!h;){var p=o.lastIndexOf("/");if(o=o.substring(0,p),h=s.data[o],l&&(f||(f=c.identity(iu)),c.fromRTS(eu,l.rotation,l.position,l.scale),c.multiply(f,eu,f),l=l.parent),p<0)break}for(var m=h&&h.worldMatrix.values,d=s.info.frames,_=[],g=0;g<d;g++){var v;v=m&&f?c.multiply(eu,m[g],f):m?m[g]:f||c.IDENTITY;var y={pos:new r,rot:new u,scale:new r};c.toRTS(v,y.rot,y.pos,y.scale),_.push(y)}this._sockets.push({target:n.target,frames:_})}}},i._sampleCurvesBaked=function(t){var e=this._animInfo,i=t*this._frames+.5|0;if(i!==e.data[0]){e.data[0]=i,e.dirty=!0;for(var n=0;n<this._sockets.length;++n){var r=this._sockets[n],a=r.target,s=r.frames[i],o=s.pos,u=s.rot,h=s.scale;a.setRTS(u,o,h)}}},e}(fo)),au=t("K",(Do=V("cc.SkeletalAnimation.Socket"),Bo=K(me),Do((Lo=rt((zo=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),at(this,"path",Lo,this),at(this,"target",Vo,this),this.path=t,this.target=e}).prototype,"path",[st,ct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Vo=rt(zo.prototype,"target",[Bo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fo=zo))||Fo));it.setClassAlias(au,"cc.SkeletalAnimationComponent.Socket");var su=new c,ou=new c;function uu(t,e,i){void 0===e&&(e=""),void 0===i&&(i=[]);for(var n=0;n<t.children.length;n++){var r=t.children[n];if(r){var a=e?e+"/"+r.name:r.name;i.push(a),uu(r,a,i)}}return i}var hu,lu,cu,fu=t("w",(Uo=V("cc.SkeletalAnimation"),Wo=Y(),jo=fe(99),Ho=j(),qo=K([au]),Go=lt(),Yo=lt(),Ko=K([au]),Uo(Xo=Wo(Xo=jo(Xo=W(Xo=Ho((tu=Zo=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,at(e,"_useBakedAnimation",Qo,ht(e)),at(e,"_sockets",Jo,ht(e)),e}ot(e,t);var i=e.prototype;return i.onDestroy=function(){t.prototype.onDestroy.call(this),tt.director.root.dataPoolManager.jointAnimationInfo.destroy(this.node.uuid),tt.director.getAnimationManager().removeSockets(this.node,this._sockets)},i.start=function(){this.sockets=this._sockets,this.useBakedAnimation=this._useBakedAnimation,t.prototype.start.call(this)},i.querySockets=function(){var t=this._defaultClip&&Object.keys(je.getOrExtract(this._defaultClip).data).sort().reduce((function(t,e){return e.startsWith(t[t.length-1])||t.push(e),t}),[])||[];if(!t.length)return["please specify a valid default animation clip first"];for(var e=[],i=0;i<t.length;i++){var n=t[i],r=this.node.getChildByPath(n);r&&(e.push(n),uu(r,n,e))}return e},i.rebuildSocketAnimations=function(){for(var t,e=Tt(this._sockets);!(t=e()).done;){var i=t.value,n=this.node.getChildByPath(i.path),r=i.target;n&&r&&(r.name=i.path.substring(i.path.lastIndexOf("/")+1)+" Socket",r.parent=this.node,Ce(n,this.node,su),c.fromRTS(ou,r.rotation,r.position,r.scale),c.equals(ou,su)||(r.matrix=su))}for(var a=0,s=Object.keys(this._nameToState);a<s.length;a++){var o=s[a];this._nameToState[o].rebuildSocketCurves(this._sockets)}},i.createSocket=function(t){var e=this._sockets.find((function(e){return e.path===t}));if(e)return e.target;if(!this.node.getChildByPath(t))return console.warn("illegal socket path"),null;var i=new me;return i.parent=this.node,this._sockets.push(new au(t,i)),this.rebuildSocketAnimations(),i},i._createState=function(t,e){return new ru(t,e)},i._doCreateState=function(e,i){var n=t.prototype._doCreateState.call(this,e,i);return n.rebuildSocketCurves(this._sockets),n},ut(e,[{key:"sockets",get:function(){return this._sockets},set:function(t){if(!this._useBakedAnimation){var e=tt.director.getAnimationManager();e.removeSockets(this.node,this._sockets),e.addSockets(this.node,t)}this._sockets=t,this.rebuildSocketAnimations()}},{key:"useBakedAnimation",get:function(){return this._useBakedAnimation},set:function(t){this._useBakedAnimation=t;for(var e=this.node.getComponentsInChildren(pa),i=0;i<e.length;++i){var n=e[i];n.skinningRoot===this.node&&n.setUseBakedAnimation(this._useBakedAnimation)}this._useBakedAnimation?tt.director.getAnimationManager().removeSockets(this.node,this._sockets):tt.director.getAnimationManager().addSockets(this.node,this._sockets)}}]),e}(Ro),Zo.Socket=au,rt(($o=tu).prototype,"sockets",[qo,Go],Object.getOwnPropertyDescriptor($o.prototype,"sockets"),$o.prototype),rt($o.prototype,"useBakedAnimation",[Yo],Object.getOwnPropertyDescriptor($o.prototype,"useBakedAnimation"),$o.prototype),Qo=rt($o.prototype,"_useBakedAnimation",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Jo=rt($o.prototype,"_sockets",[Ko],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xo=$o))||Xo)||Xo)||Xo)||Xo)||Xo));wt(Ro.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var t=arguments.length<=0?void 0:arguments[0];return Ro.prototype.removeState.call(this,t.name)}}]),tt.AnimationComponent=Ro,it.setClassAlias(Ro,"cc.AnimationComponent"),tt.SkeletalAnimationComponent=fu,it.setClassAlias(fu,"cc.SkeletalAnimationComponent");var pu,mu,du,_u,gu=t("I",V((cu=lu=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._anims=new Rt([]),e._delayEvents=[],e._blendStateBuffer=new ao,e._crossFades=[],e._sockets=[],e}ot(e,t);var i=e.prototype;return i.addCrossFade=function(t){this._crossFades.push(t)},i.removeCrossFade=function(t){Ct(this._crossFades,t)},i.update=function(t){for(var e=this._delayEvents,i=this._crossFades,n=this._sockets,r=0,a=i.length;r<a;r++)i[r].update(t);var s=this._anims,o=s.array;for(s.i=0;s.i<o.length;++s.i){var u=o[s.i];u.isMotionless||u.update(t)}this._blendStateBuffer.apply();for(var h=tt.director.getTotalFrames(),l=0,c=n.length;l<c;l++){var f=n[l],p=f.target,m=f.transform;p.matrix=Je(m,h)}for(var d=0,_=e.length;d<_;d++){var g=e[d];g.fn.apply(g.thisArg,g.args)}e.length=0},i.destruct=function(){},i.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},i.removeAnimation=function(t){var e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):At(3907)},i.pushDelayEvent=function(t,e,i){this._delayEvents.push({fn:t,thisArg:e,args:i})},i.addSockets=function(t,e){for(var i=this,n=function(n){var r=e[n];if(i._sockets.find((function(t){return t.target===r.target})))return"continue";var a=t.getChildByPath(r.path),s=r.target&&a&&ti(a,t);s&&i._sockets.push({target:r.target,transform:s})},r=0;r<e.length;++r)n(r)},i.removeSockets=function(t,e){for(var i=0;i<e.length;++i)for(var n=e[i],r=0;r<this._sockets.length;++r){var a=this._sockets[r];if(a.target===n.target){Ze(a.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},ut(e,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),e}(Ei),lu.ID="animation",hu=cu))||hu);Ai.on(ki.EVENT_INIT,(function(){var t=new gu;Ai.registerSystem(gu.ID,t,xi.PRIORITY_SYSTEM)})),tt.AnimationManager=gu,tt.easing=Ts;var vu=t("H",V("cc.HierachyModifier")(pu=function(t){function e(){return t.apply(this,arguments)||this}return ot(e,t),e}(Qe))||pu);tt.HierachyModifier=vu;var yu=t("o",V("cc.ComponentModifier")(mu=function(t){function e(){return t.apply(this,arguments)||this}return ot(e,t),e}(qe))||mu);tt.ComponentModifier=yu;var bu=t("p",V("cc.CurveValueAdapter")(du=function(){function t(){}return t.prototype.forTarget=function(){return{set:function(){}}},t}())||du);tt.CurveValueAdapter=bu;var wu=t("q",V("cc.UniformCurveValueAdapter")(_u=function(t){function e(){return t.apply(this,arguments)||this}return ot(e,t),e}(La))||_u);function Su(t){return"string"==typeof t}function Tu(t){return"number"==typeof t}function Au(t,e){return t instanceof e}tt.UniformCurveValueAdapter=wu,tt.isPropertyModifier=Su,tt.isElementModifier=Tu,tt.isCustomTargetModifier=Au;var ku,xu=function(){function t(t,e,i){this._id=void 0,this._opts=void 0,this._accumStart=void 0,this._total=0,this._value=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._id=t,this._opts=e,this._accumStart=i}ut(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]);var e=t.prototype;return e.sample=function(t){this._average(this._value,t)},e.human=function(){var t=this._opts,e=t.average,i=t.isInteger,n=e?this._averageValue:this._value;return i?Math.round(n):Math.round(100*n)/100},e.alarm=function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over},e._average=function(t,e){if(void 0===e&&(e=0),this._opts.average){this._accumValue+=t,++this._accumSamples;var i=e;i-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=i,this._accumSamples=0)}},t}(),Eu=V("cc.PerfCounter")(ku=function(t){function e(e,i,n){var r;return(r=t.call(this,e,i,n)||this)._time=void 0,r._time=n,r}ot(e,t);var i=e.prototype;return i.start=function(t){void 0===t&&(t=0),this._time=t},i.end=function(t){void 0===t&&(t=0),this._value=t-this._time,this._average(this._value)},i.tick=function(){this.end(),this.start()},i.frame=function(t){var e=t,i=e-this._time;this._total++,i>(this._opts.average||1e3)&&(this._value=1e3*this._total/i,this._total=0,this._time=e,this._average(this._value))},e}(xu))||ku,Cu={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,".":10},Iu={fps:{desc:"Framerate (FPS)",below:30,average:500,isInteger:!0},draws:{desc:"Draw call",isInteger:!0},frame:{desc:"Frame time (ms)",min:0,max:50,average:500},instances:{desc:"Instance Count",isInteger:!0},tricount:{desc:"Triangle",isInteger:!0},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},physics:{desc:"Physics (ms)",min:0,max:50,average:500},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},textureMemory:{desc:"GFX Texture Mem(M)"},bufferMemory:{desc:"GFX Buffer Mem(M)"}},Nu=t("P",function(){function t(){this._stats=null,this.id="__Profiler__",this._showFPS=!1,this._rootNode=null,this._device=null,this._canvas=null,this._ctx=null,this._texture=null,this._region=new Ae,this._canvasArr=[],this._regionArr=[this._region],this.digitsData=null,this.offsetData=null,this.pass=null,this._canvasDone=!1,this._statsDone=!1,this._inited=!1,this._lineHeight=256/(Object.keys(Iu).length+1),this._wordHeight=0,this._eachNumWidth=0,this._totalLines=0,this.lastTime=0,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvasArr.push(this._canvas)}var e=t.prototype;return e.isShowingStats=function(){return this._showFPS},e.hideStats=function(){this._showFPS&&(this._rootNode&&(this._rootNode.active=!1),tt.game.off(tt.Game.EVENT_RESTART,this.generateNode,this),tt.director.off(tt.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),tt.director.off(tt.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),tt.director.off(tt.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),tt.director.off(tt.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),tt.director.off(tt.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),tt.director.off(tt.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!1)},e.showStats=function(){this._showFPS||(this._device||(this._device=tt.director.root.device),this.generateCanvas(),this.generateStats(),tt.game.once(tt.Game.EVENT_ENGINE_INITED,this.generateNode,this),tt.game.on(tt.Game.EVENT_RESTART,this.generateNode,this),this._rootNode&&(this._rootNode.active=!0),tt.director.on(tt.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),tt.director.on(tt.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),tt.director.on(tt.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),tt.director.on(tt.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),tt.director.on(tt.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),tt.director.on(tt.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!0,this._canvasDone=!0,this._statsDone=!0)},e.generateCanvas=function(){if(!this._canvasDone){this._ctx&&this._canvas&&(this._canvas.width=256,this._canvas.height=256,this._canvas.style.width=""+this._canvas.width,this._canvas.style.height=""+this._canvas.height,this._ctx.font="23px Arial",this._ctx.textBaseline="top",this._ctx.fillStyle="#fff",this._texture=this._device.createTexture(new ei(ii.TEX2D,ni.SAMPLED|ni.TRANSFER_DST,be.RGBA8,256,256)),this._region.texExtent.width=256,this._region.texExtent.height=256)}},e.generateStats=function(){if(!this._statsDone&&this._ctx&&this._canvas){this._stats=null;var t=performance.now();this._ctx.textAlign="left";var e=0;for(var i in Iu){var n=Iu[i];this._ctx.fillText(n.desc,0,e*this._lineHeight),n.counter=new Eu(i,n,t),e++}this._totalLines=e,this._wordHeight=this._totalLines*this._lineHeight/this._canvas.height;for(var r=0;r<"0123456789. ".length;++r){var a=this._ctx.measureText("0123456789. "[r]).width;this._eachNumWidth=Math.max(this._eachNumWidth,a)}for(var s=0;s<"0123456789. ".length;++s)this._ctx.fillText("0123456789. "[s],s*this._eachNumWidth,this._totalLines*this._lineHeight);this._eachNumWidth/=this._canvas.width,this._stats=Iu,this._canvasArr[0]=this._canvas,this._device.copyTexImagesToTexture(this._canvasArr,this._texture,this._regionArr)}},e.generateNode=function(){if(!this._rootNode||!this._rootNode.isValid){this._rootNode=new me("PROFILER_NODE"),tt.game.addPersistRootNode(this._rootNode);var t=new me("Profiler_Camera");t.setPosition(0,0,1.5),t.parent=this._rootNode;var e=t.addComponent("cc.Camera");e.projection=Ti.ProjectionType.ORTHO,e.orthoHeight=1,e.near=1,e.far=2,e.visibility=ri.BitMask.PROFILER,e.clearFlags=ai.NONE,e.priority=4294967295,e.flows=["UIFlow"];var i=new me("Profiler_Root");i.parent=this._rootNode;for(var n=.4/this._totalLines,r=.4/this._wordHeight,a=n/23,s=this._eachNumWidth*this._canvas.width*a,o=[0,.4,0,r,.4,0,r,0,0,0,0,0],u=[0,2,1,0,3,2],h=[0,0,-1,0,1,0,-1,0,1,this._wordHeight,-1,0,0,this._wordHeight,-1,0],l=0,c=0;c<this._totalLines;c++)for(var f=0;f<8;f++){o.push(r+f*s,.4-c*n,0),o.push(r+(f+1)*s,.4-c*n,0),o.push(r+(f+1)*s,.4-(c+1)*n,0),o.push(r+f*s,.4-(c+1)*n,0),l=4*(8*c+f+1),u.push(0+l,2+l,1+l,0+l,3+l,2+l);var p=8*c+f,m=Math.floor(p/4),d=p-4*m;h.push(0,this._wordHeight,m,d),h.push(this._eachNumWidth,this._wordHeight,m,d),h.push(this._eachNumWidth,1,m,d),h.push(0,1,m,d)}var _=i.addComponent(ge);_.mesh=oe({positions:o,indices:u,colors:h});var g=new Te;g.initialize({effectName:"profiler"});var v=this.pass=g.passes[0],y=v.getBinding("mainTexture"),b=v.getBinding("digits"),w=v.getBinding("offset");v.bindTexture(y,this._texture),this.digitsData=v.blocks[b],this.offsetData=v.blocks[w],this.offsetData[3]=-1,_.material=g,_.node.layer=ri.Enum.PROFILER,this._inited=!0}},e.beforeUpdate=function(){if(this._stats){var t=performance.now();this._stats.frame.counter.end(t),this._stats.frame.counter.start(t),this._stats.logic.counter.start(t)}},e.afterUpdate=function(){if(this._stats){var t=performance.now();tt.director.isPaused()?this._stats.frame.counter.start(t):this._stats.logic.counter.end(t)}},e.beforePhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.start(t)}},e.afterPhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.end(t)}},e.beforeDraw=function(){if(this._stats){var t=this._device,e=t.screenSpaceSignY,i=t.surfaceTransform;if(i!==this.offsetData[3]){var n=Ot[i],r=-.9*e;this.offsetData[0]=-.9*n[0]+r*n[2],this.offsetData[1]=-.9*n[1]+r*n[3],this.offsetData[2]=this._eachNumWidth,this.offsetData[3]=i}this.pass._rootBufferDirty=!0;var a=performance.now();this._stats.render.counter.start(a)}},e.afterDraw=function(){if(this._stats&&this._inited){var t=performance.now();if(this._stats.fps.counter.frame(t),this._stats.render.counter.end(t),!(t-this.lastTime<500)){this.lastTime=t;var e=this._device;this._stats.draws.counter.value=e.numDrawCalls,this._stats.instances.counter.value=e.numInstances,this._stats.bufferMemory.counter.value=e.memoryStatus.bufferSize/1048576,this._stats.textureMemory.counter.value=e.memoryStatus.textureSize/1048576,this._stats.tricount.counter.value=e.numTris;var i=0,n=this.digitsData;for(var r in this._stats){var a=this._stats[r];a.counter.sample(t);for(var s=a.counter.human().toString(),o=7;o>=0;o--){var u=8*i+o,h=s[s.length-(8-o)],l=Cu[h];void 0===l&&(l=11),n[u]=l}i++}}}},t}()),Pu=t("N",new Nu);tt.profiler=Pu;var Mu=function(){var t=e.prototype;function e(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return t.main=function(t){if(null!=t){if(window._CCSettings&&window._CCSettings.splashScreen){var e=this.setting=window._CCSettings.splashScreen;e.totalTime=null!=this.setting.totalTime?this.setting.totalTime:3e3,e.base64src=this.setting.base64src||"",e.effect=this.setting.effect||"FADE-INOUT",e.clearColor=this.setting.clearColor||new si(.88,.88,.88,1),e.displayRatio=null!=this.setting.displayRatio?this.setting.displayRatio:.4,e.displayWatermark=null==this.setting.displayWatermark||this.setting.displayWatermark}else this.setting={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new si(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.setting.base64src||this.setting.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.setting=null,this._directCall=!0;else{tt.view.enableRetina(!0);var i=window._CCSettings.designResolution;i?tt.view.setDesignResolutionSize(i.width,i.height,i.policy):tt.view.setDesignResolutionSize(960,640,4),this.root=t,this.device=t.device,tt.game.once(tt.Game.EVENT_GAME_INITED,(function(){tt.director._lateUpdate=performance.now()}),tt.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1;var n=this.setting.clearColor;this.clearColors=[new si(n.x,n.y,n.z,n.w)];var r=this.device,a=r.width,s=r.height,o=r.surfaceTransform;this.screenWidth=o%2?s:a,this.screenHeight=o%2?a:s,this.image=new Image,this.image.onload=this.init.bind(this),this.image.src=this.setting.base64src}}else console.error("RENDER ROOT IS NULL.")},t.setOnFinish=function(t){if(this._directCall&&t)return e._ins=void 0,void t();this.callBack=t},t._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),tt.game.resume())},t.init=function(){var t=this;this.initCMD(),this.initIA(),this.initPSO(),this.setting.displayWatermark&&this.initText(),tt.game.pause(),this.handle=requestAnimationFrame((function e(i){if(!t.cancelAnimate){t.startTime<0&&(t.startTime=i);var n=i-t.startTime,r=Xa(A(n/t.setting.totalTime));"NONE"===t.setting.effect&&(r=1),t.material.setProperty("u_precent",r),t.material.passes[0].update(),t.setting.displayWatermark&&t.textMaterial&&(t.textMaterial.setProperty("u_precent",r),t.textMaterial.passes[0].update()),t.frame(i),n>t.setting.totalTime&&(t.splashFinish=!0),requestAnimationFrame(e)}}))},t.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},t.frame=function(){if(!this.cancelAnimate){var t=this.device;t.acquire();var e=this.cmdBuff,i=this.framebuffer,n=this.renderArea;e.begin(),e.beginRenderPass(i.renderPass,i,n,this.clearColors,1,0);var r=this.material.passes[0],a=oi.getOrCreatePipelineState(t,r,this.shader,i.renderPass,this.assmebler);if(e.bindPipelineState(a),e.bindDescriptorSet(ui.MATERIAL,r.descriptorSet),e.bindInputAssembler(this.assmebler),e.draw(this.assmebler),this.setting.displayWatermark&&this.textShader&&this.textAssmebler){var s=this.textMaterial.passes[0],o=oi.getOrCreatePipelineState(t,s,this.textShader,i.renderPass,this.textAssmebler);e.bindPipelineState(o),e.bindDescriptorSet(ui.MATERIAL,s.descriptorSet),e.bindInputAssembler(this.textAssmebler),e.draw(this.textAssmebler)}e.endRenderPass(),e.end(),t.queue.submit([e]),t.present()}},t.initText=function(){this.textImg=document.createElement("canvas"),this.textImg.width=330,this.textImg.height=30,this.textImg.style.width=""+this.textImg.width,this.textImg.style.height=""+this.textImg.height;var t=this.textImg.getContext("2d");t.font="18px Arial",t.textBaseline="top",t.textAlign="left",t.fillStyle="`#424242`";var e="Powered by Cocos Creator",i=t.measureText(e);t.fillText(e,(330-i.width)/2,6),this.textRegion=new Ae,this.textRegion.texExtent.width=this.textImg.width,this.textRegion.texExtent.height=this.textImg.height,this.textRegion.texExtent.depth=1,this.textTexture=this.device.createTexture(new ei(ii.TEX2D,ni.SAMPLED|ni.TRANSFER_DST,be.RGBA8,this.textImg.width,this.textImg.height)),this.device.copyTexImagesToTexture([this.textImg],this.textTexture,[this.textRegion]),this.textMaterial=new Te,this.textMaterial.initialize({effectName:"splash-screen"});var n=this.textMaterial.passes[0],r=n.getBinding("mainTexture");n.bindTexture(r,this.textTexture),this.textShader=hi.get(n.getShaderVariant()),li.get(ci.get(n.handle,fi.DESCRIPTOR_SET)).update();var a=4*Float32Array.BYTES_PER_ELEMENT,s=4*a;this.textVB=this.device.createBuffer(new pi(mi.VERTEX|mi.TRANSFER_DST,di.HOST|di.DEVICE,s,a));var o=new Float32Array(16),u=-this.textImg.width/2,h=this.textImg.height;h=this.screenWidth<this.screenHeight?(u=-this.screenWidth/2*.5)/(this.textImg.width/this.textImg.height):(u=-this.screenHeight/2*.5)/(this.textImg.width/this.textImg.height);var l=0;o[l++]=u,o[l++]=h,o[l++]=0,o[l++]=1,o[l++]=-u,o[l++]=h,o[l++]=1,o[l++]=1,o[l++]=u,o[l++]=-h,o[l++]=0,o[l++]=0,o[l++]=-u,o[l++]=-h,o[l++]=1,o[l++]=0;for(var c=0;c<o.length;c+=4)o[c]+=this.screenWidth/2,o[c+1]+=.1*this.screenHeight;for(var f=this.device.screenSpaceSignY,p=Ot[this.device.surfaceTransform],m=0;m<o.length;m+=4){var d=o[m]/this.screenWidth*2-1,_=(o[m+1]/this.screenHeight*2-1)*f;o[m]=p[0]*d+p[2]*_,o[m+1]=p[1]*d+p[3]*_}this.textVB.update(o);var g=Uint16Array.BYTES_PER_ELEMENT,v=6*g;this.textIB=this.device.createBuffer(new pi(mi.INDEX|mi.TRANSFER_DST,di.HOST|di.DEVICE,v,g));var y=new Uint16Array(6);y[0]=0,y[1]=1,y[2]=2,y[3]=1,y[4]=3,y[5]=2,this.textIB.update(y);var b=[new ve("a_position",be.RG32F),new ve("a_texCoord",be.RG32F)],w=new _i(b,[this.textVB],this.textIB);this.textAssmebler=this.device.createInputAssembler(w)},t.initCMD=function(){var t=this.device;this.renderArea=new gi(0,0,t.width,t.height),this.framebuffer=this.root.mainWindow.framebuffer,this.cmdBuff=t.commandBuffer},t.initIA=function(){var t=this.device,e=4*Float32Array.BYTES_PER_ELEMENT,i=4*e;this.vertexBuffers=t.createBuffer(new pi(mi.VERTEX|mi.TRANSFER_DST,di.HOST|di.DEVICE,i,e));var n=new Float32Array(16),r=-this.image.width/2,a=this.image.height;a=this.screenWidth<this.screenHeight?(r=-this.screenWidth/2*this.setting.displayRatio)/(this.image.width/this.image.height):(r=-this.screenHeight/2*this.setting.displayRatio)/(this.image.width/this.image.height);var s=0;n[s++]=r,n[s++]=a,n[s++]=0,n[s++]=1,n[s++]=-r,n[s++]=a,n[s++]=1,n[s++]=1,n[s++]=r,n[s++]=-a,n[s++]=0,n[s++]=0,n[s++]=-r,n[s++]=-a,n[s++]=1,n[s++]=0;for(var o=0;o<n.length;o+=4)n[o]+=this.screenWidth/2,n[o+1]+=this.screenHeight/2;for(var u=this.device.screenSpaceSignY,h=Ot[this.device.surfaceTransform],l=0;l<n.length;l+=4){var c=n[l]/this.screenWidth*2-1,f=(n[l+1]/this.screenHeight*2-1)*u;n[l]=h[0]*c+h[2]*f,n[l+1]=h[1]*c+h[3]*f}this.vertexBuffers.update(n);var p=Uint16Array.BYTES_PER_ELEMENT,m=6*p;this.indicesBuffers=t.createBuffer(new pi(mi.INDEX|mi.TRANSFER_DST,di.HOST|di.DEVICE,m,p));var d=new Uint16Array(6);d[0]=0,d[1]=1,d[2]=2,d[3]=1,d[4]=3,d[5]=2,this.indicesBuffers.update(d);var _=[new ve("a_position",be.RG32F),new ve("a_texCoord",be.RG32F)],g=new _i(_,[this.vertexBuffers],this.indicesBuffers);this.assmebler=t.createInputAssembler(g)},t.initPSO=function(){var t=this.device;this.material=new Te,this.material.initialize({effectName:"splash-screen"});var e=new vi;e.addressU=yi.CLAMP,e.addressV=yi.CLAMP,this.sampler=t.createSampler(e),this.texture=t.createTexture(new ei(ii.TEX2D,ni.SAMPLED|ni.TRANSFER_DST,be.RGBA8,this.image.width,this.image.height));var i=this.material.passes[0],n=i.getBinding("mainTexture");i.bindTexture(n,this.texture),this.shader=hi.get(i.getShaderVariant());var r=li.get(ci.get(i.handle,fi.DESCRIPTOR_SET));r.bindSampler(n,this.sampler),r.update(),this.region=new Ae,this.region.texExtent.width=this.image.width,this.region.texExtent.height=this.image.height,this.region.texExtent.depth=1,t.copyTexImagesToTexture([this.image],this.texture,[this.region])},t.destroy=function(){this.callBack=null,this.clearColors=null,this.device=null,this.image=null,this.framebuffer=null,this.renderArea=null,this.region=null,this.cmdBuff=null,this.shader=null,this.material.destroy(),this.material=null,this.texture.destroy(),this.texture=null,this.assmebler.destroy(),this.assmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler.destroy(),this.sampler=null,this.setting.displayWatermark&&this.textImg&&(this.textImg=null,this.textRegion=null,this.textShader=null,this.textMaterial.destroy(),this.textMaterial=null,this.textTexture.destroy(),this.textTexture=null,this.textAssmebler.destroy(),this.textAssmebler=null,this.textVB.destroy(),this.textVB=null,this.textIB.destroy(),this.textIB=null),this.setting=null,e._ins=void 0},ut(e,[{key:"splashFinish",set:function(t){this._splashFinish=t,this._tryToStart()}},{key:"loadFinish",set:function(t){this._loadFinish=t,this._tryToStart()}}],[{key:"instance",get:function(){return e._ins||(e._ins=new e),e._ins}}]),e}();Mu._ins=void 0,tt.internal.SplashScreen=Mu;var Ru={};wt(Ru,"vmath",[{name:"vec2",newName:"Vec2",target:Ci,targetName:"math"},{name:"vec3",newName:"Vec3",target:Ci,targetName:"math"},{name:"vec4",newName:"Vec4",target:Ci,targetName:"math"},{name:"quat",newName:"Quat",target:Ci,targetName:"math"},{name:"mat3",newName:"Mat3",target:Ci,targetName:"math"},{name:"mat4",newName:"Mat4",target:Ci,targetName:"math"},{name:"color4",newName:"Color",target:Ci,targetName:"math"},{name:"rect",newName:"Rect",target:Ci,targetName:"math"},{name:"approx",newName:"approx",target:Ci,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:Ci,targetName:"math"},{name:"equals",newName:"equals",target:Ci,targetName:"math"},{name:"clamp",newName:"clamp",target:Ci,targetName:"math"},{name:"clamp01",newName:"clamp01",target:Ci,targetName:"math"},{name:"lerp",newName:"lerp",target:Ci,targetName:"math"},{name:"toRadian",newName:"toRadian",target:Ci,targetName:"math"},{name:"toDegree",newName:"toDegree",target:Ci,targetName:"math"},{name:"random",newName:"random",target:Ci,targetName:"math"},{name:"randomRange",newName:"randomRange",target:Ci,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:Ci,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:Ci,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:Ci,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:Ci,targetName:"math"},{name:"repeat",newName:"repeat",target:Ci,targetName:"math"},{name:"pingPong",newName:"pingPong",target:Ci,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:Ci,targetName:"math"}]),tt.vmath=Ru,wt(xi.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:xi,targetName:"Scheduler"}]),wt(bi.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:bi,targetName:"EventTouch"}]),wt(wi.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),bt(wi.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),tt.math=Ci,tt.geometry=Ii}}}));
