System.register(["./deprecated-0768b3d4.js","./deprecated-4df5f565.js","./audio-downloader-f2f97571.js","./index-0614c00d.js","./deprecated-88eb2353.js","./screen-f991c158.js","./label-71612587.js","./ZipUtils-3ae2be0b.js"],(function(t){"use strict";var e,i,r,s,n,o,a,h,l,u,g,f,d,_,p,c,m,y,v,A,w,b,S,T,x,I,C,D,N,O,P,E,G,z,L,R,F,M,X,U,H,B,j,k,Y;return{setters:[function(t){e=t.S,i=t.W,r=t.aa,s=t.a6,n=t.a8,o=t.a,a=t.x,h=t.z,l=t.c,u=t.t,g=t.aH,f=t._,d=t.w,_=t.b,p=t.h,c=t.e,m=t.f,y=t.C,v=t.a3,A=t.V,w=t.aJ,b=t.aK,S=t.A,T=t.s,x=t.b5,I=t.Q,C=t.i,D=t.m,N=t.b6,O=t.bb},function(t){P=t.b_,E=t.dQ,G=t.eK,z=t.co,L=t.bN,R=t.e6,F=t.e4},function(){},function(){},function(t){M=t.Z,X=t.U,U=t.m,H=t.T},function(){},function(t){B=t.L,j=t.S},function(t){k=t.c,Y=t._}],execute:function(){var V,K,Z,W,q,J,Q;!function(t){t[t.ORTHO=0]="ORTHO",t[t.HEX=1]="HEX",t[t.ISO=2]="ISO"}(V||(V={})),e(V),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LAYER=2]="LAYER",t[t.OBJECTGROUP=3]="OBJECTGROUP",t[t.OBJECT=4]="OBJECT",t[t.TILE=5]="TILE"}(K||(K={})),e(K),function(t){t[t.HORIZONTAL=2147483648]="HORIZONTAL",t[t.VERTICAL=1073741824]="VERTICAL",t[t.DIAGONAL=536870912]="DIAGONAL",t[t.FLIPPED_ALL=4026531840]="FLIPPED_ALL",t[t.FLIPPED_MASK=268435455]="FLIPPED_MASK"}(Z||(Z={})),e(Z),function(t){t[t.STAGGERAXIS_X=0]="STAGGERAXIS_X",t[t.STAGGERAXIS_Y=1]="STAGGERAXIS_Y"}(W||(W={})),e(W),function(t){t[t.STAGGERINDEX_ODD=0]="STAGGERINDEX_ODD",t[t.STAGGERINDEX_EVEN=1]="STAGGERINDEX_EVEN"}(q||(q={})),e(q),function(t){t[t.RightDown=0]="RightDown",t[t.RightUp=1]="RightUp",t[t.LeftDown=2]="LeftDown",t[t.LeftUp=3]="LeftUp"}(J||(J={})),e(J),function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.POLYGON=2]="POLYGON",t[t.POLYLINE=3]="POLYLINE",t[t.IMAGE=4]="IMAGE",t[t.TEXT=5]="TEXT"}(Q||(Q={})),e(Q);var $=function(){function t(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=void 0,this.imageName=null,this.imageSize=new s(0,0),this.tileOffset=new i(0,0),this._tileSize=new s(0,0),this.collection=!1}return t.prototype.rectForGID=function(t,e){var i=e||new n(0,0,0,0);i.width=this._tileSize.width,i.height=this._tileSize.height;var r=t;r&=Z.FLIPPED_MASK,r-=this.firstGid;var s=Math.floor((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing));return i.x=Math.round(r%s*(this._tileSize.width+this.spacing)+this.margin),i.y=Math.round(Math.floor(r/s)*(this._tileSize.height+this.spacing)+this.margin),i},t}(),tt=function(){function t(){this.properties={},this.name="",this.objects=[],this.visible=!0,this.opacity=0,this.color=new r(255,255,255,255),this.offset=new i(0,0),this.draworder="topdown",this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}(),et=function(){function t(){this.properties={},this.name="",this.layerSize=null,this.tiles=[],this.visible=!0,this.opacity=0,this.ownTiles=!0,this.minGID=1e5,this.maxGID=0,this.offset=new i(0,0),this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}();et.ATTRIB_NONE=1,et.ATTRIB_BASE64=2,et.ATTRIB_GZIP=4,et.ATTRIB_ZLIB=8;var it=function(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=new i(0,0),this.opacity=0,this.trans=new r(255,255,255,255),this.sourceImage=void 0,this.tintColor=null};function rt(t){var e=B.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT}}function st(t){var e=B.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP}}function nt(t){if(!t)return new r(0,0,0,255);if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length){var e=parseInt(t.substr(0,2),16)||255,i=parseInt(t.substr(2,2),16)||0,s=parseInt(t.substr(4,2),16)||0,n=parseInt(t.substr(6,2),16)||0;return new r(i,s,n,e)}var o=parseInt(t.substr(0,2),16)||0,a=parseInt(t.substr(2,2),16)||0,h=parseInt(t.substr(4,2),16)||0;return new r(o,a,h,255)}function ot(t,e){for(var i=[],r=t.getElementsByTagName("properties"),s=0;s<r.length;++s)for(var n=r[s].getElementsByTagName("property"),o=0;o<n.length;++o)i.push(n[o]);e=e||{};for(var a=0;a<i.length;a++){var h=i[a],l=h.getAttribute("name"),u=h.getAttribute("type")||"string",g=h.getAttribute("value");"int"===u?g=parseInt(g):"float"===u?g=parseFloat(g):"bool"===u?g="true"===g:"color"===u&&(g=nt(g)),e[l]=g}return e}var at,ht,lt,ut,gt,ft,dt,_t,pt,ct,mt,yt,vt,At,wt=function(){function t(t,e,i,r,n){this.properties={},this.orientation=null,this.parentElement=null,this.parentGID=0,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=J.RightDown,this._supportVersion=[1,4,0],this._objectGroups=[],this._allChildren=[],this._mapSize=new s(0,0),this._tileSize=new s(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties=new Map,this._tileAnimations={},this._tsxContentMap=null,this._spriteFrameMap=null,this._spfSizeMap={},this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerSPF=null,this.initWithXML(t,e,i,r,n)}o(t,[{key:"mapSize",get:function(){return this._mapSize}},{key:"tileSize",get:function(){return this._tileSize}}]);var e=t.prototype;return e.getOrientation=function(){return this.orientation},e.setOrientation=function(t){this.orientation=t},e.getStaggerAxis=function(){return this._staggerAxis},e.setStaggerAxis=function(t){this._staggerAxis=t},e.getStaggerIndex=function(){return this._staggerIndex},e.setStaggerIndex=function(t){this._staggerIndex=t},e.getHexSideLength=function(){return this._hexSideLength},e.setHexSideLength=function(t){this._hexSideLength=t},e.getMapSize=function(){return new s(this._mapSize.width,this._mapSize.height)},e.setMapSize=function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},e.getTileSize=function(){return new s(this._tileSize.width,this._tileSize.height)},e.setTileSize=function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},e.getLayers=function(){return this._layers},e.setLayers=function(t){this._allChildren.push(t),this._layers.push(t)},e.getImageLayers=function(){return this._imageLayers},e.setImageLayers=function(t){this._allChildren.push(t),this._imageLayers.push(t)},e.getTilesets=function(){return this._tilesets},e.setTilesets=function(t){this._tilesets.push(t)},e.getObjectGroups=function(){return this._objectGroups},e.setObjectGroups=function(t){this._allChildren.push(t),this._objectGroups.push(t)},e.getAllChildren=function(){return this._allChildren},e.getParentElement=function(){return this.parentElement},e.setParentElement=function(t){this.parentElement=t},e.getParentGID=function(){return this.parentGID},e.setParentGID=function(t){this.parentGID=t},e.getLayerAttribs=function(){return this.layerAttrs},e.setLayerAttribs=function(t){this.layerAttrs=t},e.getStoringCharacters=function(){return this.storingCharacters},e.setStoringCharacters=function(t){this.storingCharacters=t},e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},e.initWithXML=function(t,e,i,r,s){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxContentMap=e,this._spriteFrameMap=i,this._imageLayerSPF=s,this._spfSizeMap=r,this._objectGroups.length=0,this._allChildren.length=0,this.properties={},this._tileProperties=new Map,this._tileAnimations=new Map,this.currentString="",this.storingCharacters=!1,this.layerAttrs=et.ATTRIB_NONE,this.parentElement=null,this.parseXMLString(t)},e.parseXMLString=function(e,i){var r,n=(new M).parse(e).documentElement,o=n.getAttribute("orientation"),l=n.getAttribute("staggeraxis"),u=n.getAttribute("staggerindex"),g=n.getAttribute("hexsidelength"),f=n.getAttribute("renderorder"),d=n.getAttribute("version")||"1.0.0";if("map"===n.nodeName){var _=d.split("."),p=this._supportVersion;for(r=0;r<p.length;r++){var c=parseInt(_[r])||0;if(p[r]<c){a(7216,d);break}}"orthogonal"===o?this.orientation=V.ORTHO:"isometric"===o?this.orientation=V.ISO:"hexagonal"===o?this.orientation=V.HEX:null!==o&&a(7217,o),this.renderOrder="right-up"===f?J.RightUp:"left-up"===f?J.LeftUp:"left-down"===f?J.LeftDown:J.RightDown,"x"===l?this.setStaggerAxis(W.STAGGERAXIS_X):"y"===l&&this.setStaggerAxis(W.STAGGERAXIS_Y),"odd"===u?this.setStaggerIndex(q.STAGGERINDEX_ODD):"even"===u&&this.setStaggerIndex(q.STAGGERINDEX_EVEN),g&&this.setHexSideLength(parseFloat(g));var m=new s(0,0);m.width=parseFloat(n.getAttribute("width")),m.height=parseFloat(n.getAttribute("height")),this.setMapSize(m),(m=new s(0,0)).width=parseFloat(n.getAttribute("tilewidth")),m.height=parseFloat(n.getAttribute("tileheight")),this.setTileSize(m),this.properties=ot(n)}var y=n.getElementsByTagName("tileset");for("map"!==n.nodeName&&(y=[]).push(n),r=0;r<y.length;r++){var v=y[r],A=v.getAttribute("source");if(A){var w=parseInt(v.getAttribute("firstgid")),b=this._tsxContentMap[A];b&&this.parseXMLString(b,w)}else{var S=v.getElementsByTagName("image"),T=S.length>1,x=S[0],I=x.getAttribute("source");I=I.replace(/\\/g,"/");var C=v.getElementsByTagName("tile"),D=C&&C.length||1,N=null,O=v.getAttribute("name")||"",P=parseInt(v.getAttribute("spacing"))||0,E=parseInt(v.getAttribute("margin"))||0,G=i||parseInt(v.getAttribute("firstgid"))||0,z=new s(0,0);z.width=parseFloat(v.getAttribute("tilewidth")),z.height=parseFloat(v.getAttribute("tileheight"));var L=v.getElementsByTagName("tileoffset")[0],R=0,F=0;L&&(R=parseFloat(L.getAttribute("x"))||0,F=parseFloat(L.getAttribute("y"))||0);for(var X=null,U=0;U<D;U++){if(!X||T){if((X=new $).name=O,X.firstGid=G&Z.FLIPPED_MASK,X.tileOffset.x=R,X.tileOffset.y=F,X.collection=T,!T&&(X.imageName=I,X.imageSize.width=parseFloat(x.getAttribute("width"))||0,X.imageSize.height=parseFloat(x.getAttribute("height"))||0,X.sourceImage=this._spriteFrameMap[I],!X.sourceImage)){var H=t.getShortName(I);X.imageName=H,X.sourceImage=this._spriteFrameMap[H],X.sourceImage||(console.error("[error]: "+H+" not find in ["+Object.keys(this._spriteFrameMap).join(", ")+"]"),h(7221,I),console.warn("Please try asset type of "+I+" to 'sprite-frame'"))}X.spacing=P,X.margin=E,X._tileSize.width=z.width,X._tileSize.height=z.height,this.setTilesets(X)}if(N=C&&C[U]){this.parentGID=G+(parseInt(N.getAttribute("id"))||0);var B=N.getElementsByTagName("image");if(B&&B.length>0){var j=B[0],k=j.getAttribute("source");if(k=k.replace(/\\/g,"/"),X.imageName=k,X.imageSize.width=parseFloat(j.getAttribute("width"))||0,X.imageSize.height=parseFloat(j.getAttribute("height"))||0,X._tileSize.width=X.imageSize.width,X._tileSize.height=X.imageSize.height,X.sourceImage=this._spriteFrameMap[k],!X.sourceImage){var Y=t.getShortName(k);X.imageName=Y,X.sourceImage=this._spriteFrameMap[Y],X.sourceImage||(h(7221,k),console.warn("Please try asset type of "+k+" to 'sprite-frame'"))}X.firstGid=this.parentGID&Z.FLIPPED_MASK}var K=(Z.FLIPPED_MASK&this.parentGID)>>>0;this._tileProperties.set(K,ot(N));var Q=N.getElementsByTagName("animation");if(Q&&Q.length>0){var tt=Q[0].getElementsByTagName("frame"),et={frames:[],dt:0,frameIdx:0};this._tileAnimations.set(K,et);for(var it=et.frames,rt=0;rt<tt.length;rt++){var st=tt[rt],nt=G+(parseInt(st.getAttribute("tileid"))||0),at=parseFloat(st.getAttribute("duration"))||0;it.push({tileid:nt,duration:at/1e3,grid:null})}}}}}}var ht=n.childNodes;for(r=0;r<ht.length;r++){var lt=ht[r];if(!this._shouldIgnoreNode(lt)){if("imagelayer"===lt.nodeName){var ut=this._parseImageLayer(lt);ut&&this.setImageLayers(ut)}if("layer"===lt.nodeName){var gt=this._parseLayer(lt);this.setLayers(gt)}if("objectgroup"===lt.nodeName){var ft=this._parseObjectGroup(lt);this.setObjectGroups(ft)}}}return n},e._shouldIgnoreNode=function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},e._parseImageLayer=function(t){var e=t.getElementsByTagName("image");if(!e||0===e.length)return null;var i=new it;i.name=t.getAttribute("name"),i.offset.x=parseFloat(t.getAttribute("offsetx"))||0,i.offset.y=parseFloat(t.getAttribute("offsety"))||0;var r=t.getAttribute("visible");i.visible=!("0"===r);var s=t.getAttribute("opacity");i.opacity=s?Math.round(255*parseFloat(s)):255;var n=t.getAttribute("tintcolor");i.tintColor=n?nt(n):null;var o=e[0],a=o.getAttribute("source");return i.sourceImage=this._imageLayerSPF[a],i.width=parseInt(o.getAttribute("width"))||0,i.height=parseInt(o.getAttribute("height"))||0,i.trans=nt(o.getAttribute("trans")),i.sourceImage?i:(h(7221,a),console.warn("Please try asset type of "+a+" to 'sprite-frame'"),null)},e._parseLayer=function(t){var e=t.getElementsByTagName("data")[0],r=new et;r.name=t.getAttribute("name");var n=new s(0,0);n.width=parseFloat(t.getAttribute("width")),n.height=parseFloat(t.getAttribute("height")),r.layerSize=n;var o=t.getAttribute("visible");r.visible=!("0"===o);var h=t.getAttribute("opacity");r.opacity=h?Math.round(255*parseFloat(h)):255,r.offset=new i(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0);var l=t.getAttribute("tintcolor");r.tintColor=l?nt(l):null;for(var u="",g=0;g<e.childNodes.length;g++)u+=e.childNodes[g].nodeValue;u=u.trim();var f,d=e.getAttribute("compression"),_=e.getAttribute("encoding");if(d&&"gzip"!==d&&"zlib"!==d)return a(7218),null;switch(d){case"gzip":f=k.unzipBase64AsArray(u,4);break;case"zlib":f=function(t){if(t.length%4!=0)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],r=0;r<e;r++){var s=4*r;i[r]=t[s]+256*t[s+1]+65536*t[s+2]+t[s+3]*(1<<24)}return i}(new Y.Inflate(k.Base64.decodeAsArray(u,1)).decompress());break;case null:case"":if("base64"===_)f=k.Base64.decodeAsArray(u,4);else if("csv"===_){f=[];for(var p=u.split(","),c=0;c<p.length;c++)f.push(parseInt(p[c]))}else{var m=e.getElementsByTagName("tile");f=[];for(var y=0;y<m.length;y++)f.push(parseInt(m[y].getAttribute("gid")))}break;default:this.layerAttrs===et.ATTRIB_NONE&&a(7219)}return f&&(r.tiles=new Uint32Array(f)),r.properties=ot(t),r},e._parseObjectGroup=function(t){var e=new tt;e.name=t.getAttribute("name")||"",e.offset=new i(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));var r=t.getAttribute("opacity");e.opacity=r?Math.round(255*parseFloat(r)):255;var s=t.getAttribute("tintcolor");e.tintColor=s?nt(s):null;var n=t.getAttribute("visible");n&&0===parseInt(n)&&(e.visible=!1);var o=t.getAttribute("color");o&&e.color.fromHEX(o);var a=t.getAttribute("draworder");a&&(e.draworder=a),e.setProperties(ot(t));var h=t.getElementsByTagName("object");if(h){for(var l=0;l<h.length;l++){var u=h[l],g={};g.id=u.getAttribute("id")||l,g.name=u.getAttribute("name")||"",g.width=parseFloat(u.getAttribute("width"))||0,g.height=parseFloat(u.getAttribute("height"))||0,g.x=parseFloat(u.getAttribute("x"))||0,g.y=parseFloat(u.getAttribute("y"))||0,g.rotation=parseFloat(u.getAttribute("rotation"))||0,ot(u,g);var f=u.getAttribute("visible");g.visible=!(f&&0===parseInt(f));var d=u.getElementsByTagName("text");if(d&&d.length>0){var _=d[0];g.type=Q.TEXT,g.wrap="1"===_.getAttribute("wrap"),g.color=nt(_.getAttribute("color")),g.halign=rt(_.getAttribute("halign")),g.valign=st(_.getAttribute("valign")),g.pixelsize=parseInt(_.getAttribute("pixelsize"))||16,g.text=_.childNodes[0].nodeValue}var p=u.getAttribute("gid");p&&(g.gid=parseInt(p),g.type=Q.IMAGE);var c=u.getElementsByTagName("ellipse");c&&c.length>0&&(g.type=Q.ELLIPSE);var m=u.getElementsByTagName("polygon");if(m&&m.length>0){g.type=Q.POLYGON;var y=m[0].getAttribute("points");y&&(g.points=this._parsePointsString(y))}var v=u.getElementsByTagName("polyline");if(v&&v.length>0){g.type=Q.POLYLINE;var A=v[0].getAttribute("points");A&&(g.polylinePoints=this._parsePointsString(A))}g.type||(g.type=Q.RECT),e.objects.push(g)}"index"!==a&&e.objects.sort((function(t,e){return t.y-e.y}))}return e},e._parsePointsString=function(t){if(!t)return null;for(var e=[],i=t.split(" "),r=0;r<i.length;r++){var s=i[r].split(",");e.push({x:parseFloat(s[0]),y:parseFloat(s[1])})}return e},e.setTileAnimations=function(t){this._tileAnimations=t},e.getTileAnimations=function(){return this._tileAnimations},e.getTileProperties=function(){return this._tileProperties},e.setTileProperties=function(t){this._tileProperties=t},e.getCurrentString=function(){return this.currentString},e.setCurrentString=function(t){this.currentString=t},t.getShortName=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,i=t.lastIndexOf(".");return i=i<0?t.length:i,t.substring(e,i)},o(t,[{key:"mapWidth",get:function(){return this._mapSize.width},set:function(t){this._mapSize.width=t}},{key:"mapHeight",get:function(){return this._mapSize.height},set:function(t){this._mapSize.height=t}},{key:"tileWidth",get:function(){return this._tileSize.width},set:function(t){this._tileSize.width=t}},{key:"tileHeight",get:function(){return this._tileSize.height},set:function(t){this._tileSize.height=t}}]),t}(),bt=t("TiledTile",(at=l("cc.TiledTile"),ht=p(),lt=u(g),ut=u(g),gt=u(g),ft=u(g),dt=u(g),at(_t=ht((yt=function(t){function e(){var e;return(e=t.call(this)||this)._layer=null,c(e,"_x",ct,m(e)),c(e,"_y",mt,m(e)),e}f(e,t);var i=e.prototype;return i.onEnable=function(){var t=this.node.parent;this._layer=t.getComponent("cc.TiledLayer"),this._resetTile(),this.updateInfo()},i.onDisable=function(){this._resetTile()},i._resetTile=function(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null)},i.updateInfo=function(){if(this._layer){var t=this._x,e=this._y;if(this._layer.getTiledTileAt(t,e))d("There is already a TiledTile at [%s, %s]",t,e);else{var i=this._layer.getPositionAt(t,e);this.node.setPosition(i.x,i.y),this._layer.setTiledTileAt(t,e,this)}}},o(e,[{key:"x",get:function(){return this._x},set:function(t){t!==this._x&&(this._layer&&this._layer.isInvalidPosition(t,this._y)?d("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.width):(this._resetTile(),this._x=t,this.updateInfo()))}},{key:"y",get:function(){return this._y},set:function(t){t!==this._y&&(this._layer&&this._layer.isInvalidPosition(this._x,t)?d("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.height):(this._resetTile(),this._y=t,this.updateInfo()))}},{key:"grid",get:function(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0},set:function(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y)}}]),e}(y),ct=_((pt=yt).prototype,"_x",[lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mt=_(pt.prototype,"_y",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_(pt.prototype,"x",[gt],Object.getOwnPropertyDescriptor(pt.prototype,"x"),pt.prototype),_(pt.prototype,"y",[ft],Object.getOwnPropertyDescriptor(pt.prototype,"y"),pt.prototype),_(pt.prototype,"grid",[dt],Object.getOwnPropertyDescriptor(pt.prototype,"grid"),pt.prototype),_t=pt))||_t)||_t));function St(t,e,i){var r=i||t.sourceImage,s=r.texture,o=t.collection;if(!t.imageSize.width||!t.imageSize.height){var a=t.sourceImage;t.imageSize.width=a.width,t.imageSize.height=a.height}var h=t.imageSize.width,l=t.imageSize.height,u=t._tileSize.width,g=t._tileSize.height,f=r.width,d=r.height,_=t.spacing,p=t.margin,c=1;if(!o){var m=Math.floor((h-2*p+_)/(u+_)),y=Math.floor((l-2*p+_)/(g+_));c=Math.max(1,y*m)}for(var v=t.firstGid,A=null,w=!!e.get(v),b=t.firstGid+c,S=v;S<b&&(w&&!e.get(S)&&(w=!1),w||!e.get(S));++S){if(A={tileset:t,x:0,y:0,width:u,height:g,t:0,l:0,r:0,b:0,cx:0,cy:0,offsetX:0,offsetY:0,rotated:!1,gid:S,spriteFrame:r,texture:s},t.rectForGID(S,A),!i||c>1)if(i){A._name=i.name;var T=i.unbiasUV[0],x=i.rotated?i.unbiasUV[1]:i.unbiasUV[5];A.l=T+(A.x+.5)/f,A.t=x+(A.y+.5)/d,A.r=T+(A.x+A.width-.5)/f,A.b=x+(A.y+A.height-.5)/d,A._rect=new n(A.x,A.y,A.width,A.height)}else A.l=A.x/f,A.t=A.y/d,A.r=(A.x+A.width)/f,A.b=(A.y+A.height)/d,A._rect=new n(A.x,A.y,A.width,A.height);else i.rotated?(A._rotated=!0,A._name=i.name,A._rect=i.getRect(),A.l=i.unbiasUV[0],A.t=i.unbiasUV[1],A.r=i.unbiasUV[4],A.b=i.unbiasUV[3]):(A._name=i.name,A._rect=i.getRect(),A.l=i.unbiasUV[0],A.t=i.unbiasUV[5],A.r=i.unbiasUV[2],A.b=i.unbiasUV[1]);A.cx=(A.l+A.r)/2,A.cy=(A.t+A.b)/2,e.set(S,A)}}function Tt(t,e){var i=t.length;if(0!==i)for(var r=0,s=function(){++r>=i&&e()},n=0;n<i;n++){var o=t[n];o.loaded?s():o.once("load",(function(){s()}))}else e()}for(var xt,It,Ct,Dt,Nt,Ot,Pt,Et,Gt,zt,Lt,Rt,Ft,Mt,Xt,Ut,Ht,Bt,jt,kt,Yt,Vt,Kt,Zt,Wt,qt,Jt,Qt,$t,te,ee,ie,re,se,ne,oe,ae,he,le,ue,ge=new v,fe=new i,de=new A,_e=new A,pe={row:0,col:0},ce=t("TiledUserNodeData",l("cc.TiledUserNodeData")(vt=function(t){function e(){var e;return(e=t.call(this)||this)._index=-1,e._row=-1,e._col=-1,e._tiledLayer=null,e}return f(e,t),e}(y))||vt),me=t("TiledLayer",l("cc.TiledLayer")(At=function(t){function e(){var e;return(e=t.call(this)||this)._userNodeGrid={},e._userNodeMap={},e._userNodeDirty=!1,e.tiledTiles=[],e._viewPort={x:-1,y:-1,width:-1,height:-1},e._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},e._cullingDirty=!0,e._rightTop={row:-1,col:-1},e._layerInfo=null,e._mapInfo=null,e._topOffset=0,e._downOffset=0,e._leftOffset=0,e._rightOffset=0,e.tiles=[],e.vertices=[],e._verticesDirty=!0,e._layerName="",e._layerSize=void 0,e._minGID=void 0,e._maxGID=void 0,e._layerOrientation=null,e._opacity=void 0,e._tintColor=void 0,e.texGrids=null,e._textures=[],e._tilesets=[],e._leftDownToCenterX=0,e._leftDownToCenterY=0,e._hasTiledNodeGrid=!1,e._hasAniGrid=!1,e._animations=null,e._enableCulling=void 0,e.colorChanged=!1,e._properties=void 0,e.renderOrder=void 0,e._staggerAxis=void 0,e._staggerIndex=void 0,e._hexSideLength=void 0,e._mapTileSize=void 0,e._odd_even=void 0,e._diffX1=void 0,e._diffY1=void 0,e._useAutomaticVertexZ=void 0,e._vertexZvalue=void 0,e._offset=void 0,e._meshRenderDataArray=null,e._meshRenderDataArrayIdx=0,e}f(e,t),o(e,[{key:"cullingRect",get:function(){return this._cullingRect}},{key:"rightTop",get:function(){return this._rightTop}},{key:"layerSize",get:function(){return this._layerSize}},{key:"meshRenderDataArray",get:function(){return this._meshRenderDataArray}},{key:"leftDownToCenterX",get:function(){return this._leftDownToCenterX}},{key:"leftDownToCenterY",get:function(){return this._leftDownToCenterY}}]);var r=e.prototype;return r.hasTiledNode=function(){return this._hasTiledNodeGrid},r.hasAnimation=function(){return this._hasAniGrid},r.addUserNode=function(t){var e=t.getComponent(ce);return e?(d("CCTiledLayer:addUserNode node has been added"),!1):(e=t.addComponent(ce),t.parent=this.node,this._userNodeMap[t.uuid]=e,e._row=-1,e._col=-1,e._tiledLayer=this,this._nodeLocalPosToLayerPos(t.getPosition(),fe),this._positionToRowCol(fe.x,fe.y,pe),this._addUserNodeToGrid(e,pe),this._updateCullingOffsetByUserNode(t),t.on(P.TRANSFORM_CHANGED,this._userNodePosChange,e),t.on(P.SIZE_CHANGED,this._userNodeSizeChange,e),!0)},r.removeUserNode=function(t){var e=t.getComponent(ce);return e?(t.off(P.TRANSFORM_CHANGED,this._userNodePosChange,e),t.off(P.SIZE_CHANGED,this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t.uuid],t._removeComponent(e),e.destroy(),t.removeFromParent(),!0):(d("CCTiledLayer:removeUserNode node is not exist"),!1)},r.destroyUserNode=function(t){this.removeUserNode(t),t.destroy()},r._nodeLocalPosToLayerPos=function(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY},r.getNodesByRowCol=function(t,e){var i=this._userNodeGrid[t];return i?i[e]:null},r.getNodesCountByRow=function(t){var e=this._userNodeGrid[t];return e?e.count:0},r._updateAllUserNode=function(){for(var t in this._userNodeGrid={},this._userNodeMap){var e=this._userNodeMap[t];this._nodeLocalPosToLayerPos(e.node.getPosition(),fe),this._positionToRowCol(fe.x,fe.y,pe),this._addUserNodeToGrid(e,pe),this._updateCullingOffsetByUserNode(e.node)}},r._updateCullingOffsetByUserNode=function(t){var e=t._uiProps.uiTransformComp.contentSize;this._topOffset<e.height&&(this._topOffset=e.height),this._downOffset<e.height&&(this._downOffset=e.height),this._leftOffset<e.width&&(this._leftOffset=e.width),this._rightOffset<e.width&&(this._rightOffset=e.width)},r._userNodeSizeChange=function(){var t=this.node,e=this._tiledLayer;e._updateCullingOffsetByUserNode(t),e._userNodeDirty=!0,e.markForUpdateRenderData()},r._userNodePosChange=function(){var t=this.node,e=this._tiledLayer;e._nodeLocalPosToLayerPos(t.getPosition(),fe),e._positionToRowCol(fe.x,fe.y,pe),e._limitInLayer(pe),pe.row===this._row&&pe.col===this._col||(e._removeUserNodeFromGrid(this),e._addUserNodeToGrid(this,pe))},r._removeUserNodeFromGrid=function(t){var e=t._row,i=t._col,r=t._index,s=this._userNodeGrid[e],n=s&&s[i];n&&(s.count--,n.count--,n.list[r]=null,n.count<=0&&(n.list.length=0,n.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0,this.markForUpdateRenderData()},r._limitInLayer=function(t){var e=t.row,i=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),i<0&&(t.col=0),i>this._rightTop.col&&(t.col=this._rightTop.col)},r._addUserNodeToGrid=function(t,e){var i=e.row,r=e.col,s=this._userNodeGrid[i]=this._userNodeGrid[i]||{count:0},n=s[r]=s[r]||{count:0,list:[]};t._row=i,t._col=r,t._index=n.list.length,s.count++,n.count++,n.list.push(t),this._userNodeDirty=!0},r.isUserNodeDirty=function(){return this._userNodeDirty},r.setUserNodeDirty=function(t){this._userNodeDirty=t},r.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(P.ANCHOR_CHANGED,this._syncAnchorPoint,this),this.node.on(P.TRANSFORM_CHANGED,this.updateCulling,this),this.node.on(P.SIZE_CHANGED,this.updateCulling,this),this.node.parent.on(P.TRANSFORM_CHANGED,this.updateCulling,this),this.node.parent.on(P.SIZE_CHANGED,this.updateCulling,this),this.markForUpdateRenderData()},r.onDisable=function(){t.prototype.onDisable.call(this),this.node.parent.off(P.SIZE_CHANGED,this.updateCulling,this),this.node.parent.off(P.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(P.SIZE_CHANGED,this.updateCulling,this),this.node.off(P.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(P.ANCHOR_CHANGED,this._syncAnchorPoint,this)},r._syncAnchorPoint=function(){var t=this.node,e=t._uiProps.uiTransformComp,i=t.getScale();this._leftDownToCenterX=e.width*e.anchorX*i.x,this._leftDownToCenterY=e.height*e.anchorY*i.y,this._cullingDirty=!0,this.markForUpdateRenderData()},r.onDestroy=function(){t.prototype.onDestroy.call(this)},r.getLayerName=function(){return this._layerName},r.setLayerName=function(t){this._layerName=t},r.getProperty=function(t){return this._properties[t]},r.getPositionAt=function(t,e){var i;switch(void 0!==e?(i=Math.floor(t),e=Math.floor(e)):(i=Math.floor(t.x),e=Math.floor(t.y)),this._layerOrientation){case V.ORTHO:return this._positionForOrthoAt(i,e);case V.ISO:return this._positionForIsoAt(i,e);case V.HEX:return this._positionForHexAt(i,e)}return null},r.isInvalidPosition=function(t,e){return t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0},r._positionForIsoAt=function(t,e){var r=0,s=0,n=Math.floor(t)+Math.floor(e)*this._layerSize.width,o=this.tiles[n];if(o){var a=(o&Z.FLIPPED_MASK)>>>0,h=this.texGrids.get(a).tileset.tileOffset;r=h.x,s=h.y}return new i(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+r,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-s)},r._positionForOrthoAt=function(t,e){var r=0,s=0,n=Math.floor(t)+Math.floor(e)*this._layerSize.width,o=this.tiles[n];if(o){var a=(o&Z.FLIPPED_MASK)>>>0,h=this.texGrids.get(a).tileset.tileOffset;r=h.x,s=h.y}return new i(t*this._mapTileSize.width+r,(this._layerSize.height-e-1)*this._mapTileSize.height-s)},r._positionForHexAt=function(t,e){var r,s=this._mapTileSize.width,n=this._mapTileSize.height,o=this._layerSize.height,a=Math.floor(t)+Math.floor(e)*this._layerSize.width,h=(this.tiles[a]&Z.FLIPPED_MASK)>>>0;r=this.texGrids.get(h)?this.texGrids.get(h).tileset.tileOffset:{x:0,y:0};var l=this._staggerIndex===q.STAGGERINDEX_ODD?1:-1,u=0,g=0,f=0,d=0;switch(this._staggerAxis){case W.STAGGERAXIS_Y:f=0,e%2==1&&(f=s/2*l),u=t*s+f+r.x,g=(o-e-1)*(n-(n-this._hexSideLength)/2)-r.y;break;case W.STAGGERAXIS_X:d=0,t%2==1&&(d=n/2*-l),u=t*(s-(s-this._hexSideLength)/2)+r.x,g=(o-e-1)*n+d-r.y}return new i(u,g)},r.setTilesGIDAt=function(t,e,i,r){if(t&&0!==t.length&&!(r<=0)){i<0&&(i=0),e<0&&(e=0);for(var s=0,n=e+r,o=i;;o++)for(var a=e;a<n;a++){if(s>=t.length)return;this._updateTileForGID(t[s],a,o),s++}}},r.setTileGIDAt=function(t,e,i,r){var s=(t&Z.FLIPPED_MASK)>>>0;if(e=Math.floor(e),i=Math.floor(i),this.isInvalidPosition(e,i))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this.tiles&&this._tilesets&&0!==this._tilesets.length?0!==s&&s<this._tilesets[0].firstGid?a(7239,t):(r=r||0,this._updateTileForGID((s|r)>>>0,e,i)):a(7238)},r._updateTileForGID=function(t,e,i){var r=0|e+i*this._layerSize.width;if(!(r>=this.tiles.length)&&t!==this.tiles[r]){var s=(t&Z.FLIPPED_MASK)>>>0;this.texGrids.get(s)?(this.tiles[r]=t,this._updateVertex(e,i)):this.tiles[r]=0,this._cullingDirty=!0}},r.getTileGIDAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this.tiles)return a(7237),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[i]&Z.FLIPPED_MASK)>>>0},r.getTileFlagsAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this.tiles)return a(7240),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[i]&Z.FLIPPED_ALL)>>>0},r.setCullingDirty=function(t){this._cullingDirty=t},r.isCullingDirty=function(){return this._cullingDirty},r.updateViewPort=function(t,e,i,r){if(this._viewPort.width!==i||this._viewPort.height!==r||this._viewPort.x!==t||this._viewPort.y!==e){this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=i,this._viewPort.height=r;var s=1;this._layerOrientation===V.ISO&&(s=2);var n=this._viewPort.x-this._offset.x+this._leftDownToCenterX,o=this._viewPort.y-this._offset.y+this._leftDownToCenterY,a=n-this._leftOffset,h=o-this._downOffset,l=n+i+this._rightOffset,u=o+r+this._topOffset,g=this._cullingRect.leftDown,f=this._cullingRect.rightTop;a<0&&(a=0),h<0&&(h=0),this._positionToRowCol(a,h,pe),pe.row-=s,pe.col-=s,pe.row=pe.row>0?pe.row:0,pe.col=pe.col>0?pe.col:0,pe.row===g.row&&pe.col===g.col||(g.row=pe.row,g.col=pe.col,this._cullingDirty=!0),l<0||u<0?(pe.row=-1,pe.col=-1):(this._positionToRowCol(l,u,pe),pe.row++,pe.col++),pe.row>this._rightTop.row&&(pe.row=this._rightTop.row),pe.col>this._rightTop.col&&(pe.col=this._rightTop.col),pe.row===f.row&&pe.col===f.col||(f.row=pe.row,f.col=pe.col,this._cullingDirty=!0,this.markForUpdateRenderData())}},r._positionToRowCol=function(t,e,i){var r=this._mapTileSize.width,s=this._mapTileSize.height,n=.5*r,o=.5*s,a=0,h=0,l=0,u=0,g=this._staggerAxis;switch(this._layerOrientation){case V.ORTHO:h=Math.floor(t/r),a=Math.floor(e/s);break;case V.ISO:h=Math.floor(t/n),a=Math.floor(e/o);break;case V.HEX:g===W.STAGGERAXIS_Y?(l=(a=Math.floor(e/(s-this._diffY1)))%2==1?n*this._odd_even:0,h=Math.floor((t-l)/r)):(u=(h=Math.floor(t/(r-this._diffX1)))%2==1?o*-this._odd_even:0,a=Math.floor((e-u)/s))}return i.row=a,i.col=h,i},r.updateCulling=function(){if(this._enableCulling){this.node.updateWorldTransform(),v.invert(ge,this.node.getWorldMatrix());var t=this.node._uiProps.uiTransformComp._canvas.camera;t&&(de.x=0,de.y=0,de.z=0,_e.x=t.width,_e.y=t.height,_e.z=0,t.screenToWorld(de,de),t.screenToWorld(_e,_e),i.transformMat4(de,de,ge),i.transformMat4(_e,_e,ge),this.updateViewPort(de.x,de.y,_e.x-de.x,_e.y-de.y))}},r.getLayerOrientation=function(){return this._layerOrientation},r.getProperties=function(){return this._properties},r._updateVertex=function(t,e){var i=Z.FLIPPED_MASK,r=this.vertices,s=this._layerOrientation,n=this.tiles;if(n){var o,a,h,l,u=this._rightTop,g=this._mapTileSize.width,f=this._mapTileSize.height,d=.5*g,_=.5*f,p=this._layerSize.height,c=this._layerSize.width,m=this.texGrids,y=0,v=0;s===V.HEX&&(o=this._staggerAxis,a=this._diffX1,h=this._diffY1,l=this._odd_even);var A,w,b,S=0,T=0,x=0,I=0,C=e*c+t;A=(n[C]&i)>>>0;var D=m.get(A);if(D){switch(this._animations.get(A)&&(this._hasAniGrid=this._hasAniGrid||!0),s){case V.ORTHO:y=(S=t)*g,v=(T=p-e-1)*f;break;case V.ISO:y=d*(S=p+t-e-1),v=_*(T=p+c-t-e-2);break;case V.HEX:y=t*(g-a)+(o===W.STAGGERAXIS_Y&&e%2==1?d*l:0),v=(p-e-1)*(f-h)+(o===W.STAGGERAXIS_X&&t%2==1?_*-l:0),S=t,T=p-e-1}var N=r[T]=r[T]||{minCol:0,maxCol:0},O=N[S]=N[S]||{};N.minCol>S&&(N.minCol=S),N.maxCol<S&&(N.maxCol=S),u.row<T&&(u.row=T),u.col<S&&(u.col=S);var P=D.tileset.tileOffset;y+=this._offset.x+P.x+D.offsetX,v+=this._offset.y-P.y-D.offsetY,x=(x=-P.y+D.tileset._tileSize.height-f)<0?0:x,w=P.y<0?0:P.y,b=-P.x<0?0:-P.x,I=(I=P.x+D.tileset._tileSize.width-g)<0?0:I,this._rightOffset<b&&(this._rightOffset=b),this._leftOffset<I&&(this._leftOffset=I),this._topOffset<w&&(this._topOffset=w),this._downOffset<x&&(this._downOffset=x),O.left=y,O.bottom=v,O.index=C,this._cullingDirty=!0}}},r._updateVertices=function(){if(this.vertices.length=0,this.tiles){var t=this._rightTop;t.row=-1,t.col=-1;var e=this._layerSize.height,i=this._layerSize.width;this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1;for(var r=0;r<e;++r)for(var s=0;s<i;++s)this._updateVertex(s,r);this._verticesDirty=!1}},r.getTiledTileAt=function(t,e,i){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this.tiles)return a(7236),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width,s=this.tiledTiles[r];if(!s&&i){var n=new E;return(s=n.addComponent(bt))._x=t,s._y=e,s._layer=this,s.updateInfo(),n.parent=this.node,s}return s},r.setTiledTileAt=function(t,e,i){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this.tiles)return a(7236),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this.tiledTiles[r]=i,this._cullingDirty=!0,this._hasTiledNodeGrid=!!i||this.tiledTiles.some((function(t){return!!t})),i},r.getTexture=function(t){return t=t||0,this._textures&&t>=0&&this._textures.length>t?this._textures[t]:null},r.getTextures=function(){return this._textures},r.setTexture=function(t){this.setTextures([t])},r.setTextures=function(t){this._textures=t,this.markForUpdateRenderData()},r.getLayerSize=function(){return this._layerSize},r.getMapTileSize=function(){return this._mapTileSize},r.getTileSet=function(t){return t=t||0,this._tilesets&&t>=0&&this._tilesets.length>t?this._tilesets[t]:null},r.getTileSets=function(){return this._tilesets},r.setTileSet=function(t){this.setTileSets([t])},r.setTileSets=function(t){var e=this;this._tilesets=t;var i=this._textures=[],r=this.texGrids;r.clear();for(var s=0;s<t.length;s++){var n=t[s];n&&(i[s]=n.sourceImage)}Tt(i,(function(){for(var i=0,s=t.length;i<s;++i){var n=t[i];n&&St(n,r,n.sourceImage)}e._prepareToRender()}))},r.init=function(t,e,r,s,n){this._cullingDirty=!0,this._layerInfo=t,this._mapInfo=e;var o=t.layerSize;this._layerName=t.name,this.tiles=t.tiles,this._properties=t.properties,this._layerSize=o,this._minGID=t.minGID,this._maxGID=t.maxGID,this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this.renderOrder=e.renderOrder,this._staggerAxis=e.getStaggerAxis(),this._staggerIndex=e.getStaggerIndex(),this._hexSideLength=e.getHexSideLength(),this._animations=e.getTileAnimations(),this._tilesets=r,this._textures=s,this.texGrids=n,this._layerOrientation=e.orientation,this._mapTileSize=e.getTileSize();var a=this._mapTileSize.width,h=this._mapTileSize.height,l=this._layerSize.width,u=this._layerSize.height;if(this._layerOrientation===V.HEX){var g=0,f=0;this._odd_even=this._staggerIndex===q.STAGGERINDEX_ODD?1:-1,this._staggerAxis===W.STAGGERAXIS_X?(this._diffX1=(a-this._hexSideLength)/2,this._diffY1=0,f=h*(u+.5),g=(a+this._hexSideLength)*Math.floor(l/2)+a*(l%2)):(this._diffX1=0,this._diffY1=(h-this._hexSideLength)/2,g=a*(l+.5),f=(h+this._hexSideLength)*Math.floor(u/2)+h*(u%2)),this.node._uiProps.uiTransformComp.setContentSize(g,f)}else if(this._layerOrientation===V.ISO){var d=l+u;this.node._uiProps.uiTransformComp.setContentSize(.5*a*d,.5*h*d)}else this.node._uiProps.uiTransformComp.setContentSize(l*a,u*h);this._offset=new i(t.offset.x,-t.offset.y),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._syncAnchorPoint(),this._prepareToRender()},r._prepareToRender=function(){this._updateVertices(),this._updateAllUserNode()},r.requestMeshRenderData=function(){var t=this;this._meshRenderDataArray||(this._meshRenderDataArray=[]);for(var e=this._meshRenderDataArray;e.length>0&&e[e.length-1].subNodes&&0===e[e.length-1].subNodes.length;)e.pop();if(e.length>0){var i=e[e.length-1];if(i.renderData&&0===i.renderData.byteCount)return i}var r=new G,s={renderData:r,texture:null};return Object.defineProperty(r,"material",{get:function(){return t.getRenderMaterial(0)}}),this._meshRenderDataArray.push(s),s},r.requestSubNodesData=function(){this._meshRenderDataArray||(this._meshRenderDataArray=[]);for(var t=this._meshRenderDataArray;t.length>0&&t[t.length-1].renderData&&0===t[t.length-1].renderData.byteCount;)t.pop();if(t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length)return t[t.length-1];var e={subNodes:[]};return this._meshRenderDataArray.push(e),e},r.destroyRenderData=function(){this._meshRenderDataArray&&(this._meshRenderDataArray.forEach((function(t){t.renderData&&t.renderData.reset()})),this._meshRenderDataArray.length=0)},r._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._meshRenderDataArray||this._assembler&&this._assembler.createData&&(this._assembler.createData(this),this.markForUpdateRenderData(),this._updateColor())},r._render=function(t){if(this._meshRenderDataArray){for(var e=0;e<this._meshRenderDataArray.length;e++){this._meshRenderDataArrayIdx=e;var i=this._meshRenderDataArray[e];i.subNodes?i.subNodes.forEach((function(e){e&&t.walk(e.node)})):i.texture&&t.commitComp(this,i.texture,this._assembler,null)}this.node._static=!0}},o(e,[{key:"enableCulling",set:function(t){this._enableCulling!==t&&(this._enableCulling=t,this._cullingDirty=!0)},get:function(){return this._enableCulling}}]),e}(X))||At),ye=t("TiledObjectGroup",(xt=l("cc.TiledObjectGroup"),It=p(),Ct=R(F),Dt=u(w),xt(Nt=It(Nt=Ct((Pt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))||this)._premultiplyAlpha=!1,e._groupName=void 0,e._positionOffset=void 0,e._mapInfo=void 0,e._properties=void 0,e._offset=void 0,e._opacity=void 0,e._tintColor=null,e._animations=void 0,e._hasAniObj=void 0,e._texGrids=void 0,e.aniObjects=void 0,e._objects=[],e}f(e,t);var s=e.prototype;return s.getPositionOffset=function(){return this._positionOffset},s.getProperties=function(){return this._properties},s.getGroupName=function(){return this._groupName},s.getProperty=function(t){return this._properties[t.toString()]},s.getObject=function(t){for(var e=0,i=this._objects.length;e<i;e++){var r=this._objects[e];if(r&&r.name===t)return r}return null},s.getObjects=function(){return this._objects},s._init=function(t,e,s){var n=Z.FLIPPED_MASK,o=Z.HORIZONTAL,a=Z.VERTICAL;this._groupName=t.name,this._positionOffset=t.offset,this._mapInfo=e,this._properties=t.getProperties(),this._offset=new i(t.offset.x,-t.offset.y),this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this._texGrids=s,this._animations=e.getTileAnimations(),this.aniObjects=[],this._hasAniObj=!1;var h=e.mapSize,l=e.tileSize,u=0,g=0,f=new r,d=V.ISO===e.orientation;if(e.orientation===V.HEX)e.getStaggerAxis()===W.STAGGERAXIS_X?(g=l.height*(h.height+.5),u=(l.width+e.getHexSideLength())*Math.floor(h.width/2)+l.width*(h.width%2)):(u=l.width*(h.width+.5),g=(l.height+e.getHexSideLength())*Math.floor(h.height/2)+l.height*(h.height%2));else if(d){var _=h.width+h.height;u=.5*l.width*_,g=.5*l.height*_}else u=h.width*l.width,g=h.height*l.height;var p=this.node._uiProps.uiTransformComp;p.setContentSize(u,g);for(var c=u*p.anchorX,m=g*(1-p.anchorY),y=t.objects,v={},A=0,w=y.length;A<w;A++){var b=y[A],S=b.type;b.offset=new i(b.x,b.y);var T=b.points||b.polylinePoints;if(T)for(var x=0;x<T.length;x++)T[x].y*=-1;if(d){var I=b.x/l.height,C=b.y/l.height;b.x=.5*l.width*(h.height+I-C),b.y=.5*l.height*(h.width+h.height-I-C)}else b.y=g-b.y;if(S===Q.TEXT){var D="text"+b.id;v[D]=!0;var N=this.node.getChildByName(D);N||(N=new E),N.setRotationFromEuler(0,0,-b.rotation),N.setPosition(b.x-c,b.y-m),N.name=D,N.parent=this.node,N.setSiblingIndex(A);var O=N.getComponent(B);O||(O=N.addComponent(B));var P=N._uiProps.uiTransformComp;N.active=b.visible,P.anchorX=0,P.anchorY=1,this._tintColor?(f.set(this._tintColor),f.a*=this._opacity/255,O.color.set(f)):O.color.a*=this._opacity/255,O.overflow=B.Overflow.SHRINK,O.lineHeight=b.height,O.string=b.text,O.horizontalAlign=b.halign,O.verticalAlign=b.valign,O.fontSize=b.pixelsize,P.setContentSize(b.width,b.height)}else if(S===Q.IMAGE){var G=b.gid,R=(G&n)>>>0,F=s.get(R);if(!F)continue;var M=F.tileset,X="img"+b.id;v[X]=!0;var H=this.node.getChildByName(X);b.width=b.width||F.width,b.height=b.height||F.height,H instanceof U&&(H.removeFromParent(),H.destroy(),H=null),H||(H=new E),this._animations.get(R)&&(this.aniObjects.push({object:b,imgNode:H,gridGID:R}),this._hasAniObj=!0);var k=M.tileOffset.x,Y=M.tileOffset.y;H.active=b.visible,H.setRotationFromEuler(0,0,-b.rotation),H.setPosition(b.x-c,b.y-m),H.name=X,H.parent=this.node,H.setSiblingIndex(A);var K=H.getComponent(j);K||(K=H.addComponent(j));var q=H._uiProps.uiTransformComp;d?(q.anchorX=.5+k/b.width,q.anchorY=Y/b.height):(q.anchorX=k/b.width,q.anchorY=Y/b.height),this._tintColor?(f.set(this._tintColor),f.a*=this._opacity/255,K.color.set(f)):K.color.a*=this._opacity/255,K.sizeMode=j.SizeMode.CUSTOM,K.srcBlendFactor=this._premultiplyAlpha?z.ONE:z.SRC_ALPHA,K.dstBlendFactor=z.ONE_MINUS_SRC_ALPHA,K._updateBlendFunc();var J=F.spriteFrame;J=J?J.clone():new L,(G&o)>>>0&&(J.flipUVX=!J.flipUVX),(G&a)>>>0&&(J.flipUVY=!J.flipUVY),J.rotated=F._rotated,J.rect=F._rect,K.spriteFrame=J,q.setContentSize(b.width,b.height),K.markForUpdateRenderData()}}this._objects=y;for(var $=this.node.children,tt=/^(?:img|text)\d+$/,et=0,it=$.length;et<it;et++){var rt=$[et],st=rt.name;tt.test(st)&&!v[st]&&rt.destroy()}},s.update=function(){if(this._hasAniObj)for(var t=this.aniObjects,e=this._texGrids,i=V.ISO===this._mapInfo.orientation,r=0,s=t.length;r<s;r++){var n=t[r],o=n.gridGID,a=e.get(o);if(a){var h=a.tileset,l=n.object,u=n.imgNode,g=h.tileOffset.x,f=h.tileOffset.y,d=u._uiProps.uiTransformComp;i?(d.anchorX=.5+g/l.width,d.anchorY=f/l.height):(d.anchorX=g/l.width,d.anchorY=f/l.height);var _=u.getComponent(j),p=_.spriteFrame;p.rotated=a._rotated,p.rect=a._rect,_.spriteFrame=p,_.markForUpdateRenderData()}}},o(e,[{key:"premultiplyAlpha",get:function(){return this._premultiplyAlpha},set:function(t){this._premultiplyAlpha=t}},{key:"offset",get:function(){return this._offset}}]),e}(y),_((Ot=Pt).prototype,"premultiplyAlpha",[Dt],Object.getOwnPropertyDescriptor(Ot.prototype,"premultiplyAlpha"),Ot.prototype),Nt=Ot))||Nt)||Nt)||Nt)),ve=t("TiledMapAsset",(Et=l("cc.TiledMapAsset"),Gt=u([H]),zt=u([b]),Lt=u([L]),Rt=u([L]),Ft=u([b]),Mt=u([b]),Xt=u([s]),Et((Jt=qt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,c(e,"tmxXmlStr",Bt,m(e)),c(e,"tsxFiles",jt,m(e)),c(e,"tsxFileNames",kt,m(e)),c(e,"spriteFrames",Yt,m(e)),c(e,"imageLayerSpriteFrame",Vt,m(e)),c(e,"imageLayerSpriteFrameNames",Kt,m(e)),c(e,"spriteFrameNames",Zt,m(e)),c(e,"spriteFrameSizes",Wt,m(e)),e}return f(e,t),e}(S),qt.preventDeferredLoadDependents=!0,Bt=_((Ht=Jt).prototype,"tmxXmlStr",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),jt=_(Ht.prototype,"tsxFiles",[T,Gt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kt=_(Ht.prototype,"tsxFileNames",[T,zt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yt=_(Ht.prototype,"spriteFrames",[T,Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vt=_(Ht.prototype,"imageLayerSpriteFrame",[T,Rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Kt=_(Ht.prototype,"imageLayerSpriteFrameNames",[T,Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Zt=_(Ht.prototype,"spriteFrameNames",[T,Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wt=_(Ht.prototype,"spriteFrameSizes",[T,Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ut=Ht))||Ut)),Ae=(t("TiledMap",(Qt=l("cc.TiledMap"),$t=p(),te=D(),ee=R(F),ie=u(ve),re=N(),Qt(se=$t(se=te(se=ee(se=x((ue=le=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._texGrids=new Map,e._textures=[],e._tilesets=[],e._animations=new Map,e._imageLayers=[],e._layers=[],e._groups=[],e._images=[],e._properties={},e._tileProperties=new Map,e._mapInfo=null,e._mapSize=new s(0,0),e._tileSize=new s(0,0),e._preloaded=!1,e._mapOrientation=V.ORTHO,c(e,"_tmxFile",oe,m(e)),c(e,"_enableCulling",ae,m(e)),c(e,"cleanupImageCache",he,m(e)),e}f(e,t);var r=e.prototype;return r.getMapSize=function(){return this._mapSize},r.getTileSize=function(){return this._tileSize},r.getMapOrientation=function(){return this._mapOrientation},r.getObjectGroups=function(){return this._groups},r.getObjectGroup=function(t){for(var e=this._groups,i=0,r=e.length;i<r;i++){var s=e[i];if(s&&s.getGroupName()===t)return s}return null},r.getProperties=function(){return this._properties},r.getLayers=function(){return this._layers},r.getLayer=function(t){for(var e=this._layers,i=0,r=e.length;i<r;i++){var s=e[i];if(s&&s.getLayerName()===t)return s}return null},r._changeLayer=function(t,e){for(var i=this._layers,r=0,s=i.length;r<s;r++){var n=i[r];if(n&&n.getLayerName()===t)return void(i[r]=e)}},r.getProperty=function(t){return this._properties[t.toString()]},r.getPropertiesForGID=function(t){return this._tileProperties.get(t)},r.__preload=function(){this._preloaded=!0,this._tmxFile&&this._applyFile()},r.onEnable=function(){this.node.on(P.ANCHOR_CHANGED,this._syncAnchorPoint,this)},r.onDisable=function(){this.node.off(P.ANCHOR_CHANGED,this._syncAnchorPoint,this)},r._applyFile=function(){var t=[],e={},i=this._tmxFile;if(i){for(var r=i.spriteFrameNames,s=i.spriteFrameSizes,n=i.spriteFrames,o={},h={},l=0;l<r.length;++l){var u=r[l];h[u]=s[l],t[l]=n[l];var g=t[l];g&&(e[g.name]=g,o[u]=g)}var f={},d=i.imageLayerSpriteFrame;r=i.imageLayerSpriteFrameNames;for(var _=0;_<d.length;++_)f[r[_]]=d[_];for(var p=i.tsxFileNames,c=i.tsxFiles,m={},y=0;y<p.length;++y)p[y].length>0&&(m[p[y]]=c[y].text);var v=new wt(i.tmxXmlStr,m,o,h,f),A=v.getTilesets();A&&0!==A.length||a(7241),this._buildWithMapInfo(v)}else this._releaseMapInfo()},r._releaseMapInfo=function(){for(var t=this._layers,e=0,i=t.length;e<i;e++)t[e].node.removeFromParent(),t[e].node.destroy();t.length=0;for(var r=this._groups,s=0,n=r.length;s<n;s++)r[s].node.removeFromParent(),r[s].node.destroy();r.length=0;for(var o=this._images,a=0,h=o.length;a<h;a++)o[a].removeFromParent(),o[a].destroy();o.length=0},r._syncAnchorPoint=function(){var t,e,i=this.node._uiProps.uiTransformComp.anchorPoint,r=this.node._uiProps.uiTransformComp.width*i.x,s=this.node._uiProps.uiTransformComp.height*(1-i.y);for(t=0,e=this._layers.length;t<e;t++)this._layers[t].node._uiProps.uiTransformComp.setAnchorPoint(i);for(t=0,e=this._groups.length;t<e;t++){var n=this._groups[t],o=n.node._uiProps.uiTransformComp;o.anchorX=.5,o.anchorY=.5;var a=n.offset.x-r+o.width*o.anchorX,h=n.offset.y+s-o.height*o.anchorY;n.node.setPosition(a,h)}for(t=0,e=this._images.length;t<e;t++){var l=this._images[t]._uiProps.uiTransformComp;l.anchorX=.5,l.anchorY=.5;var u=this._images[t]._offset.x-r+l.width*l.anchorX,g=this._images[t]._offset.y+s-l.height*l.anchorY;this._images[t].setPosition(u,g)}},r._fillAniGrids=function(t,e){for(var i,r=I(e.keys());!(i=r()).done;){var s=i.value,n=e.get(s);if(n)for(var o=n.frames,a=0;a<o.length;a++){var h=o[a];h.grid=t.get(h.tileid)}}},r._buildLayerAndGroup=function(){var t=this._tilesets,e=this._texGrids,r=this._animations;e.clear();for(var s=0,n=t.length;s<n;++s){var o=t[s];o&&(o.sourceImage?St(o,e,o.sourceImage):console.warn("Can't find the spriteFrame of tilesets "+s))}this._fillAniGrids(e,r);for(var a=this._layers,h=this._groups,l=this._images,u={},g=0,f=a.length;g<f;g++)u[a[g].node.name]=!0;for(var d=0,_=h.length;d<_;d++)u[h[d].node.name]=!0;for(var p=0,c=l.length;p<c;p++)u[l[p].name]=!0;a=this._layers=[],h=this._groups=[],l=this._images=[];var m=this._mapInfo,y=this.node,v=m.getAllChildren(),A=this._textures,w=0,b=0;if(v&&v.length>0)for(var S=0,T=v.length;S<T;S++){var x=v[S],I=x.name,C=this.node.getChildByName(I);if(u[I]=!1,C||((C=new E).name=I,y.addChild(C)),C.setSiblingIndex(S),C.active=x.visible,x instanceof et){var D=C.getComponent(me);D||(D=C.addComponent(me)),D.init(x,m,t,A,e),D.enableCulling=this._enableCulling,x.ownTiles=!1,a.push(D)}else if(x instanceof tt){var N=C.getComponent(ye);N||(N=C.addComponent(ye)),N._init(x,m,e),h.push(N)}else if(x instanceof it){var O=x.sourceImage;C.layerInfo=x,C._offset=new i(x.offset.x,-x.offset.y);var P=C.getComponent(j);P||(P=C.addComponent(j)),P.color.a*=x.opacity,P.spriteFrame=O,C._uiProps.uiTransformComp.setContentSize(O.width,O.height),l.push(C)}w=Math.max(w,C._uiProps.uiTransformComp.width),b=Math.max(b,C._uiProps.uiTransformComp.height)}for(var G=y.children,z=0,L=G.length;z<L;z++){var R=G[z];u[R.name]&&R.destroy()}this.node._uiProps.uiTransformComp.setContentSize(w,b),this._syncAnchorPoint()},r._buildWithMapInfo=function(t){this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();var e=this._tilesets;this._textures.length=0;for(var i=[],r=0,s=e.length;r<s;++r){var n=e[r];n&&n.sourceImage&&(this._textures[r]=n.sourceImage,i.push(n.sourceImage))}for(var o=0;o<this._imageLayers.length;o++){var a=this._imageLayers[o];a&&a.sourceImage&&i.push(a.sourceImage)}var h=this;Tt(i,(function(){if(h._buildLayerAndGroup(),h.cleanupImageCache){var t=h;h._textures.forEach((function(e){t.doCleanupImageCache(e)}))}}))},r.doCleanupImageCache=function(t){t._image instanceof HTMLImageElement?t._image.src="":C.capabilities.imageBitmap&&t._image instanceof ImageBitmap&&t._image.close&&t._image.close(),t._image=null},r.update=function(t){for(var e,i=this._animations,r=this._texGrids,s=I(i.keys());!(e=s()).done;){var n=e.value,o=i.get(n),a=o.frames,h=a[o.frameIdx];o.dt+=t,h.duration<o.dt&&(o.dt=0,o.frameIdx++,o.frameIdx>=a.length&&(o.frameIdx=0),h=a[o.frameIdx]),r.set(n,h.grid)}},o(e,[{key:"tmxAsset",get:function(){return this._tmxFile},set:function(t){(this._tmxFile!==t||O)&&(this._tmxFile=t,(this._preloaded||O)&&this._applyFile())}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling=t;for(var e=this._layers,i=0;i<e.length;++i)e[i].enableCulling=t}}]),e}(y),le.Orientation=V,le.Property=K,le.TileFlag=Z,le.StaggerAxis=W,le.StaggerIndex=q,le.TMXObjectType=Q,le.RenderOrder=J,oe=_((ne=ue).prototype,"_tmxFile",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(ne.prototype,"tmxAsset",[ie,re],Object.getOwnPropertyDescriptor(ne.prototype,"tmxAsset"),ne.prototype),ae=_(ne.prototype,"_enableCulling",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),he=_(ne.prototype,"cleanupImageCache",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),se=ne))||se)||se)||se)||se)||se)),Math.ceil(10922.5)),we=[],be=0;be<4;be++)we.push(new A);var Se,Te,xe=new v,Ie=new A,Ce={row:0,col:0},De={x:0,y:0},Ne={x:0,y:0},Oe={x:0,y:0},Pe={x:0,y:0},Ee=0,Ge=0,ze=0,Le=0,Re={createData:function(t){var e=t.requestMeshRenderData();return t.rightTop.col*t.rightTop.row*4>65535&&console.error("Vertex count exceeds 65535"),e},updateRenderData:function(t){t.updateCulling();var e=t.meshRenderDataArray[0];if(ze=t.leftDownToCenterX,Le=t.leftDownToCenterY,Se=e,t.colorChanged||t.isCullingDirty()||t.isUserNodeDirty()||t.hasAnimation()||t.hasTiledNode()){var i,r;if(t.colorChanged=!1,t.destroyRenderData(),t.enableCulling){var s=t.cullingRect;i=s.leftDown,r=s.rightTop}else i=Ce,r=t.rightTop;switch(t.renderOrder){case J.RightDown:Xe(i,r,-1,1,t);break;case J.LeftDown:Xe(i,r,-1,-1,t);break;case J.RightUp:Xe(i,r,1,1,t);break;case J.LeftUp:default:Xe(i,r,1,-1,t)}t.setCullingDirty(!1),t.setUserNodeDirty(!1)}Se=null},updateColor:function(t){var e=t.color,i=new Float32Array(4);i[0]=e.r/255,i[1]=e.g/255,i[2]=e.b/255,i[0]=e.a/255;var r=t.meshRenderDataArray;if(r)for(var s,n=I(r);!(s=n()).done;){var o=s.value;if(o.renderData)for(var a=o.renderData,h=a.vData,l=a.vertexStart,u=a.vertexCount;l<u;l++)h.set(i,9*l+5)}},fillBuffers:function(t,e){if(t&&t.meshRenderDataArray){var i=t.meshRenderDataArray,r=t.node,s=e.acquireBufferBatch(),n=s.byteOffset>>2,o=s.indicesOffset,a=s.vertexOffset,h=i[t._meshRenderDataArrayIdx].renderData;s.request(h.vertexCount,h.indicesCount)||(s=e.currBufferBatch,n=0,o=0,a=0);var l=s.vData,u=s.iData,g=r.worldMatrix,f=h.vData,d=h.vertexStart;l.set(f.slice(d,d+9*h.vertexCount),n);for(var _=0;_<h.vertexCount;_++){var p=n+9*_;Ie.set(l[p],l[p+1],l[p+2]),Ie.transformMat4(g),l[p]=Ie.x,l[p+1]=Ie.y,l[p+2]=Ie.z}for(var c=h.vertexCount/4,m=0;m<c;m+=1)u[o]=a,u[o+1]=a+1,u[o+2]=a+2,u[o+3]=a+2,u[o+4]=a+1,u[o+5]=a+3,o+=6,a+=4}}};function Fe(t,e){var i;t._rotated?(De.x=t.r,De.y=t.t,Ne.x=t.l,Ne.y=t.t,Oe.x=t.r,Oe.y=t.b,Pe.x=t.l,Pe.y=t.b):(De.x=t.l,De.y=t.t,Ne.x=t.l,Ne.y=t.b,Oe.x=t.r,Oe.y=t.t,Pe.x=t.r,Pe.y=t.b),(e&Z.DIAGONAL)>>>0&&(i=Ne,Ne=Oe,Oe=i),(e&Z.HORIZONTAL)>>>0&&(i=De,De=Oe,Oe=i,i=Ne,Ne=Pe,Pe=i),(e&Z.VERTICAL)>>>0&&(i=De,De=Ne,Ne=i,i=Oe,Oe=Pe,Pe=i)}function Me(t,e,i){t||(t=e.texture),Se.texture||(Se.texture=t),(Se=i.requestMeshRenderData()).texture=e.texture}function Xe(t,e,i,r,s){if(!(e.row<0||e.col<0)){Se.renderData||(Se=s.requestMeshRenderData());var n=Se.renderData.vData;Ee=0,Ge=0;var o,a,h,l,u,g,f,d,_,p=s.tiledTiles,c=s.texGrids,m=s.tiles,y=s.vertices,v=0,A=0,w=0,b=0,S=0,T=null,x=0,I=!0;Te=Fe;var C=new Float32Array(4);for(C[0]=s.color.r/255,C[1]=s.color.g/255,C[2]=s.color.b/255,C[3]=s.color.a/255,-1===i?(l=e.row,u=t.row):(l=t.row,u=e.row);(u-l)*i>=0;l+=i)for(o=y[l],x=s.getNodesCountByRow(l),I=o&&0===x,1===r?(a=I&&t.col<o.minCol?o.minCol:t.col,h=I&&e.col>o.maxCol?o.maxCol:e.col):(a=I&&e.col>o.maxCol?o.maxCol:e.col,h=I&&t.col<o.minCol?o.minCol:t.col);(h-a)*r>=0;a+=r){if(g=o&&o[a],x>0){var D=s.requestSubNodesData(),N=s.getNodesByRowCol(l,a);N&&N.count>0&&(D.subNodes=s.getNodesByRowCol(l,a).list,T=null,Se=s.requestMeshRenderData())}g&&(v=m[g.index],(d=c.get((v&Z.FLIPPED_MASK)>>>0))&&(T!==d.texture&&(Me(T,d,s),T=d.texture),f=d.tileset._tileSize,A=g.left-ze,w=g.bottom-Le,b=A+f.width,S=w+f.height,_=p[g.index],Se.renderData.reserve(4,0),Ge=9*Se.renderData.vertexCount,n=Se.renderData.vData,_?Ue(_.node,C,n,A,b,S,w,!1):(n[Ge]=A,n[Ge+1]=S,n[Ge+9]=A,n[Ge+9+1]=w,n[Ge+18]=b,n[Ge+18+1]=S,n[Ge+27]=b,n[Ge+27+1]=w,n.set(C,Ge+5),n.set(C,Ge+9+5),n.set(C,Ge+18+5),n.set(C,Ge+27+5)),Te(d,v),n[Ge+3]=De.x,n[Ge+4]=De.y,n[Ge+9+3]=Ne.x,n[Ge+9+4]=Ne.y,n[Ge+18+3]=Oe.x,n[Ge+18+4]=Oe.y,n[Ge+27+3]=Pe.x,n[Ge+27+4]=Pe.y,Ee++,Se.renderData.advance(4,6),Ee>=Ae&&(Me(T,d,s),T=d.texture)))}}}function Ue(t,e,i,r,s,n,o,a){t.updateWorldTransform(),v.copy(xe,t.matrix),A.set(Ie,-(r+ze),-(o+Le),0),v.transform(xe,xe,Ie);var h=xe,l=h.m12,u=h.m13,g=h.m00,f=h.m01,d=h.m04,_=h.m05,p=1===g&&0===f&&0===d&&1===_;if(a){var c=(r+s)/2,m=(n+o)/2;p?(i[Ge]=c+l,i[Ge+1]=n+u,i[Ge+9]=r+l,i[Ge+9+1]=m+u,i[Ge+18]=s+l,i[Ge+18+1]=m+u,i[Ge+27]=c+l,i[Ge+27+1]=o+u):(i[Ge]=c*g+n*d+l,i[Ge+1]=c*f+n*_+u,i[Ge+9]=r*g+m*d+l,i[Ge+9+1]=r*f+m*_+u,i[Ge+18]=s*g+m*d+l,i[Ge+18+1]=s*f+m*_+u,i[Ge+27]=c*g+o*d+l,i[Ge+27+1]=c*f+o*_+u)}else p?(i[Ge]=r+l,i[Ge+1]=n+u,i[Ge+9]=r+l,i[Ge+9+1]=o+u,i[Ge+18]=s+l,i[Ge+18+1]=n+u,i[Ge+27]=s+l,i[Ge+27+1]=o+u):(i[Ge]=r*g+n*d+l,i[Ge+1]=r*f+n*_+u,i[Ge+9]=r*g+o*d+l,i[Ge+9+1]=r*f+o*_+u,i[Ge+18]=s*g+n*d+l,i[Ge+18+1]=s*f+n*_+u,i[Ge+27]=s*g+o*d+l,i[Ge+27+1]=s*f+o*_+u);i.set(e,Ge+5),i.set(e,Ge+9+5),i.set(e,Ge+18+5),i.set(e,Ge+27+5)}var He=t("tiledLayerAssembler",{getAssembler:function(){return Re}});me.Assembler=He}}}));
