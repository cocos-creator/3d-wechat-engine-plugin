System.register(["./deprecated-0768b3d4.js","./deprecated-4df5f565.js","./audio-downloader-f2f97571.js","./index-0614c00d.js","./deprecated-88eb2353.js","./screen-f991c158.js","./collision-matrix-a4920c2a.js","./index-96a0e053.js","./terrain-asset-62469b77.js","./array-collision-matrix-ec6af177.js","./util-9bc6a395.js"],(function(){"use strict";var e,i,t,o,r,s,n,l,a,d,h,c,u,p,f;return{setters:[function(n){e=n.a3,i=n.V,t=n.a0,o=n._,r=n.a,s=n.aC},function(e){n=e.ef,l=e.el,a=e.ej,d=e.em},function(){},function(){},function(){},function(){},function(e){h=e.c},function(e){c=e.P,u=e.s},function(){},function(e){p=e.A},function(e){f=e.m}],execute:function(){var y=function(){function e(){this.collisionFilterGroup=c.PhysicsGroup.DEFAULT,this.collisionFilterMask=-1}var i=e.prototype;return i.getGroup=function(){return this.collisionFilterGroup},i.setGroup=function(e){this.collisionFilterGroup=e},i.addGroup=function(e){this.collisionFilterGroup|=e},i.removeGroup=function(e){this.collisionFilterGroup&=~e},i.getMask=function(){return this.collisionFilterMask},i.setMask=function(e){this.collisionFilterMask=e},i.addMask=function(e){this.collisionFilterMask|=e},i.removeMask=function(e){this.collisionFilterMask&=~e},e}(),g=new e,_=new i,v=new i,B=new t,w=function(e){function i(t,o){var r;return(r=e.call(this)||this)._id=void 0,r.index=-1,r.ref=0,r.node=void 0,r.world=void 0,r.shapes=[],r.wrappedBody=null,r._id=i.idCounter++,r.node=t,r.world=o,r}o(i,e),i.getSharedBody=function(e,t,o){var r,s=e.uuid;if(i.sharedBodesMap.has(s)?r=i.sharedBodesMap.get(s):(r=new i(e,t),i.sharedBodesMap.set(e.uuid,r)),o){r.wrappedBody=o;var n=o.rigidBody.group,l=c.instance.collisionMatrix[n];r.collisionFilterGroup=n,r.collisionFilterMask=l}return r},r(i,[{key:"id",get:function(){return this._id}},{key:"enabled",set:function(e){e?this.index<0&&(this.index=this.world.bodies.length,this.world.addSharedBody(this),this.syncInitial()):this.index>=0&&0==this.shapes.length&&(this.index=-1,this.world.removeSharedBody(this))}},{key:"reference",set:function(e){e?this.ref++:this.ref--,0==this.ref&&this.destroy()}}]);var t=i.prototype;return t.intersects=function(e){for(var i=0;i<this.shapes.length;i++)for(var t=this.shapes[i],o=0;o<e.shapes.length;o++){var r=e.shapes[o];(t.collider.needTriggerEvent||r.collider.needTriggerEvent)&&n.resolve(t.worldShape,r.worldShape)&&(this.world.shapeArr.push(t),this.world.shapeArr.push(r))}},t.addShape=function(e){this.shapes.indexOf(e)<0&&this.shapes.push(e)},t.removeShape=function(e){var i=this.shapes.indexOf(e);i>=0&&this.shapes.splice(i,1)},t.syncSceneToPhysics=function(){if(this.node.hasChangedFlags){this.node.getWorldMatrix(g),_.set(this.node.worldPosition),B.set(this.node.worldRotation),v.set(this.node.worldScale);for(var e=0;e<this.shapes.length;e++)this.shapes[e].transform(g,_,B,v)}},t.syncInitial=function(){this.node.getWorldMatrix(g),_.set(this.node.worldPosition),B.set(this.node.worldRotation),v.set(this.node.worldScale);for(var e=0;e<this.shapes.length;e++)this.shapes[e].transform(g,_,B,v)},t.destroy=function(){i.sharedBodesMap.delete(this.node.uuid),this.node=null,this.world=null,this.shapes=null},i}(y);w.sharedBodesMap=new Map,w.idCounter=0;var S=new i,k={type:"onTriggerEnter",selfCollider:null,otherCollider:null,impl:{}},M=function(){function e(){this.shapeArr=[],this.bodies=[],this._shapeArrPrev=[],this._collisionMatrix=new p,this._collisionMatrixPrev=new p}var t=e.prototype;return t.setGravity=function(){},t.setAllowSleep=function(){},t.setDefaultMaterial=function(){},t.step=function(){var e=this._shapeArrPrev;this._shapeArrPrev=this.shapeArr,this.shapeArr=e,this.shapeArr.length=0;for(var i=0;i<this.bodies.length;i++)for(var t=this.bodies[i],o=i+1;o<this.bodies.length;o++){var r=this.bodies[o];0!=(t.collisionFilterGroup&r.collisionFilterMask)&&0!=(r.collisionFilterGroup&t.collisionFilterMask)&&t.intersects(r)}},t.syncSceneToPhysics=function(){for(var e=0;e<this.bodies.length;e++)this.bodies[e].syncSceneToPhysics()},t.emitEvents=function(){this.emitTriggerEvent()},t.raycastClosest=function(e,t,o){for(var r=1/0,s=t.maxDistance,l=t.mask,a=0;a<this.bodies.length;a++){var d=this.bodies[a];if(d.collisionFilterGroup&l)for(var h=0;h<d.shapes.length;h++){var c=d.shapes[h],u=n.resolve(e,c.worldShape);0==u||u>s||r>u&&(r=u,i.normalize(S,e.d),i.scaleAndAdd(S,e.o,S,u),o._assign(S,u,c.collider,i.ZERO))}}return!(r==1/0)},t.raycast=function(e,t,o,r){for(var s=t.maxDistance,l=t.mask,a=0;a<this.bodies.length;a++){var d=this.bodies[a];if(d.collisionFilterGroup&l)for(var h=0;h<d.shapes.length;h++){var c=d.shapes[h],u=n.resolve(e,c.worldShape);if(!(0==u||u>s)){var p=o.add();e.computeHit(S,u),p._assign(S,u,c.collider,i.ZERO),r.push(p)}}}return r.length>0},t.getSharedBody=function(e,i){return w.getSharedBody(e,this,i)},t.addSharedBody=function(e){this.bodies.indexOf(e)<0&&this.bodies.push(e)},t.removeSharedBody=function(e){var i=this.bodies.indexOf(e);i>=0&&this.bodies.splice(i,1)},t.updateCollisionMatrix=function(e,i){for(var t=0;t<this.bodies.length;t++){var o=this.bodies[t];o.collisionFilterGroup==e&&(o.collisionFilterMask=i)}},t.emitTriggerEvent=function(){for(var e,i,t=0;t<this.shapeArr.length;t+=2)e=this.shapeArr[t],i=this.shapeArr[t+1],k.selfCollider=e.collider,k.otherCollider=i.collider,this._collisionMatrix.set(e.id,i.id,!0),this._collisionMatrixPrev.get(e.id,i.id)?k.type="onTriggerStay":k.type="onTriggerEnter",e.collider&&e.collider.emit(k.type,k),k.selfCollider=i.collider,k.otherCollider=e.collider,i.collider&&i.collider.emit(k.type,k);for(var o=0;o<this._shapeArrPrev.length;o+=2)e=this._shapeArrPrev[o],i=this._shapeArrPrev[o+1],this._collisionMatrixPrev.get(e.id,i.id)&&(this._collisionMatrix.get(e.id,i.id)||(k.type="onTriggerExit",k.selfCollider=e.collider,k.otherCollider=i.collider,e.collider&&e.collider.emit(k.type,k),k.selfCollider=i.collider,k.otherCollider=e.collider,i.collider&&i.collider.emit(k.type,k),this._collisionMatrix.set(e.id,i.id,!1)));var r=this._collisionMatrixPrev.matrix;this._collisionMatrixPrev.matrix=this._collisionMatrix.matrix,this._collisionMatrix.matrix=r,this._collisionMatrix.reset()},r(e,[{key:"impl",get:function(){return this}}]),e}(),m=function(){function e(){}var i=e.prototype;return i.initialize=function(e){this._rigidBody=e,this._sharedBody=c.instance.physicsWorld.getSharedBody(this._rigidBody.node,this),this._sharedBody.reference=!0},i.onEnable=function(){this._sharedBody.enabled=!0},i.onDisable=function(){this._sharedBody.enabled=!1},i.onDestroy=function(){this._sharedBody.reference=!1,this._rigidBody=null,this._sharedBody=null},i.setMass=function(){},i.setType=function(){},i.setLinearDamping=function(){},i.setAngularDamping=function(){},i.useGravity=function(){},i.setLinearFactor=function(){},i.setAngularFactor=function(){},i.setAllowSleep=function(){},i.wakeUp=function(){},i.sleep=function(){},i.clearState=function(){},i.clearForces=function(){},i.clearVelocity=function(){},i.setSleepThreshold=function(){},i.getSleepThreshold=function(){return 0},i.getLinearVelocity=function(){},i.setLinearVelocity=function(){},i.getAngularVelocity=function(){},i.setAngularVelocity=function(){},i.applyForce=function(){},i.applyLocalForce=function(){},i.applyImpulse=function(){},i.applyLocalImpulse=function(){},i.applyTorque=function(){},i.applyLocalTorque=function(){},i.setGroup=function(e){this._sharedBody.setGroup(e)},i.getGroup=function(){return this._sharedBody.getGroup()},i.addGroup=function(e){this._sharedBody.addGroup(e)},i.removeGroup=function(e){this._sharedBody.removeGroup(e)},i.setMask=function(e){this._sharedBody.setMask(e)},i.getMask=function(){return this._sharedBody.getMask()},i.addMask=function(e){this._sharedBody.addMask(e)},i.removeMask=function(e){this._sharedBody.removeMask(e)},r(e,[{key:"impl",get:function(){return this}},{key:"isAwake",get:function(){return!0}},{key:"isSleepy",get:function(){return!1}},{key:"isSleeping",get:function(){return!1}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"sharedBody",get:function(){return this._sharedBody}}]),e}(),x=function(){function e(){this.id=e.idCounter++}var t=e.prototype;return t.getAABB=function(){},t.getBoundingSphere=function(){},t.setMaterial=function(){},t.setAsTrigger=function(){},t.setCenter=function(e){i.copy(this._localShape.center,e)},t.initialize=function(e){this._collider=e,this._sharedBody=c.instance.physicsWorld.getSharedBody(this._collider.node),this._sharedBody.reference=!0},t.onLoad=function(){this.setCenter(this._collider.center)},t.onEnable=function(){this._sharedBody.addShape(this),this._sharedBody.enabled=!0},t.onDisable=function(){this._sharedBody.removeShape(this),this._sharedBody.enabled=!1},t.onDestroy=function(){this._sharedBody.reference=!1,this._collider=null,this._localShape=null,this._worldShape=null},t.transform=function(e,i,t,o){this._localShape.transform(e,i,t,o,this._worldShape)},t.getGroup=function(){return this._sharedBody.getGroup()},t.setGroup=function(e){this._sharedBody.setGroup(e)},t.addGroup=function(e){this._sharedBody.addGroup(e)},t.removeGroup=function(e){this._sharedBody.removeGroup(e)},t.getMask=function(){return this._sharedBody.getMask()},t.setMask=function(e){this._sharedBody.setMask(e)},t.addMask=function(e){this._sharedBody.addMask(e)},t.removeMask=function(e){this._sharedBody.removeMask(e)},r(e,[{key:"attachedRigidBody",get:function(){return null}},{key:"localShape",get:function(){return this._localShape}},{key:"worldShape",get:function(){return this._worldShape}},{key:"impl",get:function(){return this._worldShape}},{key:"sharedBody",get:function(){return this._sharedBody}},{key:"collider",get:function(){return this._collider}}]),e}();x.idCounter=0;var b=function(e){function t(){var i;return(i=e.call(this)||this)._localShape=new l,i._worldShape=new l,i}o(t,e),r(t,[{key:"localObb",get:function(){return this._localShape}},{key:"worldObb",get:function(){return this._worldShape}},{key:"collider",get:function(){return this._collider}}]);var s=t.prototype;return s.setSize=function(e){i.multiplyScalar(this.localObb.halfExtents,e,.5),i.multiply(this.worldObb.halfExtents,this.localObb.halfExtents,this.collider.node.worldScale)},s.onLoad=function(){e.prototype.onLoad.call(this),this.setSize(this.collider.size)},t}(x),C=function(e){o(t,e);var i=t.prototype;function t(i){var t;return void 0===i&&(i=.5),(t=e.call(this)||this)._localShape=new a(0,0,0,i),t._worldShape=new a(0,0,0,i),t}return i.setRadius=function(e){this.localSphere.radius=e;var i=f(this.collider.node.worldScale);this.worldSphere.radius=this.localSphere.radius*i},r(t,[{key:"localSphere",get:function(){return this._localShape}},{key:"worldSphere",get:function(){return this._worldShape}},{key:"collider",get:function(){return this._collider}}]),i.onLoad=function(){e.prototype.onLoad.call(this),this.setRadius(this.collider.radius)},t}(x),G=function(e){function i(i,t,o){var r;void 0===i&&(i=.5),void 0===t&&(t=2),void 0===o&&(o=h.Y_AXIS);var s=(t-2*i)/2,n=s<0?0:s;return(r=e.call(this)||this)._localShape=new d(i,n,o),r._worldShape=new d(i,n,o),r}o(i,e),r(i,[{key:"localCapsule",get:function(){return this._localShape}},{key:"worldCapsule",get:function(){return this._worldShape}},{key:"collider",get:function(){return this._collider}}]);var t=i.prototype;return t.setRadius=function(e){this.localCapsule.radius=e,this.transform(this._sharedBody.node.worldMatrix,this._sharedBody.node.worldPosition,this._sharedBody.node.worldRotation,this._sharedBody.node.worldScale)},t.setCylinderHeight=function(e){this.localCapsule.halfHeight=e/2,this.localCapsule.updateCache(),this.transform(this._sharedBody.node.worldMatrix,this._sharedBody.node.worldPosition,this._sharedBody.node.worldRotation,this._sharedBody.node.worldScale)},t.setDirection=function(e){this.localCapsule.axis=e,this.localCapsule.updateCache(),this.worldCapsule.axis=e,this.worldCapsule.updateCache(),this.transform(this._sharedBody.node.worldMatrix,this._sharedBody.node.worldPosition,this._sharedBody.node.worldRotation,this._sharedBody.node.worldScale)},t.onLoad=function(){e.prototype.onLoad.call(this),this.setRadius(this.collider.radius),this.setDirection(this.collider.direction)},i}(x);s(G.prototype,"shape.prototype",[{name:"setHeight",suggest:"You should use the interface provided by the component."}]),u("builtin",{RigidBody:m,BoxShape:b,SphereShape:C,PhysicsWorld:M,CapsuleShape:G})}}}));
