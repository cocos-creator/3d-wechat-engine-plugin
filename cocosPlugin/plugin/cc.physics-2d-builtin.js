System.register(["./deprecated-0768b3d4.js","./deprecated-4df5f565.js","./audio-downloader-f2f97571.js","./index-0614c00d.js","./deprecated-88eb2353.js","./screen-f991c158.js","./label-71612587.js","./SubContextView-70d90712.js","./graphics-9f7122fd.js","./intersection-2d-78b2a9a6.js","./hinge-joint-2d-f44e94df.js","./index-5fb772e7.js","./collision-matrix-a4920c2a.js"],(function(){"use strict";var t,n,i,o,e,s,r,a,l,c,h,u,d,f,p,g,w,y,v;return{setters:[function(c){t=c.a,n=c.a8,i=c._,o=c.W,e=c.a3,s=c.q,r=c.aa,a=c.aF,l=c.V},function(t){c=t.dS,h=t.dQ},function(){},function(){},function(t){u=t.h,d=t.R},function(){},function(){},function(){},function(t){f=t.G},function(t){p=t.I},function(t){g=t.a,w=t.C,y=t.d,v=t.s},function(){},function(){}],execute:function(){var _=function(){function i(){this._collider=null,this._worldAabb=new n}var o=i.prototype;return o.apply=function(){},o.initialize=function(t){this._collider=t},o.onLoad=function(){},o.onEnable=function(){g.instance.physicsWorld.addShape(this)},o.onDisable=function(){g.instance.physicsWorld.removeShape(this)},o.start=function(){},o.update=function(){},o.containsPoint=function(t){return!!this.worldAABB.contains(t)},o.intersectsRect=function(t){return!!this.worldAABB.intersects(t)},o.onGroupChanged=function(){g.instance.physicsWorld.updateShapeGroup(this)},t(i,[{key:"impl",get:function(){return null}},{key:"collider",get:function(){return this._collider}},{key:"worldAABB",get:function(){return this._worldAabb}}]),i}(),x=function(n){function e(){for(var t,i=arguments.length,e=new Array(i),s=0;s<i;s++)e[s]=arguments[s];return(t=n.call.apply(n,[this].concat(e))||this)._worldPoints=[new o,new o,new o,new o],t}i(e,n);var s=e.prototype;return s.update=function(){var t=this._worldAabb,n=this.collider,i=n.size,o=n.offset;t.x=o.x-i.width/2,t.y=o.y-i.height/2,t.width=i.width,t.height=i.height;var e=this._worldPoints,s=e[0],r=e[1],a=e[2],l=e[3];t.transformMat4ToPoints(n.node.worldMatrix,s,r,a,l);var c=Math.min(s.x,r.x,a.x,l.x),h=Math.min(s.y,r.y,a.y,l.y),u=Math.max(s.x,r.x,a.x,l.x),d=Math.max(s.y,r.y,a.y,l.y);t.x=c,t.y=h,t.width=u-c,t.height=d-h},s.containsPoint=function(t){return!!this.worldAABB.contains(t)&&p.pointInPolygon(t,this.worldPoints)},s.intersectsRect=function(t){return!!this.worldAABB.intersects(t)&&p.rectPolygon(t,this.worldPoints)},t(e,[{key:"worldPoints",get:function(){return this._worldPoints}}]),e}(_),P=new o,b=new e,A=function(n){function e(){for(var t,i=arguments.length,e=new Array(i),s=0;s<i;s++)e[s]=arguments[s];return(t=n.call.apply(n,[this].concat(e))||this)._worldPosition=new o,t._worldRadius=0,t}i(e,n);var s=e.prototype;return s.update=function(){var t=this._worldAabb,n=this.collider,i=n.node.getWorldMatrix(b);o.transformMat4(P,n.offset,i);var e=this._worldPosition;e.x=P.x,e.y=P.y,i.m12=i.m13=0,P.x=n.radius,P.y=0,o.transformMat4(P,P,i);var s=this._worldRadius=P.length();t.x=e.x-s,t.y=e.y-s,t.width=2*s,t.height=2*s},s.containsPoint=function(t){return!!this.worldAABB.contains(t)&&o.subtract(P,t,this.worldPosition).length()<this.worldRadius},s.intersectsRect=function(t){return!!this.worldAABB.intersects(t)&&p.rectCircle(t,this.worldPosition,this.worldRadius)},t(e,[{key:"worldPosition",get:function(){return this._worldPosition}},{key:"worldRadius",get:function(){return this._worldRadius}}]),e}(_),B=new o,C=function(n){function e(){for(var t,i=arguments.length,o=new Array(i),e=0;e<i;e++)o[e]=arguments[e];return(t=n.call.apply(n,[this].concat(o))||this)._worldPoints=[],t}i(e,n);var s=e.prototype;return s.update=function(){var t=this._worldAabb,n=this.collider,i=n.points,e=n.offset,s=n.node.worldMatrix,r=this._worldPoints;r.length=i.length;for(var a=1e6,l=1e6,c=-1e6,h=-1e6,u=0,d=i.length;u<d;u++){r[u]||(r[u]=new o),B.x=i[u].x+e.x,B.y=i[u].y+e.y,o.transformMat4(B,B,s);var f=B.x,p=B.y;r[u].x=f,r[u].y=p,f>c&&(c=f),f<a&&(a=f),p>h&&(h=p),p<l&&(l=p)}t.x=a,t.y=l,t.width=c-a,t.height=h-l},s.containsPoint=function(t){return!!this.worldAABB.contains(t)&&p.pointInPolygon(t,this.worldPoints)},s.intersectsRect=function(t){return!!this.worldAABB.intersects(t)&&p.rectPolygon(t,this.worldPoints)},t(e,[{key:"worldPoints",get:function(){return this._worldPoints}}]),e}(_),m=function(){function t(t,n){this.shape1=void 0,this.shape2=void 0,this.testFunc=void 0,this.touching=!1,this.type=w.None,this.shape1=t,this.shape2=n,this.touching=!1;var i=t instanceof x||t instanceof C,o=n instanceof x||n instanceof C,e=t instanceof A,r=n instanceof A;i&&o?this.testFunc=p.polygonPolygon:e&&r?this.testFunc=p.circleCircle:i&&r?this.testFunc=p.polygonCircle:e&&o?(this.testFunc=p.polygonCircle,this.shape1=n,this.shape2=t):s("Can not find contact for builtin shape: "+t.constructor.name+", "+n.constructor.name)}var n=t.prototype;return n.test=function(){var t=this.shape1,n=this.shape2;return!!t.worldAABB.intersects(n.worldAABB)&&(this.testFunc===p.polygonPolygon?p.polygonPolygon(t.worldPoints,n.worldPoints):this.testFunc===p.circleCircle?p.circleCircle(t.worldPosition,t.worldRadius,n.worldPosition,n.worldRadius):this.testFunc===p.polygonCircle&&p.polygonCircle(t.worldPoints,n.worldPosition,n.worldRadius))},n.updateState=function(){var t=this.test(),n=w.None;return t&&!this.touching?(this.touching=!0,n=w.BEGIN_CONTACT):!t&&this.touching&&(this.touching=!1,n=w.END_CONTACT),this.type=n,n},t}(),S=[],M=[],R=function(){function n(){this._contacts=[],this._shapes=[],this._debugGraphics=null,this._debugDrawFlags=0}var i=n.prototype;return i.shouldCollide=function(t,n){var i=t.collider,o=n.collider,e=g.instance.collisionMatrix;return i!==o&&i.node!==o.node&&e[i.group]&e[o.group]},i.addShape=function(t){var n=this._shapes;if(-1===n.indexOf(t)){for(var i=0,o=n.length;i<o;i++){var e=n[i];if(this.shouldCollide(t,e)){var s=new m(t,e);this._contacts.push(s)}}n.push(t)}},i.removeShape=function(t){var n=this._shapes,i=n.indexOf(t);if(i>=0){n.splice(i,1);for(var o=this._contacts,e=o.length-1;e>=0;e--){var s=o[e];s.shape1!==t&&s.shape2!==t||(s.touching&&this._emitCollide(s,w.END_CONTACT),o.splice(e,1))}}},i.updateShapeGroup=function(t){this.removeShape(t),this.addShape(t)},i.step=function(){for(var t=this._shapes,n=0,i=t.length;n<i;n++)t[n].update();var o=this._contacts;S.length=0;for(var e=0,s=o.length;e<s;e++)o[e].updateState()!==w.None&&S.push(o[e]);for(var r=0,a=S.length;r<a;r++){var l=S[r];this._emitCollide(l)}},i.drawDebug=function(){if(this._debugDrawFlags){this._checkDebugDrawValid();var t=this._debugGraphics;if(t){t.clear();for(var n=this._shapes,i=0,o=n.length;i<o;i++){var e=n[i];if(t.strokeColor=r.WHITE,e instanceof x||e instanceof C){var s=e.worldPoints;if(s.length>0){t.moveTo(s[0].x,s[0].y);for(var a=1;a<s.length;a++)t.lineTo(s[a].x,s[a].y);t.close(),t.stroke()}}else e instanceof A&&(t.circle(e.worldPosition.x,e.worldPosition.y,e.worldRadius),t.stroke());if(this._debugDrawFlags&y.Aabb){var l=e.worldAABB;t.strokeColor=r.BLUE,t.moveTo(l.xMin,l.yMin),t.lineTo(l.xMin,l.yMax),t.lineTo(l.xMax,l.yMax),t.lineTo(l.xMax,l.yMin),t.close(),t.stroke()}}}}},i._emitCollide=function(t,n){n=n||t.type;var i=t.shape1.collider,o=t.shape2.collider;g.instance.emit(n,i,o),i.emit(n,i,o),o.emit(n,o,i)},i._checkDebugDrawValid=function(){if(!this._debugGraphics||!this._debugGraphics.isValid){var t=c("Canvas");if(!t){var n=u.getScene();if(!n)return;(t=new h("Canvas")).addComponent(d),t.parent=n}var i=new h("PHYSICS_2D_DEBUG_DRAW");i._objFlags|=a.Flags.DontSave,i.parent=t,i.worldPosition=l.ZERO,this._debugGraphics=i.addComponent(f),this._debugGraphics.lineWidth=2}var o=this._debugGraphics.node.parent;this._debugGraphics.node.setSiblingIndex(o.children.length-1)},i.testPoint=function(t){var n=this._shapes;M.length=0;for(var i=0;i<n.length;i++){var o=n[i];o.containsPoint(t)&&M.push(o.collider)}return M},i.testAABB=function(t){var n=this._shapes;M.length=0;for(var i=0;i<n.length;i++){var o=n[i];o.intersectsRect(t)&&M.push(o.collider)}return M},i.impl=function(){return null},i.setGravity=function(){},i.setAllowSleep=function(){},i.syncPhysicsToScene=function(){},i.syncSceneToPhysics=function(){},i.raycast=function(){return[]},t(n,[{key:"debugDrawFlags",get:function(){return this._debugDrawFlags},set:function(t){this._debugDrawFlags=t}}]),n}();v("builtin",{PhysicsWorld:R,RigidBody:null,BoxShape:x,CircleShape:A,PolygonShape:C,MouseJoint:null,DistanceJoint:null,SpringJoint:null,RelativeJoint:null,SliderJoint:null,FixedJoint:null,WheelJoint:null,HingeJoint:null})}}}));
