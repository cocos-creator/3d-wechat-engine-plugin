System.register(["./deprecated-0768b3d4.js","./deprecated-4df5f565.js","./audio-downloader-f2f97571.js","./index-0614c00d.js","./deprecated-88eb2353.js","./screen-f991c158.js"],(function(t){"use strict";var e,i,n,s,o,r,a,l,h,c,p,u,_,d,y,m,f,v,E,A,b,g,O,P,T,w,k,R,L,S,D,C,U;return{setters:[function(t){e=t.E,i=t.q,n=t.l,s=t.a,o=t.a4,r=t._,a=t.i,l=t.c7,h=t.c,c=t.t,p=t.b5,u=t.b,_=t.bA,d=t.h,y=t.m,m=t.d,f=t.r,v=t.e,E=t.f,A=t.w,b=t.g,g=t.C,O=t.s,P=t.b6},function(t){T=t.e4,w=t.c0,k=t.cG,R=t.bQ,L=t.e3,S=t.e6},function(){},function(){},function(e){D=e._,C=e.E,t("VideoClip",e._)},function(t){U=t.s}],execute:function(){var M,V,F=e({REMOTE:0,LOCAL:1});!function(t){t.NONE="none",t.PLAYING="playing",t.PAUSED="paused",t.STOPPED="stopped",t.COMPLETED="completed",t.META_LOADED="meta-loaded",t.READY_TO_PLAY="ready-to-play",t.ERROR="error",t.CLICKED="clicked"}(M||(M={})),function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(V||(V={}));var I=function(){function t(t){var e=this;this._componentEventList=new Map,this._state=M.NONE,this._video=void 0,this._onHide=void 0,this._onShow=void 0,this._interrupted=!1,this._loaded=!1,this._loadedMeta=!1,this._ignorePause=!1,this._fullScreenOnAwake=!1,this._visible=!0,this._playing=!1,this._cachedCurrentTime=-1,this._waitingFullscreen=!1,this._waitingPlay=!1,this._keepAspectRatio=!1,this._component=null,this._uiTrans=null,this._stayOnBottom=!1,this._dirty=!1,this._forceUpdate=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._uiTrans=t.node.getComponent(T),this._onHide=function(){e.video&&e._state===M.PLAYING&&(e.video.pause(),e._interrupted=!0)},this._onShow=function(){e._interrupted&&e.video&&(e.video.play(),e._interrupted=!1)},n.game.on(n.Game.EVENT_HIDE,this._onHide),n.game.on(n.Game.EVENT_SHOW,this._onShow)}var e=t.prototype;return e.onLoadedMetadata=function(t){this._loadedMeta=!0,this._forceUpdate=!0,this._visible?this.enable():this.disable(),this.dispatchEvent(M.META_LOADED),this._keepAspectRatio&&this.syncUITransform(t.target.videoWidth,t.target.videoHeight),this.delayedFullScreen(),this.delayedPlay()},e.onCanPlay=function(){this._loaded=!0,this.dispatchEvent(M.READY_TO_PLAY)},e.onPlay=function(){this._playing=!0,this.dispatchEvent(M.PLAYING)},e.onPlaying=function(){this.dispatchEvent(M.PLAYING)},e.onPause=function(){this._ignorePause?this._ignorePause=!1:(this._playing=!1,this.dispatchEvent(M.PAUSED))},e.onStoped=function(){this._playing=!1,this._ignorePause=!1,this.dispatchEvent(M.STOPPED)},e.onEnded=function(){this.dispatchEvent(M.COMPLETED)},e.onClick=function(){this.dispatchEvent(M.CLICKED)},e.onError=function(t){this.dispatchEvent(M.ERROR);var e=t.target.error;e&&i("Error "+e.code+"; details: "+e.message)},e.play=function(){this._loadedMeta||this._loaded?this.canPlay():this._waitingPlay=!0},e.delayedPlay=function(){this._waitingPlay&&(this.canPlay(),this._waitingPlay=!1)},e.syncFullScreenOnAwake=function(t){this._fullScreenOnAwake=t,this._loadedMeta||this._loaded?this.canFullScreen(t):this._waitingFullscreen=!0},e.delayedFullScreen=function(){this._waitingFullscreen&&(this.canFullScreen(this._fullScreenOnAwake),this._waitingFullscreen=!1)},e.dispatchEvent=function(t){var e=this._componentEventList.get(t);e&&(this._state=t,e.call(this))},e.syncUITransform=function(t,e){this._uiTrans&&(this._uiTrans.width=t,this._uiTrans.height=e)},e.syncCurrentTime=function(){-1!==this._cachedCurrentTime&&this.video.currentTime!==this._cachedCurrentTime&&(this.seekTo(this._cachedCurrentTime),this._cachedCurrentTime=-1)},e.destroy=function(){this.removeVideoPlayer(),this._componentEventList.clear(),n.game.off(n.Game.EVENT_HIDE,this._onHide),n.game.off(n.Game.EVENT_SHOW,this._onShow)},s(t,[{key:"fullScreenOnAwake",get:function(){return this._fullScreenOnAwake}},{key:"loaded",get:function(){return this._loaded}},{key:"componentEventList",get:function(){return this._componentEventList}},{key:"video",get:function(){return this._video}},{key:"state",get:function(){return this._state}},{key:"UICanvas",get:function(){return this._uiTrans&&this._uiTrans._canvas}},{key:"UICamera",get:function(){return this._uiTrans&&this._uiTrans._canvas&&this._uiTrans._canvas.camera}}]),t}();n.internal.VideoPlayerImpl=I;var N,H,x,B,Y,G,j,z,W,K,q,Q,J,X,Z,$,tt,et,it,nt,st,ot,rt,at,lt,ht,ct,pt,ut,_t,dt,yt,mt,ft,vt,Et,At,bt,gt,Ot=-Math.pow(2,15),Pt=o(),Tt=function(t){function e(e){var i;return(i=t.call(this,e)||this)._eventList=new Map,i._clearColorA=-1,i._clearFlag=void 0,i}r(e,t);var i=e.prototype;return i.addListener=function(t,e){this._video&&(this._eventList.set(t,e),this._video.addEventListener(t,e))},i.removeAllListeners=function(){var t=this;this._eventList.forEach((function(e,i){t._video.removeEventListener(i,e)})),this._eventList.clear()},i.canPlay=function(){var t=this;if(this.video){var e=this.video.play();window.Promise&&e instanceof Promise&&e.catch((function(){})).then((function(){t.syncCurrentTime()}))}},i.pause=function(){this.video&&(this.video.pause(),this._cachedCurrentTime=this.video.currentTime)},i.resume=function(){this.play()},i.stop=function(){var t=this;this.video&&(this._ignorePause=!0,this.video.currentTime=0,this.video.pause(),setTimeout((function(){t._ignorePause=!1,t.dispatchEvent(M.STOPPED)}),0))},i.syncClip=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t.nativeUrl)},i.syncURL=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t)},i.syncPlaybackRate=function(t){a.browserType!==a.BROWSER_TYPE_UC?this.video&&(this.video.playbackRate=t):console.warn("playbackRate is not supported by the uc mobile browser.")},i.syncVolume=function(t){this.video&&(this.video.volume=t)},i.syncMute=function(t){this.video&&(this.video.mute=t)},i.syncLoop=function(t){this.video&&(this.video.loop=t)},i.getDuration=function(){return this.video?this.video.duration:0},i.getCurrentTime=function(){return this.video?this.video.currentTime:-1},i.seekTo=function(t){this.video&&(this.video.currentTime=t)},i.canFullScreen=function(t){var e=this,i=this._video;if(i&&i.readyState===V.HAVE_ENOUGH_DATA)return a.os===a.OS_IOS&&a.isBrowser?(t?i.webkitEnterFullscreen&&i.webkitEnterFullscreen():i.webkitExitFullscreen&&i.webkitExitFullscreen(),void(this._fullScreenOnAwake=i.webkitDisplayingFullscreen)):U.supportsFullScreen?void(t?(a.browserType===a.BROWSER_TYPE_IE&&(i.style.transform=""),i.setAttribute("x5-video-player-fullscreen","true"),U.requestFullScreen(i,(function(t){var n=a.browserType===a.BROWSER_TYPE_IE?t.msFullscreenElement:t.fullscreenElement;e._fullScreenOnAwake=n===i}),(function(){e._fullScreenOnAwake=!1}))):(i.removeAttribute("x5-video-player-fullscreen"),U.exitFullScreen())):(this._fullScreenOnAwake=t,this._forceUpdate=!0,void this.syncMatrix())},i.syncStayOnBottom=function(t){this._video&&(this._video.style["z-index"]=t?Ot:0,this._stayOnBottom=t),this._dirty=!0},i.syncKeepAspectRatio=function(t){this._keepAspectRatio=t,t&&this._loadedMeta&&this.syncUITransform(this._video.videoWidth,this._video.videoHeight)},i.removeVideoPlayer=function(){var t=this._video;t&&l(w.container,t)&&(w.container.removeChild(t),this.removeAllListeners()),this._cachedCurrentTime=0,this._playing=!1,this._loaded=!1,this._loadedMeta=!1,this._video=null},i.createVideoPlayer=function(t){var e=this._video=document.createElement("video");e.className="cocosVideo",e.style.visibility="hidden",e.style.position="absolute",e.style.bottom="0px",e.style.left="0px",e.style["transform-origin"]="0px 100% 0px",e.style["-webkit-transform-origin"]="0px 100% 0px",e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("x5-playsinline",""),e.setAttribute("playsinline",""),this._bindDomEvent(),w.container.appendChild(e);var i=document.createElement("source");e.appendChild(i),i.src=t},i._bindDomEvent=function(){this._video,this.addListener("loadedmetadata",this.onLoadedMetadata.bind(this)),this.addListener("canplay",this.onCanPlay.bind(this)),this.addListener("canplaythrough",this.onCanPlay.bind(this)),this.addListener("play",this.onPlay.bind(this)),this.addListener("playing",this.onPlaying.bind(this)),this.addListener("pause",this.onPause.bind(this)),this.addListener("click",this.onClick.bind(this)),this.addListener("ended",this.onEnded.bind(this)),this.addListener("error",this.onError.bind(this))},i.onCanPlay=function(e){if(!this._loaded)switch(e.target.readyState){case V.HAVE_METADATA:case V.HAVE_ENOUGH_DATA:t.prototype.onCanPlay.call(this,e)}},i.enable=function(){if(this._video){if(this._visible=!0,"visible"===this._video.style.visibility)return;this._video.style.visibility="visible"}},i.disable=function(t){if(this._video){if(!t&&this._playing&&this._video.pause(),this._visible=!1,"hidden"===this._video.style.visibility)return;this._video.style.visibility="hidden"}},i.syncMatrix=function(){if(this._video&&this._visible&&this._component){var t=this.UICanvas;if(t){var e=t.camera;if(e&&!U.fullScreen()){this._dirty&&(this._dirty=!1,this._stayOnBottom?(this._clearColorA=t.color.a,this._clearFlag=t.clearFlag,t.color.a=0,t.clearFlag=k.ALL):this._clearFlag&&(t.color.a=this._clearColorA,t.clearFlag=this._clearFlag,this._clearColorA=-1,this._clearFlag=null)),this._component.node.getWorldMatrix(Pt),e.update(!0),e.worldMatrixToScreen(Pt,Pt,w.canvas.width,w.canvas.height);var i=0,n=0;if(this._fullScreenOnAwake?(i=L.width,n=L.height):(i=this._uiTrans.contentSize.width,n=this._uiTrans.contentSize.height),this._forceUpdate||this._m00!==Pt.m00||this._m01!==Pt.m01||this._m04!==Pt.m04||this._m05!==Pt.m05||this._m12!==Pt.m12||this._m13!==Pt.m13||this._w!==i||this._h!==n){this._m00=Pt.m00,this._m01=Pt.m01,this._m04=Pt.m04,this._m05=Pt.m05,this._m12=Pt.m12,this._m13=Pt.m13,this._w=i,this._h=n;var s,o,r=R.getDevicePixelRatio(),l=1/r,h=1/r,c=w.container,p=Pt.m00*l,u=Pt.m01,_=Pt.m04,d=Pt.m05*h;this._video.style.width=this._w+"px",this._video.style.height=this._h+"px",a.browserType!==a.BROWSER_TYPE_MOBILE_QQ?this._video.style.objectFit=this._keepAspectRatio?"none":"fill":console.warn("keepAspectRatio is not supported by the qq mobile browser."),s=this._w*l,o=this._h*h;var y=this._uiTrans.anchorPoint,m=y.x,f=y.y,v=s*Pt.m00*m,E=o*Pt.m05*f,A=c&&c.style.paddingLeft?parseInt(c.style.paddingLeft):0,b=c&&c.style.paddingBottom?parseInt(c.style.paddingBottom):0,g="matrix("+p+","+-u+","+-_+","+d+","+(Pt.m12*l-v+A)+","+-(Pt.m13*h-E+b)+")";this._video.style.transform=g,this._video.style["-webkit-transform"]=g,a.browserType!==a.BROWSER_TYPE_IE&&(this._forceUpdate=!1)}}}}},e}(I),wt=function(){function t(){}return t.getImpl=function(t){return new Tt(t)},t}();n.internal.VideoPlayerImplManager=wt;var kt=t("VideoPlayer",(N=h("cc.VideoPlayer"),H=d(),x=y(),B=S(T),Y=c(D),G=c(F),j=m(),z=m(),W=c(D),K=m(),q=m(),Q=f(),J=m(),X=f(),Z=m(),$=m(),tt=m(),et=m(),it=m(),nt=m(),st=c([C]),ot=P(),rt=m(),N(at=H(at=x(at=B(at=p((gt=bt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return e=t.call.apply(t,[this].concat(n))||this,v(e,"_resourceType",ht,E(e)),v(e,"_remoteURL",ct,E(e)),v(e,"_clip",pt,E(e)),v(e,"_playOnAwake",ut,E(e)),v(e,"_volume",_t,E(e)),v(e,"_mute",dt,E(e)),v(e,"_playbackRate",yt,E(e)),v(e,"_loop",mt,E(e)),v(e,"_fullScreenOnAwake",ft,E(e)),v(e,"_stayOnBottom",vt,E(e)),v(e,"_keepAspectRatio",Et,E(e)),e._impl=void 0,e._cachedCurrentTime=0,v(e,"videoPlayerEvent",At,E(e)),e}r(e,t);var i=e.prototype;return i.syncSource=function(){this._impl&&(this._resourceType===F.REMOTE?this._impl.syncURL(this._remoteURL):this._impl.syncClip(this._clip))},i.__preload=function(){this._impl=wt.getImpl(this),this.syncSource(),this._impl.syncLoop(this._loop),this._impl.syncVolume(this._volume),this._impl.syncMute(this._mute),this._impl.seekTo(this._cachedCurrentTime),this._impl.syncPlaybackRate(this._playbackRate),this._impl.syncStayOnBottom(this._stayOnBottom),this._impl.syncKeepAspectRatio(this._keepAspectRatio),this._impl.syncFullScreenOnAwake(this._fullScreenOnAwake),this._impl.componentEventList.set(M.META_LOADED,this.onMetaLoaded.bind(this)),this._impl.componentEventList.set(M.READY_TO_PLAY,this.onReadyToPlay.bind(this)),this._impl.componentEventList.set(M.PLAYING,this.onPlaying.bind(this)),this._impl.componentEventList.set(M.PAUSED,this.onPasued.bind(this)),this._impl.componentEventList.set(M.STOPPED,this.onStopped.bind(this)),this._impl.componentEventList.set(M.COMPLETED,this.onCompleted.bind(this)),this._impl.componentEventList.set(M.ERROR,this.onError.bind(this)),this._playOnAwake&&this._impl.loaded&&this.play()},i.onEnable=function(){this._impl&&this._impl.enable()},i.onDisable=function(){this._impl&&this._impl.disable()},i.onDestroy=function(){this._impl&&(this._impl.destroy(),this._impl=null)},i.update=function(){this._impl&&this._impl.syncMatrix()},i.onMetaLoaded=function(){C.emitEvents(this.videoPlayerEvent,this,M.META_LOADED),this.node.emit("meta-loaded",this)},i.onReadyToPlay=function(){this._playOnAwake&&!this.isPlaying&&this.play(),C.emitEvents(this.videoPlayerEvent,this,M.READY_TO_PLAY),this.node.emit(M.READY_TO_PLAY,this)},i.onPlaying=function(){C.emitEvents(this.videoPlayerEvent,this,M.PLAYING),this.node.emit(M.PLAYING,this)},i.onPasued=function(){C.emitEvents(this.videoPlayerEvent,this,M.PAUSED),this.node.emit(M.PAUSED,this)},i.onStopped=function(){C.emitEvents(this.videoPlayerEvent,this,M.STOPPED),this.node.emit(M.STOPPED,this)},i.onCompleted=function(){C.emitEvents(this.videoPlayerEvent,this,M.COMPLETED),this.node.emit(M.COMPLETED,this)},i.onError=function(){C.emitEvents(this.videoPlayerEvent,this,M.ERROR),this.node.emit(M.ERROR,this)},i.play=function(){this._impl&&this._impl.play()},i.resume=function(){this._impl&&this._impl.resume()},i.pause=function(){this._impl&&this._impl.pause()},i.stop=function(){this._impl&&this._impl.stop()},s(e,[{key:"resourceType",get:function(){return this._resourceType},set:function(t){this._resourceType!==t&&(this._resourceType=t,this.syncSource())}},{key:"remoteURL",get:function(){return this._remoteURL},set:function(t){this._remoteURL!==t&&(this._remoteURL=t,this.syncSource())}},{key:"clip",get:function(){return this._clip},set:function(t){this._clip!==t&&(this._clip=t,this.syncSource())}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._impl&&this._impl.syncPlaybackRate(t)}},{key:"volume",get:function(){return this._volume},set:function(t){this._volume=t,this._impl&&this._impl.syncVolume(t)}},{key:"mute",get:function(){return this._mute},set:function(t){this._mute=t,this._impl&&this._impl.syncMute(t)}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._impl&&this._impl.syncLoop(t)}},{key:"keepAspectRatio",get:function(){return this._keepAspectRatio},set:function(t){this._keepAspectRatio!==t&&(this._keepAspectRatio=t,this._impl&&this._impl.syncKeepAspectRatio(t))}},{key:"fullScreenOnAwake",get:function(){return this._fullScreenOnAwake=this._impl&&this._impl.fullScreenOnAwake,this._fullScreenOnAwake},set:function(t){this._fullScreenOnAwake!==t&&(this._fullScreenOnAwake=t,this._impl&&this._impl.syncFullScreenOnAwake(t))}},{key:"stayOnBottom",get:function(){return this._stayOnBottom},set:function(t){this._stayOnBottom!==t&&(this._stayOnBottom=t,this._impl&&this._impl.syncStayOnBottom(t))}},{key:"nativeVideo",get:function(){return this._impl&&this._impl.video||null}},{key:"currentTime",get:function(){return this._impl?this._impl.getCurrentTime():this._cachedCurrentTime},set:function(t){isNaN(t)?A("illegal video time! value:"+t):(t=b(t,0,this.duration),this._cachedCurrentTime=t,this._impl&&this._impl.seekTo(t))}},{key:"duration",get:function(){return this._impl?this._impl.getDuration():0}},{key:"state",get:function(){return this._impl?this._impl.state:M.NONE}},{key:"isPlaying",get:function(){return this.state===M.PLAYING}}]),e}(g),bt.EventType=M,bt.ResourceType=F,ht=u((lt=gt).prototype,"_resourceType",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return F.LOCAL}}),ct=u(lt.prototype,"_remoteURL",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),pt=u(lt.prototype,"_clip",[Y,O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ut=u(lt.prototype,"_playOnAwake",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_t=u(lt.prototype,"_volume",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),dt=u(lt.prototype,"_mute",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yt=u(lt.prototype,"_playbackRate",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),mt=u(lt.prototype,"_loop",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ft=u(lt.prototype,"_fullScreenOnAwake",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),vt=u(lt.prototype,"_stayOnBottom",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Et=u(lt.prototype,"_keepAspectRatio",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),u(lt.prototype,"resourceType",[G,j],Object.getOwnPropertyDescriptor(lt.prototype,"resourceType"),lt.prototype),u(lt.prototype,"remoteURL",[z],Object.getOwnPropertyDescriptor(lt.prototype,"remoteURL"),lt.prototype),u(lt.prototype,"clip",[W,K],Object.getOwnPropertyDescriptor(lt.prototype,"clip"),lt.prototype),u(lt.prototype,"playOnAwake",[q],Object.getOwnPropertyDescriptor(lt.prototype,"playOnAwake"),lt.prototype),u(lt.prototype,"playbackRate",[_,Q,J],Object.getOwnPropertyDescriptor(lt.prototype,"playbackRate"),lt.prototype),u(lt.prototype,"volume",[_,X,Z],Object.getOwnPropertyDescriptor(lt.prototype,"volume"),lt.prototype),u(lt.prototype,"mute",[$],Object.getOwnPropertyDescriptor(lt.prototype,"mute"),lt.prototype),u(lt.prototype,"loop",[tt],Object.getOwnPropertyDescriptor(lt.prototype,"loop"),lt.prototype),u(lt.prototype,"keepAspectRatio",[et],Object.getOwnPropertyDescriptor(lt.prototype,"keepAspectRatio"),lt.prototype),u(lt.prototype,"fullScreenOnAwake",[it],Object.getOwnPropertyDescriptor(lt.prototype,"fullScreenOnAwake"),lt.prototype),u(lt.prototype,"stayOnBottom",[nt],Object.getOwnPropertyDescriptor(lt.prototype,"stayOnBottom"),lt.prototype),At=u(lt.prototype,"videoPlayerEvent",[O,st,ot,rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),at=lt))||at)||at)||at)||at)||at));n.internal.VideoPlayer=kt}}}));
